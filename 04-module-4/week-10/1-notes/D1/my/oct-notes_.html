<h2 id="rdbms">RDBMS</h2>
<p>That’s quite an ugly acronym, but it’s what developers have when referring to the software application that manages databases for us. Here’s an important difference for you to understand.</p>
<p>The <strong>RDBMS</strong> is a software application that you run that your programs can connect to that they can store, modify, and retrieve data. The RDBS that you will use in this course is called <a href="https://www.postgresql.org/">PostgreSQL</a>, often shortened to just “postgres”, pronounced like it’s spelled. It is an “open-source” RDBMS which means that you can go read the source code for it, copy it, modify it, and make your own specialized version of an RDBMS. Often, developers will talk about the “database server”. That is the computer on which the RDBMS is running.</p>
<p>A <strong>database</strong> (or more properly <strong>relational database</strong>) is a collection of structured data that the RDBMS manages for you. A single running RDBMS can have hundreds of databases in it that it manages.</p>
<h2 id="what-is-postgresql">What is PostgreSQL?</h2>
<p>Again, PostgreSQL is software. Specifically, it is an open-source, relational database management system. It is derived from the POSTGRES package written at UC Berkeley. The specific name “PostgreSQL” was coined in 1996, after SQL was implemented as its core query language. PostgreSQL provided a new program (new for 1996) for interactive SQL queries called <code>[psql]</code>, which is terminal-based front-end to PostgreSQL that lets you to type in queries interactively, issue them to PostgreSQL, and see the query results.</p>
<p>When you do connect with it, you will interact with it through a small set of its own commands and SQL.</p>
<h2 id="what-is-sql">What is SQL?</h2>
<p>SQL (pronounced “sequel” or “s-q-l”) stands for “Structured Query Language”. It is not a programming language like JavaScript. JavaScript, as you well know, has <em>control flow</em>, with <code>for</code> loops and <code>if</code> statements. Most SQL that you write doesn’t have all that. Instead, it is a <em>declarative</em> programming language. You tell the database what computation you want it to do, and it does it.</p>
<p>The process of using SQL takes two steps:</p>
<ol type="1">
<li>Connect to an RDBMS specifying
<ul>
<li>credentials, user name and password</li>
<li>the name of the database that you want to use</li>
</ul></li>
<li>Issue one or more SQL statements to interact with
<ul>
<li>the structure of the database</li>
<li>the data in the database</li>
</ul></li>
</ol>
<figure>
<img src="../../../images/d6dd08f78245c1f7457c496ea32e5b77b17fc2a8833ad0e5a1cdfe80b35625cb.png" alt="picture 1" /><figcaption>picture 1</figcaption>
</figure>
<figure>
<img src="../../../images/3478b7ec074d124ae526af81d6bd9004aeb327e05cda3109b8e8d2c8898d464b.png" alt="picture 3" /><figcaption>picture 3</figcaption>
</figure>
<figure>
<img src="../../../images/b88352a2c178ba56345aa1aa703e8ef4d88c749f5e0cf79637432937d38957ed.png" alt="picture 4" /><figcaption>picture 4</figcaption>
</figure>
<figure>
<img src="../../../images/4e8c7f13c392a3da81b27d80c1703a846ea5bb35c9c9902802c8630483173f04.png" alt="picture 5" /><figcaption>picture 5</figcaption>
</figure>
<figure>
<img src="../../../images/adac702051e62b3729cfe9869845fb17a1ecc53ce86bf47cca529fc2edd1ebeb.png" alt="picture 6" /><figcaption>picture 6</figcaption>
</figure>
<figure>
<img src="../../../images/0ac1ccca984a5620243123d810386a9093e141eeb9a0b65cae1ce27152437f9e.png" alt="picture 7" /><figcaption>picture 7</figcaption>
</figure>
<figure>
<img src="../../../images/c754280a7ea24ff9b7fa20c88b4c5c0b0515be3677f0785f400bc190f8953819.png" alt="picture 8" /><figcaption>picture 8</figcaption>
</figure>
<p><img src="../../../images/f493a0c7771e6ebb8a53908ee2a9953451d5648e9875af6f650db54b6c91471d.png" alt="picture 9" /> ## PSQL</p>
<p>Magic words:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">psql</span> -U postgres</a></code></pre></div>
<p>Some interesting flags (to see all, use <code>-h</code> or <code>--help</code> depending on your psql version): - <code>-E</code>: will describe the underlaying queries of the <code>\</code> commands (cool for learning!) - <code>-l</code>: psql will list all databases and then exit (useful if the user you connect with doesn’t has a default database, like at AWS RDS)</p>
<p>Most <code>\d</code> commands support additional param of <code>__schema__.name__</code> and accept wildcards like <code>*.*</code></p>
<ul>
<li><code>\q</code>: Quit/Exit</li>
<li><code>\c __database__</code>: Connect to a database</li>
<li><code>\d __table__</code>: Show table definition (columns, etc.) including triggers</li>
<li><code>\d+ __table__</code>: More detailed table definition including description and physical disk size</li>
<li><code>\l</code>: List databases</li>
<li><code>\dy</code>: List events</li>
<li><code>\df</code>: List functions</li>
<li><code>\di</code>: List indexes</li>
<li><code>\dn</code>: List schemas</li>
<li><code>\dt *.*</code>: List tables from all schemas (if <code>*.*</code> is omitted will only show SEARCH_PATH ones)</li>
<li><code>\dT+</code>: List all data types</li>
<li><code>\dv</code>: List views</li>
<li><code>\dx</code>: List all extensions installed</li>
<li><code>\df+ __function__</code> : Show function SQL code.</li>
<li><code>\x</code>: Pretty-format query results instead of the not-so-useful ASCII tables</li>
<li><code>\copy (SELECT * FROM __table_name__) TO 'file_path_and_name.csv' WITH CSV</code>: Export a table as CSV</li>
<li><code>\des+</code>: List all foreign servers</li>
<li><code>\dE[S+]</code>: List all foreign tables</li>
</ul>
<p>User Related: - <code>\du</code>: List users - <code>\du __username__</code>: List a username if present. - <code>create role __test1__</code>: Create a role with an existing username. - <code>create role __test2__ noinherit login password __passsword__;</code>: Create a role with username and password. - <code>set role __test__;</code>: Change role for current session to <code>__test__</code>. - <code>grant __test2__ to __test1__;</code>: Allow <code>__test1__</code> to set its role as <code>__test2__</code>. - <code>\deu+</code>: List all user mapping on server</p>
<h2 id="configuration">Configuration</h2>
<ul>
<li>Service management commands:</li>
</ul>
<pre><code>sudo service postgresql stop
sudo service postgresql start
sudo service postgresql restart</code></pre>
<ul>
<li>Changing verbosity &amp; querying Postgres log: <br/>1) First edit the config file, set a decent verbosity, save and restart postgres:</li>
</ul>
<pre><code>sudo vim /etc/postgresql/9.3/main/postgresql.conf

# Uncomment/Change inside:
log_min_messages = debug5
log_min_error_statement = debug5
log_min_duration_statement = -1

sudo service postgresql restart</code></pre>
<ol start="2" type="1">
<li>Now you will get tons of details of every statement, error, and even background tasks like VACUUMs</li>
</ol>
<pre><code>tail -f /var/log/postgresql/postgresql-9.3-main.log</code></pre>
<ol start="3" type="1">
<li>How to add user who executed a PG statement to log (editing <code>postgresql.conf</code>):</li>
</ol>
<pre><code>log_line_prefix = &#39;%t %u %d %a &#39;</code></pre>
<h2 id="create-command">Create command</h2>
<p>There are many <code>CREATE</code> choices, like <code>CREATE DATABASE __database_name__</code>, <code>CREATE TABLE __table_name__</code> … Parameters differ but can be checked <a href="https://www.postgresql.org/search/?u=%2Fdocs%2F9.1%2F&amp;q=CREATE">at the official documentation</a>.</p>
<h2 id="handy-queries">Handy queries</h2>
<ul>
<li><code>SELECT * FROM pg_proc WHERE proname='__procedurename__'</code>: List procedure/function</li>
<li><code>SELECT * FROM pg_views WHERE viewname='__viewname__';</code>: List view (including the definition)</li>
<li><code>SELECT pg_size_pretty(pg_total_relation_size('__table_name__'));</code>: Show DB table space in use</li>
<li><code>SELECT pg_size_pretty(pg_database_size('__database_name__'));</code>: Show DB space in use</li>
<li><code>show statement_timeout;</code>: Show current user’s statement timeout</li>
<li><code>SELECT * FROM pg_indexes WHERE tablename='__table_name__' AND schemaname='__schema_name__';</code>: Show table indexes</li>
<li>Get all indexes from all tables of a schema:</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">SELECT</span></a>
<a class="sourceLine" id="cb6-2" title="2">   t.relname <span class="kw">AS</span> table_name,</a>
<a class="sourceLine" id="cb6-3" title="3">   i.relname <span class="kw">AS</span> index_name,</a>
<a class="sourceLine" id="cb6-4" title="4">   a.attname <span class="kw">AS</span> column_name</a>
<a class="sourceLine" id="cb6-5" title="5"><span class="kw">FROM</span></a>
<a class="sourceLine" id="cb6-6" title="6">   pg_class t,</a>
<a class="sourceLine" id="cb6-7" title="7">   pg_class i,</a>
<a class="sourceLine" id="cb6-8" title="8">   pg_index ix,</a>
<a class="sourceLine" id="cb6-9" title="9">   pg_attribute a,</a>
<a class="sourceLine" id="cb6-10" title="10">    pg_namespace n</a>
<a class="sourceLine" id="cb6-11" title="11"><span class="kw">WHERE</span></a>
<a class="sourceLine" id="cb6-12" title="12">   t.<span class="kw">oid</span> <span class="op">=</span> ix.indrelid</a>
<a class="sourceLine" id="cb6-13" title="13">   <span class="kw">AND</span> i.<span class="kw">oid</span> <span class="op">=</span> ix.indexrelid</a>
<a class="sourceLine" id="cb6-14" title="14">   <span class="kw">AND</span> a.attrelid <span class="op">=</span> t.<span class="kw">oid</span></a>
<a class="sourceLine" id="cb6-15" title="15">   <span class="kw">AND</span> a.attnum <span class="op">=</span> <span class="kw">ANY</span>(ix.indkey)</a>
<a class="sourceLine" id="cb6-16" title="16">   <span class="kw">AND</span> t.relnamespace <span class="op">=</span> n.<span class="kw">oid</span></a>
<a class="sourceLine" id="cb6-17" title="17">    <span class="kw">AND</span> n.nspname <span class="op">=</span> <span class="st">&#39;kartones&#39;</span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="kw">ORDER</span> <span class="kw">BY</span></a>
<a class="sourceLine" id="cb6-19" title="19">   t.relname,</a>
<a class="sourceLine" id="cb6-20" title="20">   i.relname</a></code></pre></div>
<ul>
<li>Execution data:
<ul>
<li>Queries being executed at a certain DB:</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">SELECT</span> datname, application_name, pid, backend_start, query_start, state_change, state, <span class="kw">query</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">FROM</span> pg_stat_activity</a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">WHERE</span> datname<span class="op">=</span><span class="st">&#39;__database_name__&#39;</span>;</a></code></pre></div>
<ul>
<li>Get all queries from all dbs waiting for data (might be hung):</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> pg_stat_activity <span class="kw">WHERE</span> waiting<span class="op">=</span><span class="st">&#39;t&#39;</span></a></code></pre></div>
<ul>
<li>Currently running queries with process pid:</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">SELECT</span> pg_stat_get_backend_pid(s.backendid) <span class="kw">AS</span> procpid,</a>
<a class="sourceLine" id="cb9-2" title="2">pg_stat_get_backend_activity(s.backendid) <span class="kw">AS</span> current_query</a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">FROM</span> (<span class="kw">SELECT</span> pg_stat_get_backend_idset() <span class="kw">AS</span> backendid) <span class="kw">AS</span> s;</a></code></pre></div></li>
</ul>
<p>Casting: - <code>CAST (column AS type)</code> or <code>column::type</code> - <code>'__table_name__'::regclass::oid</code>: Get oid having a table name</p>
<p>Query analysis: - <code>EXPLAIN __query__</code>: see the query plan for the given query - <code>EXPLAIN ANALYZE __query__</code>: see and execute the query plan for the given query - <code>ANALYZE [__table__]</code>: collect statistics</p>
<p>Generating random data (<a href="https://www.citusdata.com/blog/2019/07/17/postgres-tips-for-average-and-power-user/">source</a>): - <code>INSERT INTO some_table (a_float_value) SELECT random() * 100000 FROM generate_series(1, 1000000) i;</code></p>
<figure>
<img src="../../../images/10c39b09e6a7df30eeb73d33c1711ad6884315c7c368b6c74478725ae486a23d.png" alt="picture 1" /><figcaption>picture 1</figcaption>
</figure>
<figure>
<img src="../../../images/03ab52c85dfafd6033e75ae6b4c3156403f0e65b997edb00fbe7be4fe61d22fa.png" alt="picture 2" /><figcaption>picture 2</figcaption>
</figure>
<h2 id="forign-keys-are-what-make-databases-relationalthey-reference-atable-and-column-in-another-table.">Forign keys are what make databases relational…they reference atable and column in another table.</h2>
<figure>
<img src="../../../images/ddfd524fb7f3da3fc3c44ccbef9a74fa7c5e0e1700ff97e4aaec52beb89ce1df.png" alt="picture 3" /><figcaption>picture 3</figcaption>
</figure>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" title="1"></a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb10-5" title="5"></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="fu">sudo</span> vim /etc/postgresql/12/main/postgresql.conf</a>
<a class="sourceLine" id="cb10-7" title="7">[<span class="ex">sudo</span>] password for bryan:</a>
<a class="sourceLine" id="cb10-8" title="8"></a>
<a class="sourceLine" id="cb10-9" title="9">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb10-11" title="11"></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="fu">sudo</span> service postgresql status</a>
<a class="sourceLine" id="cb10-13" title="13"><span class="ex">12/main</span> (port 5432)<span class="bu">:</span> down</a>
<a class="sourceLine" id="cb10-14" title="14"></a>
<a class="sourceLine" id="cb10-15" title="15">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="ex">bryan_dir</span>:~_exitstatus:3 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb10-17" title="17"></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="fu">sudo</span> service postgresql stop</a>
<a class="sourceLine" id="cb10-19" title="19"><span class="ex">*</span> Stopping PostgreSQL 12 database server                                                                                       [ OK ]</a>
<a class="sourceLine" id="cb10-20" title="20"></a>
<a class="sourceLine" id="cb10-21" title="21">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb10-22" title="22"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb10-23" title="23"></a>
<a class="sourceLine" id="cb10-24" title="24"><span class="fu">sudo</span> service postgresql start</a>
<a class="sourceLine" id="cb10-25" title="25"><span class="ex">*</span> Starting PostgreSQL 12 database server                                                                                       [ OK ]</a>
<a class="sourceLine" id="cb10-26" title="26"></a>
<a class="sourceLine" id="cb10-27" title="27">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb10-28" title="28"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb10-29" title="29"></a>
<a class="sourceLine" id="cb10-30" title="30"><span class="fu">sudo</span> -u postgres psql</a>
<a class="sourceLine" id="cb10-31" title="31"><span class="ex">psql</span> (12.5 (Ubuntu 12.5-0ubuntu0.20.04.1))</a>
<a class="sourceLine" id="cb10-32" title="32"><span class="ex">Type</span> <span class="st">&quot;help&quot;</span> for help.</a>
<a class="sourceLine" id="cb10-33" title="33"></a>
<a class="sourceLine" id="cb10-34" title="34"><span class="va">postgres=</span># <span class="ex">ALTER</span> USER bryan SUPERUSER<span class="kw">;</span></a>
<a class="sourceLine" id="cb10-35" title="35"><span class="ex">ERROR</span>:  role <span class="st">&quot;bryan&quot;</span> does not exist</a>
<a class="sourceLine" id="cb10-36" title="36"><span class="va">postgres=</span># <span class="ex">ALTER</span> USER postgres SUPERUSER<span class="kw">;</span></a>
<a class="sourceLine" id="cb10-37" title="37"><span class="ex">ALTER</span> ROLE</a>
<a class="sourceLine" id="cb10-38" title="38"><span class="va">postgres=</span># <span class="ex">ALTER</span> USER postgres WITH ENCRYPTED PASSWORD <span class="st">&#39;password&#39;</span></a>
<a class="sourceLine" id="cb10-39" title="39"><span class="ex">postgres-</span>#</a>
<a class="sourceLine" id="cb10-40" title="40"></a>
<a class="sourceLine" id="cb10-41" title="41"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb10-42" title="42"></a>
<a class="sourceLine" id="cb10-43" title="43"><span class="fu">sudo</span> service postgresql start</a>
<a class="sourceLine" id="cb10-44" title="44"><span class="ex">*</span> Starting PostgreSQL 12 database server                                                                                       [ OK ]</a>
<a class="sourceLine" id="cb10-45" title="45"></a>
<a class="sourceLine" id="cb10-46" title="46">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb10-47" title="47"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb10-48" title="48"></a>
<a class="sourceLine" id="cb10-49" title="49"><span class="fu">sudo</span> -u postgres psql</a>
<a class="sourceLine" id="cb10-50" title="50"><span class="ex">psql</span> (12.5 (Ubuntu 12.5-0ubuntu0.20.04.1))</a>
<a class="sourceLine" id="cb10-51" title="51"><span class="ex">Type</span> <span class="st">&quot;help&quot;</span> for help.</a>
<a class="sourceLine" id="cb10-52" title="52"></a>
<a class="sourceLine" id="cb10-53" title="53"><span class="va">postgres=</span># <span class="ex">CREATE</span> USER test_superuser</a>
<a class="sourceLine" id="cb10-54" title="54"><span class="ex">postgres-</span># WITH</a>
<a class="sourceLine" id="cb10-55" title="55"><span class="ex">postgres-</span># PASSWORD</a>
<a class="sourceLine" id="cb10-56" title="56"><span class="ex">postgres-</span># <span class="st">&#39;test&#39;</span></a>
<a class="sourceLine" id="cb10-57" title="57"><span class="ex">postgres-</span># SUPERUSER<span class="kw">;</span></a>
<a class="sourceLine" id="cb10-58" title="58"><span class="ex">CREATE</span> ROLE</a>
<a class="sourceLine" id="cb10-59" title="59"><span class="va">postgres=</span># <span class="ex">CREATE</span> USER test_superuser</a>
<a class="sourceLine" id="cb10-60" title="60"><span class="ex">postgres-</span># WITH</a>
<a class="sourceLine" id="cb10-61" title="61"><span class="ex">postgres-</span># PASSWORD <span class="st">&#39;test&#39;</span></a>
<a class="sourceLine" id="cb10-62" title="62"><span class="ex">postgres-</span># SUPERUSER<span class="kw">;</span></a>
<a class="sourceLine" id="cb10-63" title="63"><span class="ex">ERROR</span>:  role <span class="st">&quot;test_superuser&quot;</span> already exists</a>
<a class="sourceLine" id="cb10-64" title="64"><span class="va">postgres=</span># \<span class="ex">q</span></a>
<a class="sourceLine" id="cb10-65" title="65"></a>
<a class="sourceLine" id="cb10-66" title="66">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb10-67" title="67"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a></code></pre></div>
<blockquote>
<p>Now type the following command to connect to PostgreSQL with the newly-created user. It instructs the client to connect as the user “test_superuser” (-U test_superuser) to the database named “postgres” (postgres) and prompt for the password (-W) for the user.</p>
</blockquote>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" title="1"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb11-2" title="2"></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="ex">psql</span> -W -U test_superuser postgres</a>
<a class="sourceLine" id="cb11-4" title="4"><span class="ex">Password</span>:</a>
<a class="sourceLine" id="cb11-5" title="5"><span class="ex">psql</span>: error: FATAL:  password authentication failed for user <span class="st">&quot;test_superuser&quot;</span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="ex">FATAL</span>:  password authentication failed for user <span class="st">&quot;test_superuser&quot;</span></a>
<a class="sourceLine" id="cb11-7" title="7"></a>
<a class="sourceLine" id="cb11-8" title="8">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="ex">bryan_dir</span>:~_exitstatus:2 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb11-10" title="10"></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="ex">psql</span> -W -U test_superuser postgres</a>
<a class="sourceLine" id="cb11-12" title="12"><span class="ex">Password</span>:</a>
<a class="sourceLine" id="cb11-13" title="13"><span class="ex">psql</span> (12.5 (Ubuntu 12.5-0ubuntu0.20.04.1))</a>
<a class="sourceLine" id="cb11-14" title="14"><span class="ex">SSL</span> connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)</a>
<a class="sourceLine" id="cb11-15" title="15"><span class="ex">Type</span> <span class="st">&quot;help&quot;</span> for help.</a>
<a class="sourceLine" id="cb11-16" title="16"></a>
<a class="sourceLine" id="cb11-17" title="17"><span class="va">postgres=</span>#</a>
<a class="sourceLine" id="cb11-18" title="18"></a>
<a class="sourceLine" id="cb11-19" title="19"></a>
<a class="sourceLine" id="cb11-20" title="20"><span class="ex">psql</span> -W -U test_superuser postgres</a>
<a class="sourceLine" id="cb11-21" title="21"><span class="ex">Password</span>:</a>
<a class="sourceLine" id="cb11-22" title="22"><span class="ex">psql</span> (12.5 (Ubuntu 12.5-0ubuntu0.20.04.1))</a>
<a class="sourceLine" id="cb11-23" title="23"><span class="ex">SSL</span> connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)</a>
<a class="sourceLine" id="cb11-24" title="24"><span class="ex">Type</span> <span class="st">&quot;help&quot;</span> for help.</a>
<a class="sourceLine" id="cb11-25" title="25"></a>
<a class="sourceLine" id="cb11-26" title="26"><span class="va">postgres=</span># <span class="ex">SELECT</span> CURRENT_USER<span class="kw">;</span></a>
<a class="sourceLine" id="cb11-27" title="27">  <span class="ex">current_user</span></a>
<a class="sourceLine" id="cb11-28" title="28"><span class="ex">----------------</span></a>
<a class="sourceLine" id="cb11-29" title="29"> <span class="ex">test_superuser</span></a>
<a class="sourceLine" id="cb11-30" title="30"><span class="kw">(</span><span class="ex">1</span> row<span class="kw">)</span></a>
<a class="sourceLine" id="cb11-31" title="31"></a>
<a class="sourceLine" id="cb11-32" title="32"><span class="va">postgres=</span>#</a>
<a class="sourceLine" id="cb11-33" title="33"></a>
<a class="sourceLine" id="cb11-34" title="34"></a>
<a class="sourceLine" id="cb11-35" title="35"> <span class="ex">test_superuser</span></a>
<a class="sourceLine" id="cb11-36" title="36"><span class="kw">(</span><span class="ex">1</span> row<span class="kw">)</span></a>
<a class="sourceLine" id="cb11-37" title="37"></a>
<a class="sourceLine" id="cb11-38" title="38"><span class="va">postgres=</span># <span class="ex">CREATE</span> USER test_normal_user</a>
<a class="sourceLine" id="cb11-39" title="39"><span class="ex">postgres-</span># WITH</a>
<a class="sourceLine" id="cb11-40" title="40"><span class="ex">postgres-</span># PASSWORD <span class="st">&#39;test&#39;</span></a>
<a class="sourceLine" id="cb11-41" title="41"><span class="ex">postgres-</span># <span class="kw">;</span></a>
<a class="sourceLine" id="cb11-42" title="42"><span class="ex">CREATE</span> ROLE</a>
<a class="sourceLine" id="cb11-43" title="43"><span class="va">postgres=</span># \<span class="ex">q</span></a>
<a class="sourceLine" id="cb11-44" title="44"></a>
<a class="sourceLine" id="cb11-45" title="45">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb11-46" title="46"><span class="ex">bryan_dir</span>:~_exitstatus:0 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb11-47" title="47"></a>
<a class="sourceLine" id="cb11-48" title="48"><span class="ex">psql</span> -U test_normal_user -W postgres</a>
<a class="sourceLine" id="cb11-49" title="49"><span class="ex">Password</span>:</a>
<a class="sourceLine" id="cb11-50" title="50"><span class="ex">psql</span>: error: FATAL:  password authentication failed for user <span class="st">&quot;test_normal_user&quot;</span></a>
<a class="sourceLine" id="cb11-51" title="51"><span class="ex">FATAL</span>:  password authentication failed for user <span class="st">&quot;test_normal_user&quot;</span></a>
<a class="sourceLine" id="cb11-52" title="52"></a>
<a class="sourceLine" id="cb11-53" title="53">\<span class="ex">___________________________________________________</span></a>
<a class="sourceLine" id="cb11-54" title="54"><span class="ex">bryan_dir</span>:~_exitstatus:2 ====<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb11-55" title="55"></a>
<a class="sourceLine" id="cb11-56" title="56"><span class="ex">psql</span> -U test_normal_user -W postgres</a>
<a class="sourceLine" id="cb11-57" title="57"><span class="ex">Password</span>:</a>
<a class="sourceLine" id="cb11-58" title="58"><span class="ex">psql</span> (12.5 (Ubuntu 12.5-0ubuntu0.20.04.1))</a>
<a class="sourceLine" id="cb11-59" title="59"><span class="ex">SSL</span> connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)</a>
<a class="sourceLine" id="cb11-60" title="60"><span class="ex">Type</span> <span class="st">&quot;help&quot;</span> for help.</a>
<a class="sourceLine" id="cb11-61" title="61"></a>
<a class="sourceLine" id="cb11-62" title="62"><span class="va">postgres=</span><span class="op">&gt;</span> <span class="ex">SELECT</span> CURRENT_USER<span class="kw">;</span></a>
<a class="sourceLine" id="cb11-63" title="63">   <span class="ex">current_user</span></a>
<a class="sourceLine" id="cb11-64" title="64"><span class="ex">------------------</span></a>
<a class="sourceLine" id="cb11-65" title="65"> <span class="ex">test_normal_user</span></a>
<a class="sourceLine" id="cb11-66" title="66"><span class="kw">(</span><span class="ex">1</span> row<span class="kw">)</span></a>
<a class="sourceLine" id="cb11-67" title="67"></a>
<a class="sourceLine" id="cb11-68" title="68"><span class="va">postgres=</span><span class="op">&gt;</span> <span class="ex">CREATE</span> USER hacking_the_planet WITH PASSWORD <span class="st">&#39;pwned&#39;</span><span class="kw">;</span></a>
<a class="sourceLine" id="cb11-69" title="69"><span class="ex">ERROR</span>:  permission denied to create role</a>
<a class="sourceLine" id="cb11-70" title="70"><span class="va">postgres=</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb11-71" title="71"></a>
<a class="sourceLine" id="cb11-72" title="72"></a></code></pre></div>
<h2 id="removing-a-user">Removing a user:</h2>
