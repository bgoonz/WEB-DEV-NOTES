(window.webpackJsonp=window.webpackJsonp||[]).push([[155],{"8AuC":function(e,r,t){"use strict";t.d(r,"a",(function(){return a})),t.d(r,"b",(function(){return n})),t.d(r,"c",(function(){return o})),t.d(r,"d",(function(){return i}));const a="inEditorTemplatesPanel",n="open",o=e=>e()[a]===n,i=e=>{e({[a]:null},!0)}},GFmV:function(e,r,t){"use strict";t.d(r,"g",(function(){return p})),t.d(r,"e",(function(){return d})),t.d(r,"b",(function(){return g})),t.d(r,"d",(function(){return b})),t.d(r,"h",(function(){return h})),t.d(r,"c",(function(){return E})),t.d(r,"a",(function(){return f})),t.d(r,"f",(function(){return m}));var a=t("Czhu"),n=t("EfWO"),o=t.n(n),i=t("frZf"),s=t("ViWs");const c="createBlankFabricPage",l="parentPageId",u="spaceKey",p=e=>{const r=e[c];return"string"==typeof r?"true"===r:!!r},d=e=>{const r={};return e[l]&&(r.parentPageId=e[l]),e[u]&&(r.spaceKey=e[u]),r},g=(e,r={})=>({[c]:e||null,[l]:r.parentPageId||null,[u]:r.spaceKey||null}),b=e=>(e=>{const r=e.getBooleanValue("confluence.frontend.fabric.editor.blank.page",{default:!1,shouldTrackExposureEvent:!1}),t=e.getBooleanValue("confluence.frontend.fabric.editor.all-pages",{default:!1,shouldTrackExposureEvent:!1});return r||t})(e)&&Object(s.a)(e),h=(e,r)=>{var t,a,n;if((null!=(n=e)&&null!=(n=n.content)&&null!=(n=n.nodes)&&null!=(n=n[0])&&null!=(n=n.space)?n.key:n)!==r)return!1;if("page"!==(null!=(a=e)&&null!=(a=a.content)&&null!=(a=a.nodes)&&null!=(a=a[0])?a.type:a))return!1;const o=null!=(t=e)&&null!=(t=t.content)&&null!=(t=t.nodes)&&null!=(t=t[0])?t.operations:t;return!!(o&&o.find(e=>"page"===e.targetType&&"create"===e.operation))},E=(e,r)=>({value:e||r,usedOverride:!!e}),f=(e,r)=>{const t=o.a.parse(e,!0);return o.a.format(Object(a.a)(Object(a.a)({},t),{},{search:void 0,query:Object(a.a)(Object(a.a)({},t.query),r)}))},m=e=>{if(!e)throw new Error("No url for new content");return e.startsWith(i.a)?e:`${i.a}${e}`}},"T+Mg":function(e,r,t){"use strict";t.d(r,"a",(function(){return l}));var a=t("Czhu"),n=t("zjfJ"),o=t("ERkP"),i=t.n(o),s=t("lZoD"),c=t("qhEF");function l(e){var r,t;return t=r=class extends o.Component{render(){return i.a.createElement(s.c,{to:[c.a]},r=>i.a.createElement(e,Object(a.a)(Object(a.a)({},this.props),{},{flags:r})))}},Object(n.a)(r,"displayName",`withFlags(${e.displayName||e.name})`),t}},ViWs:function(e,r,t){"use strict";t.d(r,"a",(function(){return n}));let a;!function(e){e.NOT_ENROLLED="not-enrolled",e.IN_EDITOR_TEMPLATES_EXPERIENCE="in-editor-templates-experience",e.DEFAULT_TEMPLATES_EXPERIENCE="default-templates-experience"}(a||(a={}));const n=e=>e.getVariantValue("confluence.frontend.in-editor-templates.phase-1",{default:a.NOT_ENROLLED,oneOf:Object.values(a),shouldTrackExposureEvent:!0})===a.IN_EDITOR_TEMPLATES_EXPERIENCE},Xmxh:function(e,r,t){"use strict";t.r(r);var a=t("ERkP"),n=t.n(a),o=t("T+Mg"),i=t("+mzV"),s=t("Ua4J"),c=t("GFmV"),l=t("Czhu"),u=t("zjfJ"),p=t("L21V"),d=t("X2PC"),g=t("6z9Z"),b=t("3VMZ"),h=t("8TdO"),E=t("F4Ur"),f=t("BX6b"),m=t("8AuC"),y=t("h4hg");const O=Object(p.f)({errorTitle:{id:"create-blank-fabric-page.error.title",description:"title for all error flags created by create-blank-fabric-page",defaultMessage:"We can’t create a page for you"},invalidPermissions:{id:"create-blank-fabric-page.error.invalid-permissions",description:"error message when they cant create in any space",defaultMessage:"You don’t have the right permissions; talk to your admin about adjusting them."},pageCreationError:{id:"create-blank-fabric-page.error.page-creation-error",description:"error message when the page creation endpoint errors or doesnt return a link to follow",defaultMessage:"Refresh the page and try again. If this keeps happening, contact Support."},invalidPermissionsOrNonexistentSpaceError:{id:"create-blank-fabric-page.error.status-403-error",description:"error message when the user encounters a permissions issue while creating a page or tries to create a page in a nonexistent space",defaultMessage:"You no longer have permission to create a page here, or the space has been recently deleted. Contact your space admin so they can troubleshoot the issue."}});var v=t("H5qd"),P=t.n(v);const j=P.a`mutation CreateBlankFabricPageQuery($spaceKey:String!$parentPage:String)@SLA@experimental{experimentalCreateBlankFabricPage(spaceKey:$spaceKey parentPage:$parentPage){links{draftUrl}}}`,k=P.a`mutation CreateFabricBlogpostQuery($spaceKey:String!)@experimental{experimentalCreateFabricBlogpost(spaceKey:$spaceKey){links{draftUrl}}}`,C=P.a`query GetPromotedSpacesQuery($promotedSpaceKey:String)@experimental{experimentalPromotedSpaces(promotedSpacesLimit:1 otherSpacesLimit:1 promotedSpaceKey:$promotedSpaceKey){nodes{id}}}`,w=P.a`query ParentPageQuery($contentId:ID){content(id:$contentId){nodes{id type operations{operation targetType}space{id key}}}}`,T=P.a`query GetSpaceOperationsQuery($spaceKey:String!){space(key:$spaceKey){id operations{operation targetType}}}`;class S extends Error{}const x=Object(p.g)(Object(g.b)(class extends a.PureComponent{constructor(...e){super(...e),Object(u.a)(this,"handleError",e=>{const{flags:r,intl:t,onError:a}=this.props;r.showErrorFlag({title:t.formatMessage(O.errorTitle),description:t.formatMessage(e)}),a()}),Object(u.a)(this,"getTraceIdFromApolloError",e=>{var r,t,a,n;return null===(r=e)||void 0===r||null===(t=r.graphQLErrors)||void 0===t||null===(a=t[0])||void 0===a||null===(n=a.originalError)||void 0===n?void 0:n.traceId}),Object(u.a)(this,"handleCreationError",e=>{const r=this.getTraceIdFromApolloError(e);this.props.experienceTracker.fail({name:b.a.CREATE_PAGE,error:e,attributes:{cteTraceId:r}}),Object(f.c)().submitError(e,{attribution:d.a.TAILORED_EXPERIENCES}),this.handleError(O.pageCreationError)}),Object(u.a)(this,"handlePermissionsError",()=>{this.props.experienceTracker.succeed({name:b.a.CREATE_PAGE}),this.handleError(O.invalidPermissions)}),Object(u.a)(this,"handlePermissionsOrNonexistentSpaceErrorDuringCreation",()=>{this.props.experienceTracker.succeed({name:b.a.CREATE_PAGE}),this.handleError(O.invalidPermissionsOrNonexistentSpaceError)}),Object(u.a)(this,"isApolloGraphQL403Error",e=>{var r,t,a,n,o,i,s;return 403===(null==e||null===(r=e.graphQLErrors)||void 0===r||null===(t=r[0])||void 0===t||null===(a=t.originalError)||void 0===a||null===(n=a.response)||void 0===n?void 0:n.status)||403===(null==e||null===(o=e.graphQLErrors)||void 0===o||null===(i=o[0])||void 0===i||null===(s=i.extensions)||void 0===s?void 0:s.statusCode)}),Object(u.a)(this,"checkSpacePermissions",async e=>{var r;const t={spaceKey:e},a=(null!=(r=(await Object(h.b)().query({query:T,variables:t})).data)&&null!=(r=r.space)?r.operations:r)||[];return{canCreatePage:!!a.find(e=>"create"===e.operation&&"page"===e.targetType),canCreateBlog:!!a.find(e=>"create"===e.operation&&"blogpost"===e.targetType)}}),Object(u.a)(this,"createBlogpost",async e=>{var r;const t=null!=(r=(await Object(h.b)().mutate({mutation:k,variables:e})).data)&&null!=(r=r.experimentalCreateFabricBlogpost)&&null!=(r=r.links)?r.draftUrl:r;return Object(c.f)(t)}),Object(u.a)(this,"createBlankPage",async e=>{var r;const t=null!=(r=(await Object(h.b)().mutate({mutation:j,variables:e})).data)&&null!=(r=r.experimentalCreateBlankFabricPage)&&null!=(r=r.links)?r.draftUrl:r;return Object(c.f)(t)}),Object(u.a)(this,"createContent",async e=>{const{canCreatePage:r,canCreateBlog:t}=await this.checkSpacePermissions(e);if(r){const r=await this.getParentPageIdForCreation(e),t=await this.createBlankPage({spaceKey:e,parentPage:r});return Object(c.a)(t,{[m.a]:m.b})}if(t)return await this.createBlogpost({spaceKey:e});throw new S("Spaces endpoint returned a space without page or blog permissions")}),Object(u.a)(this,"getSpaceKeyForCreation",async()=>{var e;const{currentSpaceKey:r,creationOverrides:t}=this.props,{value:a,usedOverride:n}=Object(c.c)(t.spaceKey,r),o={promotedSpaceKey:a},i=null!=(e=(await Object(h.b)().query({query:C,variables:o})).data)&&null!=(e=e.experimentalPromotedSpaces)&&null!=(e=e.nodes)&&null!=(e=e[0])?e.id:e;if(i){if(n&&i!==a)throw new S("invalid space used as override");return i}throw new S("no spaces for creation")}),Object(u.a)(this,"getParentPageIdForCreation",async e=>{const{currentParentPageId:r,creationOverrides:t}=this.props,{value:a,usedOverride:n}=Object(c.c)(t.parentPageId,r);if(!a)return null;let o;const i=async(r=!1)=>{try{const t={contentId:a},n=(await Object(h.b)().query(Object(l.a)({query:w,variables:t},r?{fetchPolicy:"network-only"}:{}))).data;return Object(c.h)(n,e)}catch(n){var t;return Object(E.a)(n),n.message!==(null===(t=o)||void 0===t?void 0:t.message)&&(this.isApolloGraphQL403Error(n)||Object(f.c)().submitError(n,{attribution:d.a.TAILORED_EXPERIENCES})),o=n,!1}};if(await i()||await i(!0))return a;if(!n)return null;throw new S("invalid parent page used as override")}),Object(u.a)(this,"createBlankFabricPage",async()=>{try{this.props.experienceTracker.start({name:b.a.CREATE_PAGE,attributes:{flow:"createBlankFabricPage"}});const e=await this.getSpaceKeyForCreation(),r=await this.createContent(e);this.props.onSuccess(r),this.props.experienceTracker.succeed({name:b.a.CREATE_PAGE})}catch(e){Object(E.a)(e),e instanceof S?this.handlePermissionsError():this.isApolloGraphQL403Error(e)?this.handlePermissionsOrNonexistentSpaceErrorDuringCreation():this.handleCreationError(e)}})}componentDidMount(){this.createBlankFabricPage()}render(){return n.a.createElement(y.a,null)}}));var I=t("1U1M");const K=({currentSpaceKey:e})=>{var r;const{data:t}=Object(I.d)(C,{variables:{promotedSpaceKey:e}}),a=(null!=(r=t)&&null!=(r=r.experimentalPromotedSpaces)&&null!=(r=r.nodes)&&null!=(r=r[0])?r.id:r)||"";return Object(I.d)(T,{variables:{spaceKey:a},skip:!a}),null};t.d(r,"CreateBlankFabricPageListener",(function(){return A}));const F=({flags:e})=>{const{setQueryParams:r,getQueryParams:t,push:o}=Object(a.useContext)(s.a),{spaceKey:l,contentId:u}=Object(a.useContext)(i.a),p=Object(a.useCallback)(()=>{r(Object(c.b)(!1,{}),!0)},[r]),d=Object(a.useCallback)(e=>{p(),o(e)},[o,p]),g=t(),b=Object(c.e)(g),h=Object(c.g)(g);return n.a.createElement(a.Fragment,null,n.a.createElement(K,{currentSpaceKey:l}),h&&n.a.createElement(x,{flags:e,currentSpaceKey:l,currentParentPageId:"string"==typeof u?u:null,creationOverrides:b,onError:p,onSuccess:d}))},A=Object(o.a)(Object(a.memo)(F))},h4hg:function(e,r,t){"use strict";t.d(r,"a",(function(){return p}));var a=t("ERkP"),n=t.n(a),o=t("KsTJ"),i=t("lRcl"),s=t("BMbf"),c=t("3IV/");const l=o.default.div`
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: ${s.i.blanket()+1};
`,u=o.default.div`
  z-index: ${s.i.blanket};
  height: 100%;
  width: 100%;
  position: fixed;
  left: 0;
  top: 0;
  background-color: ${c.N0};
  opacity: 0.54;
  transition: opacity 0.2s;
  transition-delay: 0.1s;
`,p=()=>n.a.createElement(a.Fragment,null,n.a.createElement(l,null,n.a.createElement(i.a,{size:26})),n.a.createElement(u,null))}}]);
//# sourceMappingURL=155.JPzgGM4Na4.js.map
