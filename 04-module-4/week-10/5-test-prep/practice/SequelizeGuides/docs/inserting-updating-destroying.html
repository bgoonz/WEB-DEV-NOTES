<h1 id="model.findorcreate">Model.findOrCreate</h1>
<p><a href="http://docs.sequelizejs.com/manual/tutorial/models-usage.html#-findorcreate-search-for-a-specific-element-or-create-it-if-not-available">Official Docs</a></p>
<p>Finds an instance that matches the specified query. If no such instance exists, it will create one. This method is a little funny - it returns a promise for an array! The first element of the array is the instance. The second element is a boolean (true or false), which will be true if the instance was newly created, and false if it wasn’t (that is, an existing match was found).</p>
<p>In the example below, assume we do not have any existing row in our pugs table with the name ‘Cody’.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">const</span> arr <span class="op">=</span> <span class="cf">await</span> <span class="va">Pug</span>.<span class="at">findOrCreate</span>(<span class="op">{</span><span class="dt">where</span><span class="op">:</span> <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Cody&#39;</span><span class="op">}}</span>)  </a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">const</span> instance <span class="op">=</span> arr[<span class="dv">0</span>] <span class="co">// the first element is the instance</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">const</span> wasCreated <span class="op">=</span> arr[<span class="dv">1</span>] <span class="co">// the second element tells us if the instance was newly created</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="va">console</span>.<span class="at">log</span>(instance) <span class="co">// {id: 1, name: &#39;Cody&#39;, etc...}</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="va">console</span>.<span class="at">log</span>(wasCreated) <span class="co">// true</span></a>
<a class="sourceLine" id="cb1-7" title="7"></a>
<a class="sourceLine" id="cb1-8" title="8"></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="co">// now if we findOrCreate a second time...</span></a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="kw">const</span> arr2 <span class="op">=</span> <span class="va">Pug</span>.<span class="at">findOrCreate</span>(<span class="op">{</span><span class="dt">where</span><span class="op">:</span> <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Cody&#39;</span><span class="op">}}</span>) </a>
<a class="sourceLine" id="cb1-12" title="12"><span class="kw">const</span> instance <span class="op">=</span> arr2[<span class="dv">0</span>]</a>
<a class="sourceLine" id="cb1-13" title="13"><span class="kw">const</span> wasCreated <span class="op">=</span> arr2[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb1-14" title="14"><span class="va">console</span>.<span class="at">log</span>(instance) <span class="co">// {id: 1, name: &#39;Cody&#39;, etc...}</span></a>
<a class="sourceLine" id="cb1-15" title="15"><span class="va">console</span>.<span class="at">log</span>(wasCreated) <span class="co">// false -&gt; the query found an existing pug that matched the query</span></a></code></pre></div>
<p>It’s often preferably to handle with a promise for an array using destructuring assignment:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">const</span> [instance<span class="op">,</span> wasCreated] <span class="op">=</span> <span class="cf">await</span> <span class="va">Pug</span>.<span class="at">findOrCreate</span>(<span class="op">{</span><span class="dt">where</span><span class="op">:</span> <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Cody&#39;</span><span class="op">}}</span>)</a></code></pre></div>
<p>For other examples of this pattern: http://es6-features.org/#ParameterContextMatching</p>
<h1 id="new-model">new Model()</h1>
<p>Creates a temporary instance. Returns the instance. This instance is NOT yet saved to the database!</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">const</span> cody <span class="op">=</span> <span class="kw">new</span> <span class="at">Pug</span>(<span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Cody&#39;</span><span class="op">}</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="va">console</span>.<span class="at">log</span>(cody) <span class="co">// we can start using cody right away...but cody is NOT in our db yet</span></a></code></pre></div>
<p><strong>Note:</strong> This operation is synchronous - you should not use the <code>await</code> keyword.</p>
<h2 id="model.build">Model.build</h2>
<p>Same as above (with alternative syntax) - creates a temporary, unsaved instance.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">const</span> cody <span class="op">=</span> <span class="va">Pug</span>.<span class="at">build</span>(<span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Cody&#39;</span><span class="op">}</span>)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="va">console</span>.<span class="at">log</span>(cody) <span class="co">// we can start using cody right away...but cody is NOT in our db yet</span></a></code></pre></div>
<p><strong>Note:</strong> This operation is synchronous - you should not use the <code>await</code> keyword.</p>
<h1 id="model.create">Model.create</h1>
<p>Creates and saves a new row to the database. Returns a promise for the created instance.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">const</span> cody <span class="op">=</span> <span class="cf">await</span> <span class="va">Pug</span>.<span class="at">create</span>(<span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Cody&#39;</span><span class="op">}</span>)</a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">// now, cody is saved in our database</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="va">console</span>.<span class="at">log</span>(cody)</a></code></pre></div>
<h1 id="model.update">Model.update</h1>
<p>Updates all instances that match a query. Takes two parameters: the first parameter contains the info you want to update. The second parameter contains the query for which instances to update.</p>
<p>Like <code>findOrCreate</code>, it returns a promise for an array. The first element of the array is the number of rows that were affected. The second element of the array is the affected rows themselves.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="co">// update all pugs whose age is 7 to have an adoptedStatus of true</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co">// because we return a promise for an array, destructuring is recommended</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">const</span> [numberOfAffectedRows<span class="op">,</span> affectedRows] <span class="op">=</span> <span class="cf">await</span> <span class="va">Pug</span>.<span class="at">update</span>(<span class="op">{</span> </a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="dt">adoptedStatus</span><span class="op">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="op">},</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-6" title="6">  <span class="dt">where</span><span class="op">:</span> <span class="op">{</span><span class="dt">age</span><span class="op">:</span> <span class="dv">7</span><span class="op">},</span></a>
<a class="sourceLine" id="cb6-7" title="7">  <span class="dt">returning</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="co">// needed for affectedRows to be populated</span></a>
<a class="sourceLine" id="cb6-8" title="8">  <span class="dt">plain</span><span class="op">:</span> <span class="kw">true</span> <span class="co">// makes sure that the returned instances are just plain objects</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb6-10" title="10"></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="va">console</span>.<span class="at">log</span>(numberOfAffectedRows) <span class="co">// say we had 3 pugs with the age of 7. This will then be 3</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="va">console</span>.<span class="at">log</span>(affectedRows) <span class="co">// this will be an array of the three affected pugs</span></a></code></pre></div>
<h1 id="model.destroy">Model.destroy</h1>
<p>Destroys all instances that match a query. It returns a promise for the number of rows that were deleted.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">const</span> numAffectedRows <span class="op">=</span> <span class="cf">await</span> <span class="va">Pug</span>.<span class="at">destroy</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="dt">where</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb7-3" title="3">    <span class="dt">age</span><span class="op">:</span> <span class="dv">7</span> <span class="co">// deletes all pugs whose age is 7</span></a>
<a class="sourceLine" id="cb7-4" title="4">  <span class="op">}</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="op">}</span>)</a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="va">console</span>.<span class="at">log</span>(numAffectedRows) <span class="co">// if we had 3 pugs with the age of 7, this will be 3</span></a></code></pre></div>
<hr />
<h1 id="using-instances">Using Instances</h1>
<h2 id="instance.save-and-instance.update">instance.save and instance.update</h2>
<p><a href="http://docs.sequelizejs.com/manual/tutorial/instances.html#updating-saving-persisting-an-instance">Official Docs</a></p>
<p>If we already have an instance, we can save changes with either instance.save or instance.update</p>
<p>Both returns promises for the saved/updated instance</p>
<p>Here’s an example using save:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="co">// we already have a pug instance, which we&#39;ve put in a variable called cody</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="va">console</span>.<span class="at">log</span>(<span class="va">cody</span>.<span class="at">age</span>) <span class="co">// 7</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="va">cody</span>.<span class="at">age</span> <span class="op">=</span> <span class="dv">8</span> <span class="co">// we can change the age to 8 (but it isn&#39;t saved in the database yet)</span></a>
<a class="sourceLine" id="cb8-4" title="4">cody <span class="op">=</span> <span class="cf">await</span> <span class="va">cody</span>.<span class="at">save</span>() <span class="co">// we can use .save to actually save to the database</span></a>
<a class="sourceLine" id="cb8-5" title="5"></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="va">console</span>.<span class="at">log</span>(<span class="va">cody</span>.<span class="at">age</span>) <span class="co">// 8</span></a></code></pre></div>
<p>Here’s another example using update:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="va">console</span>.<span class="at">log</span>(<span class="va">cody</span>.<span class="at">age</span>) <span class="co">// 7</span></a>
<a class="sourceLine" id="cb9-2" title="2">cody <span class="op">=</span> <span class="cf">await</span> <span class="va">cody</span>.<span class="at">update</span>(<span class="op">{</span><span class="dt">age</span><span class="op">:</span> <span class="dv">8</span><span class="op">}</span>)</a>
<a class="sourceLine" id="cb9-3" title="3">  </a>
<a class="sourceLine" id="cb9-4" title="4"><span class="va">console</span>.<span class="at">log</span>(<span class="va">cody</span>.<span class="at">age</span>) <span class="co">// 8  </span></a></code></pre></div>
<h2 id="instance.destroy">instance.destroy</h2>
<p><a href="http://docs.sequelizejs.com/manual/tutorial/instances.html#destroying-deleting-persistent-instances">Official Docs</a></p>
<p>If we want to remove an individual instance from the database, we can use instance.destroy. It returns a promise that will be resolved when the row is removed from the database. (The promise itself does not resolve to anything in particular though - it’s always just an empty array)</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="co">// no need to expect the promise to resolve to any useful value</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="cf">await</span> <span class="va">cody</span>.<span class="at">destroy</span>() <span class="co">// no! bye Cody!</span></a>
<a class="sourceLine" id="cb10-3" title="3">  </a>
<a class="sourceLine" id="cb10-4" title="4"><span class="co">// now the cody row is no longer in the database  </span></a></code></pre></div>
