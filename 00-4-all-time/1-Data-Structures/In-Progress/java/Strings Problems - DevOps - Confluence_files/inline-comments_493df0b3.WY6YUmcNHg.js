/*! License: 8bRtoavonx.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([["inline-comments~493df0b3"],{"+CY+":function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n("zjfJ"),r=n("ERkP"),o=(n("aWzz"),n("+Aie")),a=n.n(o),s=n("+xfv"),c=n("5Asb");const l={},d=a.a.prototype.stopCallback;a.a.prototype.stopCallback=function(e,t,n){return!!!c.d.map(e=>t.classList.contains(e)).find(e=>e)&&d.call(this,e,t,n)};class u extends r.PureComponent{constructor(...e){super(...e),Object(i.a)(this,"listeners",{}),Object(i.a)(this,"lastFired",0),Object(i.a)(this,"_call",e=>{const t=+new Date;t-this.lastFired>=150&&!Object(s.a)()&&(this.lastFired=t,this.props.listener(e))})}componentDidMount(){const{accelerator:e}=this.props;l[e],l[e]=!0,a.a.bind(e,this._call)}componentWillUnmount(){const{accelerator:e}=this.props;delete l[e],a.a.unbind(e)}render(){return null}}},"+xfv":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));const i=()=>{const e=[...document.getElementsByClassName("atlaskit-portal")].filter(e=>e.firstChild);return Boolean(e.filter(e=>e.querySelectorAll('[role="dialog"]').length).length)}},"/yy9":function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return o}));const i=100,r=350,o=700},"03Pf":function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return l}));var i=n("daKX");const r=Object(i.a)("scroll-to-element"),o=new Set;function a(e){return o.add(e),()=>o.delete(e)}function s(){o.forEach(e=>{try{e()}catch(t){Promise.all([n.e("monitoring~60420017").then(n.bind(null,"fFmz")),Promise.all([n.e("atlaskit~66e23772"),n.e("vendors~4134d62c"),n.e("error-boundary~b59ad437")]).then(n.bind(null,"fEZm"))]).then(([{getMonitoringClient:e},{Attribution:n}])=>{e().submitError(t,{attribution:n.CONTENT_EXPERIENCE})}).catch(()=>{})}})}function c(){s(),window.scrollTo(0,0)}function l(e,t){let n=0,i=e.offsetParent;for(;i instanceof HTMLElement;)n+=i.offsetTop,i=i.offsetParent;const o=e.offsetTop+(t||0)+n;s();try{window.scroll({top:o,behavior:"auto"})}catch(a){r.error`window.scroll() is not supported`}}},"0gjq":function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.bindAll=void 0;var r=n("FzbR");function o(e){if(void 0!==e)return"boolean"==typeof e?{capture:e}:e}t.bindAll=function(e,t,n){var a=t.map((function(t){var a=function(e,t){return null==t?e:i(i({},e),{options:i(i({},o(t)),o(e.options))})}(t,n);return r.bind(e,a)}));return function(){a.forEach((function(e){return e()}))}}},"1GbL":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("H5qd");const r=n.n(i).a`query PageInfoQuery($pageId:ID){content(id:$pageId){nodes{id type space{id}operations{operation targetType}}}}`},"1jzs":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("ERkP");const r="undefined"==typeof window?i.useEffect:i.useLayoutEffect},"3ZcK":function(e,t,n){"use strict";n.d(t,"a",(function(){return I}));var i=n("Czhu"),r=n("ERkP"),o=n.n(r),a=n("1U1M"),s=n("z9P0"),c=n("6z9Z"),l=n("3VMZ"),d=n("8Kf2"),u=n("QqfF"),m=n("zCQI"),h=n("g92I"),p=n("Ga4t"),f=n("mAAb"),g=n("wpph"),b=n("j9Fr"),v=n("zvRN"),y=n("DHFp"),E=n("r7Rc"),C=n("PhMJ");const I=({pageId:e,pageType:t,spaceId:n,isFabricPage:I,isReply:O,userId:w,parentId:T,onNewCommentSuccess:k,shouldShowReplyEditor:N,lastFetchTime:j,isViewAllMode:M})=>{const[R,x]=Object(r.useState)(!1),[S]=Object(a.c)(b.a,{refetchQueries:[{query:E.a,variables:{pageId:e}}]}),[A]=Object(a.c)(v.a,{refetchQueries:[{query:E.a,variables:{pageId:e}}]}),{onChange:D,resetContentChanged:_}=Object(r.useContext)(u.a),{newCommentHighlight:P,clearCreateHighlight:$}=Object(r.useContext)(m.a),{createAnalyticsEvent:L}=Object(s.a)(),F=Object(r.useContext)(c.a);Object(r.useEffect)(()=>{O&&!N&&x(!0)},[T,O,N]);const H=t=>{const{errorId:n,message:i}=Object(C.k)(t),r=Object(C.j)(i);return i===f.a.FAILED_TO_INSERT_MARK||i===f.a.INVALID_SELECTION?(((t,n)=>{const i={errorMessage:n,editor:"FABRIC",framework:f.b.REACT,errorId:t},r=new Range,o=document.querySelector("."+C.b);if(o){r.selectNode(o);const t=document.getSelection();if(t){t.removeAllRanges(),t.addRange(r);const n=Object(h.c)(document.querySelector("#content"),t.getRangeAt(0),e);i.matchTrace=JSON.stringify(n)}}L({type:"sendOperationalEvent",data:{source:"viewPage",objectType:"page",objectId:e,action:"invalid",actionSubject:"highlight",actionSubjectId:"inlineComment",attributes:i}}).fire()})(n,i),Promise.reject({error:r})):(F.stopOnError({error:t,name:O?l.a.REPLY_TO_INLINE_COMMENT_PUBLISH:l.a.ADD_INLINE_COMMENT_PUBLISH}),Promise.reject({error:r}))},V=t=>{if(O)return{containerId:e,parentCommentId:T,commentBody:{value:JSON.stringify(t),representationFormat:"ATLAS_DOC_FORMAT"}};if(!j||!P)throw new Error("Invalid variable input for 'create' comment");const{numMatches:n,matchIndex:i,selectedText:r}=P;return{containerId:e,commentBody:{value:JSON.stringify(t),representationFormat:"ATLAS_DOC_FORMAT"},numMatches:n,matchIndex:i,originalSelection:r.replace(/\n/g,""),createdFrom:"RENDERER",lastFetchTimeMillis:j}},B=({id:i})=>{L({type:"sendTrackEvent",data:{containerType:"space",containerId:n,source:"viewPageScreen",objectType:"page",objectId:e,action:"created",actionSubject:"comment",actionSubjectId:i,attributes:{commentType:"inline",pageType:t,parentCommentId:T,framework:"REACT"}}}).fire()};return o.a.createElement(g.a,{isReply:O,"data-testid":"inline-comment-create-container"},o.a.createElement(p.a,{size:O?"small":"medium",mode:O?"reply":"create",userId:w}),o.a.createElement(d.a,{pageId:e,pageType:t,spaceId:n,appearance:"chromeless",commentMode:O?"reply":"create",showCancelButton:M||O,onSaveComment:(t,n)=>{let r,o;F.start({name:O?l.a.REPLY_TO_INLINE_COMMENT_PUBLISH:l.a.ADD_INLINE_COMMENT_PUBLISH});try{r=O?A:S,o={variables:{input:V(t)},update:(t,{data:n})=>{var i;const r=(null===(i=t.readQuery({query:y.b,variables:{pageId:e}}).comments)||void 0===i?void 0:i.nodes)||[];if(O){var o;const e=r.find(e=>(null==e?void 0:e.id)===T);null==e||null===(o=e.replies)||void 0===o||o.push(n.replyInlineComment)}else r.push(n.createInlineComment);t.writeQuery({query:y.b,variables:{pageId:e},data:{comments:{nodes:[...r],__typename:"PaginatedCommentList"}}})}}}catch(a){return H(a)}return r(Object(i.a)({},o)).then(({data:e})=>(n(),(e=>{if(O){const{replyInlineComment:t}=e;B(t),k&&k(),F.succeed({name:l.a.REPLY_TO_INLINE_COMMENT_PUBLISH})}else{const{createInlineComment:t}=e,n=t.location.inlineMarkerRef;if(!n)return H(new Error("Can't make the mark on the DOM permanent"));Object(C.f)(I,n),B(t),F.succeed({name:l.a.ADD_INLINE_COMMENT_PUBLISH}),k&&k(n)}})(e))).catch(e=>H(e))},onCancelComment:M?()=>{_(),Object(C.m)(),$()}:()=>{_()},useNewWarningModal:!0,onEditorReady:()=>{O||_(),F.succeed({name:O?l.a.REPLY_TO_INLINE_COMMENT_LOAD:l.a.ADD_INLINE_COMMENT_LOAD})},isViewMode:!0,onContentChange:()=>{D()},shouldResetEditor:R,onEditorReset:()=>{x(!1)},expandEditor:N,shouldWarnOnInternalNavigation:!0,hideWatchCheckbox:!0}))}},"4LHq":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));const i="confluence.frontend.global-perms-view-user-profile"},"5Asb":function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return o})),n.d(t,"d",(function(){return a}));const i={PUBLISH:"mod+enter",PUBLISH_WITH_COMMENT:"mod+shift+enter",EDIT:"e",PREVIEW:"mod+shift+e"},r="mod+s",o="shortcuts-are-allowed",a=["ProseMirror-focused",o]},"96U/":function(e,t,n){"use strict";var i=n("ERkP"),r=n.n(i),o=n("7nmT"),a=n.n(o),s=n("Jygk"),c=n.n(s),l=n("KIs4"),d=n("Vgb+"),u=n("zjfJ"),m=n("aWzz"),h=n.n(m),p=n("uDfI"),f=n("gwLK"),g=n("lZoD"),b=n("kD2R"),v=n("nWyW"),y=n("8TdO"),E=n("JxFu"),C=n("DQZQ"),I=n("7a7X"),O=n("y9AH"),w=n("cptV"),T=n("FuAq"),k=n("M5Dj"),N=n("9m+Y"),j=n("w7pu"),M=n("6z9Z"),R=n("hpu0"),x=n("HEM+"),S=n("lPJD"),A=n("gScn"),D=n("ewfN"),_=n("cphC"),P=n("r9hL"),$=n("d3tz"),L=n("gHio"),F=n.n(L),H=n("L21V"),V=n("3IV/"),B=n("KsTJ");const U=B.default.div`
  display: flex;
  background-color: ${V.P300};
  border-radius: 5px;
  align-items: center;
  overflow: hidden;
  height: ${({isOpen:e})=>e?50:0}px;
  transition: height 0.25s linear;
`,z=B.default.p`
  flex-grow: 1;
  color: ${"white"};
  text-align: center;
`,q=B.default.button`
  flex: 0 0 auto;
  appearance: none;
  background: none;
  border: none;
  color: ${"white"};
  cursor: pointer;

  &:focus {
    outline: none;
  }
`;class G extends i.Component{constructor(...e){super(...e),Object(u.a)(this,"onDismiss",e=>{const{onDismiss:t}=this.props;e.stopPropagation(),e.preventDefault(),t()})}render(){const{isOpen:e}=this.props;return r.a.createElement(U,{isOpen:e},r.a.createElement(z,null,r.a.createElement(H.a,{id:"changeboarding.dnd.pagetree.spacesettings.banner"})),r.a.createElement(q,{onClick:this.onDismiss},r.a.createElement(F.a,null)))}}var W;let Y=Object(P.a)($.a.CHANGEBOARDING)(W=class extends i.Component{constructor(...e){super(...e),Object(u.a)(this,"state",{isOpen:!1}),Object(u.a)(this,"onDismiss",()=>{const{triggerAnalytics:e,stop:t}=this.props;this.setState({isOpen:!1}),e("reorderpages-banner-dismissed"),t()})}UNSAFE_componentWillMount(){this.el=c.a.document.getElementById("reorderpages-changeboarding-react-portal-placeholder")}componentDidMount(){setTimeout(()=>{this.setState({isOpen:!0})},200)}render(){const{isOpen:e}=this.state;return this.el?a.a.createPortal(r.a.createElement(G,{isOpen:e,onDismiss:this.onDismiss}),this.el):null}})||W;var K;let Q=Object(_.a)(K=Object(A.a)(K=class extends i.Component{constructor(...e){super(...e),Object(u.a)(this,"shouldShowSpaceSettingChangeboarding",()=>this.isOnReorderPages()),Object(u.a)(this,"isOnReorderPages",()=>{const{matchRoute:e,location:t}=this.props,n=e(t.pathname+t.search);return n&&n.name===D.SPACE_SETTINGS_REORDERPAGES.name})}render(){const{coordinationClient:e}=this.props;return this.shouldShowSpaceSettingChangeboarding()?r.a.createElement(S.a,{client:e,messageId:"confluence-dragdrop-spacesettings-banner"},r.a.createElement(Y,null)):null}})||K)||K;class J extends i.Component{render(){return r.a.createElement(l.a,null,({featureFlags:e})=>r.a.createElement(Q,{featureFlags:e}))}}class X extends i.Component{constructor(...e){super(...e),Object(u.a)(this,"browserHistory",Object(T.a)())}getChildContext(){const{context:e}=this.props;return{insertCss:e.insertCss||(()=>{})}}render(){const{store:e}=this.props;return r.a.createElement(g.b,null,r.a.createElement(f.b,{client:Object(y.b)()},r.a.createElement(p.Provider,{store:e},r.a.createElement(j.b,null,r.a.createElement(M.a.Provider,{value:Object(R.b)()},r.a.createElement(N.a,null,r.a.createElement(E.a,null,r.a.createElement(C.a,null,r.a.createElement(x.a,null,r.a.createElement(b.ConnectedRouter,{history:this.browserHistory},r.a.createElement(i.Fragment,null,r.a.createElement(w.a,null),r.a.createElement(k.a,null),r.a.createElement(v.a,null),r.a.createElement(I.a,{namedRoutes:O.a},this.props.children,r.a.createElement(J,null)))))))))))))}}Object(u.a)(X,"childContextTypes",{insertCss:h.a.func.isRequired});var Z=n("AeT/"),ee=n("Al9w");const te=Object(Z.a)({isServerRenderedPage:!0});Object(ee.a)(te);const ne={insertCss:e=>e._insertCss()};t.a=(e,t,n=!1)=>{"string"==typeof t&&(t=c.a.document.getElementById(t)),Object(l.b)().then(i=>{a.a.render(r.a.createElement(d.a.Provider,{value:i},r.a.createElement(X,{store:te,context:ne,renderAsRoot:n},e)),t)})}},"9LlU":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("ERkP");const r=n.n(i).a.createContext(void 0);r.displayName="ExperienceContext"},A46D:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o}));const i="cubic-bezier(0.15,1,0.3,1)",r="cubic-bezier(0.2,0,0,1)",o="cubic-bezier(0.8,0,0,0.8)"},Cwwk:function(e,t,n){"use strict";var i=n("+6Tk"),r=n("4LHq"),o=n("Czhu"),a=n("1U1M"),s=n("b/OQ");const c=e=>e&&e.globalOperations&&e.globalOperations.length>0?e.globalOperations:[];n.d(t,"a",(function(){return l}));const l=()=>{if(!Object(i.a)(r.a))return!0;const{data:e,error:t}=(()=>{const{loading:e,data:t,error:n}=Object(a.d)(s.a,{errorPolicy:"all",fetchPolicy:"cache-first"});if(n)return{data:[],error:n};const i={data:[],error:null};return e?i:Object(o.a)(Object(o.a)({},i),{},{data:c(t)})})();return!!t||!!(e&&e.length>0&&e.some(e=>e&&"read"===e.operation&&"userProfile"===e.targetType))}},DHFp:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return s}));var i=n("H5qd"),r=n.n(i),o=n("ACfX");const a=r.a`query InlineCommentsQuery($pageId:ID!){comments(pageId:$pageId type:UNRESOLVED depth:ROOT){nodes{...inlineCommentFragment replies{...inlineCommentFragment}}}}${o.b}`,s=r.a`query AnonymousInlineCommentsQuery($pageId:ID!){comments(pageId:$pageId type:UNRESOLVED depth:ROOT){nodes{...anonymousInlineCommentFragment replies{...anonymousInlineCommentFragment}}}}${o.a}`},DL3M:function(e,t,n){var i=n("y4bl");e.exports=function(e,t,n){return null==e?e:i(e,t,n)}},DSvr:function(e,t){e.exports=function(e,t){t=t||{};var n,i,r,o=e.ownerDocument||e,a=[],s=[],c=function(e){var t=[];return function(n){if(n===e.documentElement)return!1;var i=e.defaultView.getComputedStyle(n);return!!function n(i,r){if(i===e.documentElement)return!1;for(var o=0,a=t.length;o<a;o++)if(t[o][0]===i)return t[o][1];var s=!1;return"none"===(r=r||e.defaultView.getComputedStyle(i)).display?s=!0:i.parentNode&&(s=n(i.parentNode)),t.push([i,s]),s}(n,i)||"hidden"===i.visibility}}(o),l=["input","select","a[href]","textarea","button","[tabindex]"],d=e.querySelectorAll(l.join(","));if(t.includeContainer){var u=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;l.some((function(t){return u.call(e,t)}))&&(d=Array.prototype.slice.apply(d)).unshift(e)}for(var m=0,h=d.length;m<h;m++)n=d[m],i=parseInt(n.getAttribute("tabindex"),10),(r=isNaN(i)?n.tabIndex:i)<0||"INPUT"===n.tagName&&"hidden"===n.type||n.disabled||c(n,o)||(0===r?a.push(n):s.push({index:m,tabIndex:r,node:n}));var p=s.sort((function(e,t){return e.tabIndex===t.tabIndex?e.index-t.index:e.tabIndex-t.tabIndex})).map((function(e){return e.node}));return Array.prototype.push.apply(p,a),p}},FzbR:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bind=void 0,t.bind=function(e,t){var n=t.type,i=t.listener,r=t.options;return e.addEventListener(n,i,r),function(){e.removeEventListener(n,i,r)}}},HMAF:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n("ERkP")),r=o(n("4KTy"));function o(e){return e&&e.__esModule?e:{default:e}}function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var s=function(e){return i.default.createElement(r.default,a({dangerouslySetGlyph:'<svg width="24" height="24" viewBox="0 0 24 24" focusable="false" role="presentation"><path d="M11.221 9.322l-2.929 2.955a1.009 1.009 0 0 0 0 1.419.986.986 0 0 0 1.405 0l2.298-2.317 2.307 2.327a.989.989 0 0 0 1.407 0 1.01 1.01 0 0 0 0-1.419l-2.94-2.965A1.106 1.106 0 0 0 11.991 9c-.279 0-.557.107-.77.322z" fill="currentColor" fill-rule="evenodd"/></svg>'},e))};s.displayName="ChevronUpIcon";var c=s;t.default=c},HYLC:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("daKX"),r=n("0nUU");const o=Object(i.a)("browser-metrics"),a=e=>{if(!e)return o.error`metricKey is falsy.`,null;const t=r.d[e];return t||(o.error`${e} has not been configured`,null)}},I4sB:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n("NCwY");class r{constructor(e,t){this.min=e,this.max=t}get description(){return`length must be between ${this.min} and ${this.max}`}isValid(e){return!e||e.length>=this.min&&e.length<=this.max}}t.LengthConstraint=r;class o{constructor(e){this.regex=e}get description(){return"value must match regex "+this.regex.source}isValid(e){return!e||this.regex.test(e)}}t.RegexConstraint=o;t.GeneralValidationError=class{constructor(e){this.error=e}toString(){return this.error}};class a{constructor(e,t,n){this.fieldName=e,this.value=t,this.constraints=n}toString(){const e=this.constraints.map(e=>"  - "+e.description).join("\n");return`'${this.value}' is not a valid value for ${this.fieldName} as it violates the following constraints:\n${e}`}}t.ConstraintViolation=a,t.lengthBetween=function(e,t){return new r(e,t)},t.pattern=function(e){return new o(e)},t.validateField=function(e,t,n){const r=e[t],o=n.map(e=>e.isValid(r)?void 0:e).filter(i.isDefined);return o.length>0?new a(t,r,o):void 0}},JGEE:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n("ERkP"),r=n("Ua4J");const o=()=>{const{getQueryParams:e}=Object(i.useContext)(r.a),{focusedCommentId:t,editComment:n,commentId:o,replyToComment:a,showCommentArea:s}=e();return{focusedCommentId:t||void 0,editCommentId:n&&"true"===n&&o?o:void 0,replyToCommentId:a||void 0,shouldOpenNewCommentEditor:"true"===s}}},KYhD:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var i=n("Czhu"),r=n("ERkP"),o=n.n(r),a=n("1U1M"),s=n("L21V"),c=n("XFpn"),l=n.n(c),d=n("3IV/"),u=n("WEdt"),m=n("3D57"),h=n("wpph"),p=n("r7Rc"),f=n("uIWc");const g=Object(s.f)({resolvedCommentDescription:{id:"inline-comments.resolved-comment-description",description:"Message to be displayed when user Resolves a comment",defaultMessage:"You can view all the comments from the More actions menu."},resolvedCommentTitle:{id:"inline-comments.resolved-comment-title",description:"Title to be displayed when user Resolves a comment",defaultMessage:"Comment Resolved"},resolvedCommentLabel:{id:"inline-comments.resolved-comment-label",description:"Label to be displayed when user Resolves a comment",defaultMessage:"Comment Resolved"}}),b=({commentId:e,reopenComment:t,pageId:n})=>{const[c]=Object(a.c)(m.a,{refetchQueries:[{query:p.a,variables:{pageId:n}}]}),[b,v]=Object(r.useState)(null),y=Object(r.useCallback)(n=>{n.preventDefault();const r={variables:{commentId:e,resolved:!1}};c(Object(i.a)({},r)).then(()=>{t()}).catch(e=>{v(e)})},[e,t,c]);return o.a.createElement(r.Fragment,null,o.a.createElement(h.i,null,o.a.createElement(s.b,Object(i.a)({},g.resolvedCommentLabel),e=>o.a.createElement(l.a,{size:"xlarge",primaryColor:d.G400,label:e})),o.a.createElement(h.j,{mixin:Object(u.h400)()},o.a.createElement(s.b,Object(i.a)({},g.resolvedCommentTitle))),o.a.createElement(s.b,Object(i.a)(Object(i.a)({},g.resolvedCommentDescription),{},{tagName:"p"})),o.a.createElement("a",{onClick:y},o.a.createElement(s.b,{id:"inline-comments.undo-resolved-comment",defaultMessage:"Undo resolved comment",description:"Undo Resolved comment"}))),b&&o.a.createElement(f.a,{error:b,action:"reopen"}))}},KuFb:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n("7+Q0");const r={[i.b.DEFAULT]:"full-page",[i.b.FULL_WIDTH]:"full-width"},o=e=>{const t=r[e];return t||a()},a=()=>r[i.b.DEFAULT]},LPS5:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("H5qd");const r=n.n(i).a`query CommentButtonQuery($pageId:ID!){comments(pageId:$pageId type:UNRESOLVED depth:ALL){count nodes{id location{type ...on InlineComment{inlineMarkerRef}}}}}`},Licu:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("H5qd"),r=n.n(i),o=n("j+hl");const a=r.a`query ContentRendererQuery($contentId:ID$status:[String]){content(id:$contentId status:$status){nodes{id body{atlas_doc_format{value}}space{id key}type ...contentAppearancePublishedFragment}}}${o.b}`},"M/rd":function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("Czhu"),r=n("ERkP"),o=n.n(r),a=n("xBue"),s=n("Ua4J");const c=Object(r.forwardRef)(({children:e,className:t,target:n,testId:c,name:l,href:d=null,to:u=null,params:m={},onClick:h=(()=>{})},p)=>{const{matchSupportedRoute:f,onPageReload:g,preloadRoute:b,toUrl:v}=Object(r.useContext)(s.a),y=e=>{g(e.target.getAttribute("href"),!1),h(e)},E=i=>o.a.createElement("a",{href:i,className:t,onClick:y,target:n,rel:"_blank"===n?"noreferrer":void 0,"data-testid":c,ref:p},e),C=d||u;if(!C&&!l)return E("");const I=C&&{href:C},O=v(l,Object(i.a)(Object(i.a)({},m),I)),w=f(O);if(w){const n=async()=>b(w);return o.a.createElement(a.a,{to:`${w.pathname}${w.search}${w.hash}`,className:t,onClick:h,onMouseDownCapture:n,innerRef:p},e)}return E(O)})},NCwY:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isFilled=t.isDefined=t.isPresent=void 0,t.isPresent=function(e){return null!=e},t.isDefined=function(e){return void 0!==e},t.isFilled=function(e){return null!==e}},O1he:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n("XJCg");!function(e){e.resourceOwner="ecosystem",e.appResourceType="app",e.environmentResourceType="environment",e.extensionGroupResourceType="extension-group",e.extensionResourceType="extension",e.appFamilyResourceTypes=[e.appResourceType,e.environmentResourceType,e.extensionGroupResourceType,e.extensionResourceType]}(t.AppFamilyAri||(t.AppFamilyAri={}));class r extends Error{constructor(e,t){super(e),this.cause=t}}t.AppFamilyAriError=r;t.NotAppFamilyAriError=class extends r{constructor(e,t){super(`ari is not a valid App family ari: ${e.toString()} as ${t}`),this.reason=t}};t.NotExpectedAppFamilyAriTypeError=class extends r{constructor(e,t,n){super(`App family ari (${t.toString()}) is not of expected type: ${e}`,n),this.cause=n}},t.parseAppAri=function(e){return i.AppFamilyAriImpl.parse(e)},t.createAppAri=function(e){return new i.AppFamilyAriImpl(e)}},PLaw:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n("ERkP")),r=o(n("4KTy"));function o(e){return e&&e.__esModule?e:{default:e}}function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var s=function(e){return i.default.createElement(r.default,a({dangerouslySetGlyph:'<svg width="24" height="24" viewBox="0 0 24 24" focusable="false" role="presentation"><path d="M8.292 10.293a1.009 1.009 0 0 0 0 1.419l2.939 2.965c.218.215.5.322.779.322s.556-.107.769-.322l2.93-2.955a1.01 1.01 0 0 0 0-1.419.987.987 0 0 0-1.406 0l-2.298 2.317-2.307-2.327a.99.99 0 0 0-1.406 0z" fill="currentColor" fill-rule="evenodd"/></svg>'},e))};s.displayName="ChevronDownIcon";var c=s;t.default=c},PoOp:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("ERkP"),r=n("+6Tk"),o=n("HYLC"),a=n("keNr"),s=n("hb7u");const c=Object(i.memo)(({metricName:e,usePageLoadStartTime:t=!1,startTime:n})=>{const c=Object(o.a)(e),l=Object(r.a)(a.a);return Object(i.useEffect)(()=>{!l&&c&&c.start({startTime:t?s.a.pageLoadStartTimestamp:n})},[c,l,n,t]),null})},RLdS:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("ERkP"),r=n("lEaq"),o=n.n(r),a=n("NI0Q"),s=n("3eOh");function c(e){var t=e.children,n=e.innerRef,r=i.useContext(a.c),c=i.useCallback((function(e){Object(s.c)(n,e),Object(s.b)(r,e)}),[n,r]);return i.useEffect((function(){return function(){return Object(s.c)(n,null)}})),i.useEffect((function(){o()(Boolean(r),"`Reference` should not be used outside of a `Manager` component.")}),[r]),Object(s.d)(t)({ref:c})}},UEVo:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n("ERkP"),r=n("+6Tk"),o=n("HYLC"),a=n("keNr");const s=Object(i.memo)(({metricName:e,stopTime:t,customData:n})=>{const s=Object(o.a)(e),c=Object(r.a)(a.a);return Object(i.useEffect)(()=>{!c&&s&&s.stop({customData:n,stopTime:t})},[s,c]),null})},WA38:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n("Czhu"),r=n("HbGN"),o=n("ERkP"),a=n.n(o),s=(n("aWzz"),n("KIs4")),c=n("M/rd"),l=n("frZf");const d=e=>{const{href:t,to:n}=e,o=Object(r.a)(e,["href","to"]),d=n||t;return a.a.createElement(s.a,null,({featureFlags:t})=>{const n=d&&0!==d.indexOf("/")?"/"+d:d,r=t["confluence.frontend.people.directory"]&&!n.startsWith(l.a)?`${l.a}${n}`:n;return a.a.createElement(c.a,Object(i.a)(Object(i.a)({},e),{},{href:r},o))})}},XJCg:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n("O1he"),r=n("lXfh"),o=n("I4sB"),a="[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}",s=[o.pattern(new RegExp(`^${a}$`,"i"))],c=[o.pattern(new RegExp(`^(${a}|static)$`,"i"))];class l{constructor(e){this.json=e,this.validate()}get appId(){return this.json.appId}get environmentId(){return this.json.environmentId}get version(){return this.json.version}get extensionGroupId(){return this.json.extensionGroupId}get extensionKey(){return this.json.extensionKey}toJSON(){return this.json}static parse(e){const{resourceOwner:t,resourceType:n,resourceId:r}=e;if(t!==i.AppFamilyAri.resourceOwner)throw new i.NotAppFamilyAriError(e,`resourceOwner (${t}) must be ${i.AppFamilyAri.resourceOwner}`);if(!n||i.AppFamilyAri.appFamilyResourceTypes.indexOf(n)<0)throw new i.NotAppFamilyAriError(e,"resourceType must be one of "+i.AppFamilyAri.appFamilyResourceTypes);if(!r)throw new i.NotAppFamilyAriError(e,"resourceId is must be provided");const o=r.indexOf(";v=");if(o>0&&r.lastIndexOf(";v=")>o)throw new i.NotAppFamilyAriError(e,"can only include one version suffix");const[a,s]=r.split(";v="),c=a.split("/").map(d);if(c.length>4)throw new i.NotAppFamilyAriError(e,"no path segments can be added after extensionKey "+c.slice(4));const[u,m,h,p]=c;if(!u)throw new i.NotAppFamilyAriError(e,"appId must be included");const f=h||(n===i.AppFamilyAri.extensionGroupResourceType||n===i.AppFamilyAri.extensionResourceType?"static":void 0);if(!(n!==i.AppFamilyAri.extensionResourceType||m&&h&&p))throw new i.NotAppFamilyAriError(e,"environmentId, extensionGroupId, extensionKey must all be provided for resourceType "+i.AppFamilyAri.extensionResourceType);if(!(n!==i.AppFamilyAri.extensionGroupResourceType||m&&f&&!p))throw new i.NotAppFamilyAriError(e,"environmentId, extensionGroupId must all be provided for resourceType "+i.AppFamilyAri.extensionGroupResourceType);if(n===i.AppFamilyAri.environmentResourceType&&(!m||h||p))throw new i.NotAppFamilyAriError(e,"environmentId must be provided for resourceType "+i.AppFamilyAri.environmentResourceType);if(n===i.AppFamilyAri.appResourceType&&(m||h||p))throw new i.NotAppFamilyAriError(e,"environmentId must be provided for resourceType "+i.AppFamilyAri.environmentResourceType);return new l({appId:u,environmentId:m,extensionGroupId:f,extensionKey:p,version:s})}asAppAri(){return this.returnIf(()=>this.isAppAri(),"app")}asAppEnvironmentAri(){return this.returnIf(()=>this.isAppEnvironmentAri(),"environment")}asExtensionGroupAri(){return this.returnIf(()=>this.isExtensionGroupAri(),"extension-group")}asExtensionAri(){return this.returnIf(()=>this.isExtensionAri(),"extension")}isAppAri(){return!this.isAtLeastAppEnvironmentAri}isAppEnvironmentAri(){return this.isAtLeastAppEnvironmentAri&&!this.isAtLeastExtensionGroupAri}isExtensionGroupAri(){return this.isAtLeastExtensionGroupAri&&!this.isExtensionAri()}isExtensionAri(){return this.isAtLeastExtensionGroupAri&&void 0!==this.extensionKey}returnIf(e,t){if(!e())throw new i.NotExpectedAppFamilyAriTypeError(t,this);return this}get isAtLeastAppEnvironmentAri(){return void 0!==this.environmentId}get isAtLeastExtensionGroupAri(){return this.isAtLeastAppEnvironmentAri&&void 0!==this.extensionGroupId}validate(){const e=[o.validateField(this,"environmentId",s),o.validateField(this,"appId",s),o.validateField(this,"extensionGroupId",c)].filter(e=>e);if(e.length>0)throw r.InvalidAriError.withConstraintViolations(this.toString(),e)}toAri(){const e=i.AppFamilyAri.resourceOwner,{appId:t,environmentId:n,extensionGroupId:o,extensionKey:a,version:s}=this.toJSON();function c(e){const t=e.join("/");return s?`${t};v=${s}`:t}return this.isExtensionAri()?new r.ResourceIdentifier({resourceOwner:e,resourceType:i.AppFamilyAri.extensionResourceType,resourceId:c([t,n,o,a])}):this.isExtensionGroupAri()?new r.ResourceIdentifier({resourceOwner:e,resourceType:i.AppFamilyAri.extensionGroupResourceType,resourceId:c([t,n,o])}):this.isAppEnvironmentAri()?new r.ResourceIdentifier({resourceOwner:e,resourceType:i.AppFamilyAri.environmentResourceType,resourceId:c([t,n])}):new r.ResourceIdentifier({resourceOwner:e,resourceType:i.AppFamilyAri.appResourceType,resourceId:t})}toString(){return this.toAri().toString()}}function d(e){if(!e)return;const t=e.trim();return 0!==t.length?t:void 0}t.AppFamilyAriImpl=l},XaRy:function(e,t,n){var i=n("DSvr"),r=null;function o(e){e&&e.focus&&e!==document.activeElement&&(e.focus(),"input"===e.tagName.toLowerCase()&&e.select())}e.exports=function(e,t){var n=[],a=null,s=null,c=null,l=!1,d=!1,u=null,m="string"==typeof e?document.querySelector(e):e,h=t||{};h.returnFocusOnDeactivate=!t||void 0===t.returnFocusOnDeactivate||t.returnFocusOnDeactivate,h.escapeDeactivates=!t||void 0===t.escapeDeactivates||t.escapeDeactivates;var p={activate:function(e){if(l)return;var t={onActivate:e&&void 0!==e.onActivate?e.onActivate:h.onActivate};l=!0,d=!1,c=document.activeElement,t.onActivate&&t.onActivate();return g(),p},deactivate:f,pause:function(){if(d||!l)return;d=!0,b()},unpause:function(){if(!d||!l)return;d=!1,g()}};return p;function f(e){if(l){var t={returnFocus:e&&void 0!==e.returnFocus?e.returnFocus:h.returnFocusOnDeactivate,onDeactivate:e&&void 0!==e.onDeactivate?e.onDeactivate:h.onDeactivate};return b(),t.onDeactivate&&t.onDeactivate(),t.returnFocus&&setTimeout((function(){o(c)}),0),l=!1,d=!1,this}}function g(){if(l)return r&&r.pause(),r=p,O(),setTimeout((function(){o(function(){var e;e=null!==v("initialFocus")?v("initialFocus"):m.contains(document.activeElement)?document.activeElement:n[0]||v("fallbackFocus");if(!e)throw new Error("You can't have a focus-trap without at least one focusable element");return e}())}),0),document.addEventListener("focus",C,!0),document.addEventListener("click",E,!0),document.addEventListener("mousedown",y,!0),document.addEventListener("touchstart",y,!0),document.addEventListener("keydown",I,!0),p}function b(){if(l&&r===p)return document.removeEventListener("focus",C,!0),document.removeEventListener("click",E,!0),document.removeEventListener("mousedown",y,!0),document.removeEventListener("touchstart",y,!0),document.removeEventListener("keydown",I,!0),r=null,p}function v(e){var t=h[e],n=t;if(!t)return null;if("string"==typeof t&&!(n=document.querySelector(t)))throw new Error("`"+e+"` refers to no known node");if("function"==typeof t&&!(n=t()))throw new Error("`"+e+"` did not return a node");return n}function y(e){h.clickOutsideDeactivates&&!m.contains(e.target)&&f({returnFocus:!1})}function E(e){h.clickOutsideDeactivates||m.contains(e.target)||(e.preventDefault(),e.stopImmediatePropagation())}function C(e){m.contains(e.target)||(e.preventDefault(),e.stopImmediatePropagation(),"function"==typeof e.target.blur&&e.target.blur(),u&&function(e){if(e.shiftKey)return o(s);o(a)}(u))}function I(e){"Tab"!==e.key&&9!==e.keyCode||function(e){if(O(),e.target.hasAttribute("tabindex")&&Number(e.target.getAttribute("tabindex"))<0)return u=e;e.preventDefault();var t=n.indexOf(e.target);if(e.shiftKey)return e.target===a||-1===n.indexOf(e.target)?o(s):o(n[t-1]);if(e.target===s)return o(a);o(n[t+1])}(e),!1!==h.escapeDeactivates&&function(e){return"Escape"===e.key||"Esc"===e.key||27===e.keyCode}(e)&&f()}function O(){n=i(m),a=n[0],s=n[n.length-1]}}},Xcdj:function(e,t,n){"use strict";var i=n("Czhu"),r=n("ERkP"),o=n.n(r),a=n("l1C2"),s=n("bhMQ"),c=n("/yy9"),l=n("ZIFe"),d=n("pwfR");n("1jzs");const u=Object(r.createContext)(()=>({isReady:!0,delay:0,ref:()=>{}})),m=()=>{const e=function(){const e=Object(r.useRef)("");return e.current||(e.current="_"+(Number(String(Math.random()).slice(2))+Date.now()+Math.round(performance.now())).toString(36)),e.current}();return Object(r.useContext)(u)(e)};t.a=({children:e,animationTimingFunction:t,enteringAnimation:n,exitingAnimation:u,isPaused:h,onFinish:p,duration:f=c.a})=>{const g=m(),{isExiting:b,onFinish:v,appear:y}=Object(d.b)(),E=Object(l.b)(),C=h||!g.isReady,I=b?0:g.delay,O=b?"exiting":"entering",[w,T]=Object(r.useState)(y);return Object(r.useEffect)(()=>{let e=!1;if(!C){if(y)return T(!0),E(()=>{"exiting"===O&&v&&v(),e||T(!1),p&&p(O)},b?.5*f:f+I),()=>{e=!0};p&&p(O)}},[v,O,b,f,I,C,E]),o.a.createElement(a.b,null,({css:r})=>e({ref:g.ref,className:w?r(Object(i.a)({animationName:""+Object(a.g)(b&&u||n),animationTimingFunction:t(O),animationDelay:I+"ms",animationFillMode:b?"forwards":"backwards",animationDuration:(b?.5*f:f)+"ms",animationPlayState:C?"paused":"running"},Object(s.b)())):""},O))}},ZIFe:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a}));var i=n("ERkP");const r=e=>{switch(e.cleanup){case"next-effect":return;case"unmount":default:return[]}},o=(e={cleanup:"unmount"})=>{const t=Object(i.useRef)([]);return Object(i.useEffect)(()=>()=>{t.current.length&&(t.current.forEach(e=>cancelAnimationFrame(e)),t.current=[])},r(e)),Object(i.useCallback)(e=>{const n=requestAnimationFrame(i=>{t.current=t.current.filter(e=>e!==n),e(i)});t.current.push(n)},[])},a=(e={cleanup:"unmount"})=>{const t=Object(i.useRef)([]);return Object(i.useEffect)(()=>()=>{t.current.length&&(t.current.forEach(e=>clearTimeout(e)),t.current=[])},r(e)),Object(i.useCallback)((e,n,...i)=>{const r=setTimeout(()=>{t.current=t.current.filter(e=>e!==r),e()},n,...i);t.current.push(r)},[])}},a8dO:function(e,t,n){"use strict";var i=n("Czhu"),r=n("ERkP"),o=n.n(r),a=n("l1C2"),s=n("bES6"),c=n("z9P0"),l=n("NnKS");function d({fn:e,action:t,componentName:n,packageName:o,packageVersion:a,analyticsData:s}){const{createAnalyticsEvent:d}=Object(c.a)(),u=Object(l.a)(s),m=Object(l.a)(e);return Object(r.useCallback)(()=>{const e=d({action:t,actionSubject:n,attributes:{componentName:n,packageName:o,packageVersion:a}}),r=Object(i.a)({componentName:n,packageName:o,packageVersion:a},u.current);e.context.push(r);const s=e.clone();s&&s.fire("atlaskit"),m.current(e)},[t,n,o,a,d,u,m])}var u=n("pwfR"),m=n("b6XK"),h=n("bLpi"),p=n("PEqI"),f=n("BMbf");let g=null;function b(){null!=g&&(window.clearTimeout(g),g=null)}function v(e,t){b(),g=window.setTimeout(()=>{g=null,e()},t)}let y=null;var E=n("3IV/"),C=n("EFzz"),I=n("uvkf");const O=Object(a.e)("border-radius:",Object(f.c)(),"px;box-sizing:border-box;font-size:12px;left:0;line-height:1.3;max-width:240px;padding:2px 6px;top:0;word-wrap:break-word;overflow-wrap:break-word;"),w={name:"v0nulc",styles:"max-width:420px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"},T=Object(r.forwardRef)((function({style:e,className:t,children:n,truncate:i,placement:r,testId:o},s){return Object(a.f)(C.a.Consumer,null,({mode:c})=>Object(a.f)(I.a,{ref:s,style:e,className:t,placement:r,testId:o,css:[O,i?w:null,Object(a.e)("background-color:","light"===c?E.N800:E.DN0,";color:","light"===c?E.N0:E.DN600,";")]},n))}));T.displayName="TooltipContainer";var k=T;function N(e){const t=e||{top:0,left:0};return{getBoundingClientRect:()=>({top:t.top,left:t.left,bottom:t.top,right:t.left,width:0,height:0}),clientWidth:0,clientHeight:0}}var j=n("jYB6");const M=f.i.tooltip(),R={componentName:"tooltip",packageName:j.a,packageVersion:j.b};function x(){}function S({children:e,position:t="bottom",mousePosition:n="bottom",content:c,truncate:l=!1,component:f=k,tag:g="div",testId:E,delay:C=300,onShow:I=x,onHide:O=x,hideTooltipOnClick:w=!1,hideTooltipOnMouseDown:T=!1,analyticsContext:j,strategy:S="fixed"}){const A="mouse"===t?n:t,D=d(Object(i.a)({fn:I,action:"displayed",analyticsData:j},R)),_=d(Object(i.a)({fn:O,action:"hidden",analyticsData:j},R)),P=Object(r.useRef)(null),[$,L]=Object(r.useState)("hide"),F=Object(r.useRef)(null),H=Object(r.useRef)(null),V=Object(r.useCallback)(e=>{e&&null!==e.firstChild&&(H.current=e,F.current=e.firstChild)},[]),B=Object(r.useRef)($),U=Object(r.useRef)(C),z=Object(r.useRef)({onShowHandler:D,onHideHandler:_}),q=Object(r.useRef)(!1);Object(r.useEffect)(()=>{B.current=$,U.current=C,z.current={onShowHandler:D,onHideHandler:_}},[C,_,D,$]);const G=Object(r.useCallback)(e=>{P.current=e,q.current=!1},[]),W=Object(r.useCallback)(()=>{P.current&&(q.current&&z.current.onHideHandler(),P.current=null,q.current=!1,L("hide"))},[]),Y=Object(r.useCallback)(()=>{P.current&&(P.current.abort(),q.current&&z.current.onHideHandler(),P.current=null)},[]);Object(r.useEffect)((function(){return function(){P.current&&Y()}}),[Y]);const K=Object(r.useCallback)(e=>{if(P.current&&!P.current.isActive()&&Y(),P.current&&P.current.isActive())return void P.current.keep();const t=function(e){let t="waiting-to-show";function n(){return Boolean(y&&y.entry===e)}function i(){n()&&(b(),y=null)}function r(){n()&&e.done(),t="done",i()}function o(){n()&&e.hide({isImmediate:!0}),r()}function a(){return"shown"===t||"waiting-to-hide"===t||"hide-animating"===t}return function(){const n=Boolean(y&&y.isVisible());function i(){t="shown",e.show({isImmediate:n})}y&&(b(),y.entry.hide({isImmediate:!0}),y.entry.done(),y=null),y={entry:e,isVisible:a},n?i():(t="waiting-to-show",v(i,e.delay))}(),{keep:function(){if(n())return"waiting-to-hide"===t?(t="shown",void b()):"hide-animating"===t?(t="shown",b(),void e.show({isImmediate:!1})):void 0},abort:i,isActive:n,requestHide:function({isImmediate:i}){n()&&("waiting-to-show"!==t?"waiting-to-hide"!==t&&(i?o():(t="waiting-to-hide",v(()=>{t="hide-animating",e.hide({isImmediate:!1})},e.delay))):o())},finishHideAnimation:function(){n()&&"hide-animating"===t&&r()},getInitialMouse:function(){return"mouse"===e.source.type?e.source.mouse:null}}}({source:e,delay:U.current,show:({isImmediate:e})=>{q.current||(q.current=!0,z.current.onShowHandler()),L(e?"show-immediate":"show-fade-in")},hide:({isImmediate:e})=>{L(t=>"hide"!==t?e?"hide":"fade-out":t)},done:W});G(t)},[Y,W,G]);Object(r.useEffect)(()=>{if("hide"===$)return x;return Object(s.bind)(window,{type:"scroll",listener:()=>{P.current&&P.current.requestHide({isImmediate:!0})},options:{capture:!0,passive:!0,once:!0}})},[$]);const Q=Object(r.useCallback)(()=>{T&&P.current&&P.current.requestHide({isImmediate:!0})},[T]),J=Object(r.useCallback)(()=>{w&&P.current&&P.current.requestHide({isImmediate:!0})},[w]),X=Object(r.useCallback)(e=>{if(e.target===H.current)return;if(e.defaultPrevented)return;e.preventDefault();const n="mouse"===t?{type:"mouse",mouse:N({left:e.clientX,top:e.clientY})}:{type:"keyboard"};K(n)},[t,K]),Z=Object(r.useCallback)(e=>{e.target!==H.current&&(e.defaultPrevented||(e.preventDefault(),P.current&&P.current.requestHide({isImmediate:!1})))},[]),ee=Object(r.useCallback)(()=>{K({type:"keyboard"})},[K]),te=Object(r.useCallback)(()=>{P.current&&P.current.requestHide({isImmediate:!1})},[]),ne=Object(r.useCallback)(e=>{"exiting"===e&&"fade-out"===B.current&&P.current&&P.current.finishHideAnimation()},[]),ie=g,re="hide"!==$&&Boolean(c),oe="show-immediate"===$||"show-fade-in"===$;return Object(a.f)(o.a.Fragment,null,Object(a.f)(ie,{onMouseOver:X,onMouseOut:Z,onClick:J,onMouseDown:Q,onFocus:ee,onBlur:te,ref:V,"data-testid":E?E+"--container":void 0},e),re?Object(a.f)(p.a,{zIndex:M},Object(a.f)(h.a,{placement:A,referenceElement:(()=>{const e=P.current,n=e?e.getInitialMouse():null;return"mouse"===t&&n?n:F.current||void 0})(),strategy:S},({ref:e,style:t})=>Object(a.f)(u.a,{appear:!0},oe&&Object(a.f)(m.a,{onFinish:ne,duration:"show-immediate"===$?0:void 0},({className:n})=>Object(a.f)(f,{ref:e,className:"Tooltip "+n,style:t,truncate:l,placement:A,testId:E},c))))):null)}S.displayName="Tooltip";t.a=S},b6XK:function(e,t,n){"use strict";var i=n("HbGN"),r=n("Czhu"),o=n("ERkP"),a=n.n(o),s=n("A46D"),c=n("/yy9"),l=n("Xcdj");const d={bottom:"translate3d(0, calc(5% + 4px), 0)",left:"translate3d(calc(-5% - 4px), 0, 0)",right:"translate3d(calc(5% + 4px), 0, 0)",top:"translate3d(0, calc(-5% - 4px), 0)"},u={bottom:"translate3d(0, calc(-5% - 4px), 0)",left:"translate3d(calc(5% + 4px), 0, 0)",right:"translate3d(calc(-5% - 4px), 0, 0)",top:"translate3d(0, calc(5% + 4px), 0)"},m=e=>({from:{opacity:1,transform:void 0!==e?"translate3d(0, 0, 0)":void 0},to:Object(r.a)({opacity:0},void 0!==e&&{transform:u[e]})});t.a=e=>{let{children:t,duration:n=c.a,entranceDirection:o}=e,u=Object(i.a)(e,["children","duration","entranceDirection"]);return a.a.createElement(l.a,Object.assign({duration:n,enteringAnimation:(h=o,{from:Object(r.a)({opacity:0},void 0!==h&&{transform:d[h]}),"50%":{opacity:1},to:{transform:void 0!==h?"none":void 0}}),exitingAnimation:m(o),animationTimingFunction:()=>s.b},u),t);var h}},bES6:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("FzbR");Object.defineProperty(t,"bind",{enumerable:!0,get:function(){return i.bind}});var r=n("0gjq");Object.defineProperty(t,"bindAll",{enumerable:!0,get:function(){return r.bindAll}})},"bR0+":function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return d}));var i=n("KIs4"),r=n("frZf");const o=(e,t,n="")=>e?`${n}/people/${e}?ref=confluence${t?"&src="+encodeURIComponent(t):""}`:"",a=async(e,t)=>{if(!e)return"";let n="";try{const{featureFlags:e}=await Object(i.b)();n=e["confluence.frontend.people.directory"]?r.a:""}catch(o){}return`${n}/people/${e}?ref=confluence${t?"&src="+encodeURIComponent(t):""}`},s=(e,t,n="")=>e?`${n}/people/team/${e}?ref=confluence${t?"&src="+encodeURIComponent(t):""}`:"",c=e=>e.getAttribute("data-account-id"),l=e=>{const t={class:"className"},n={};return(e=>Array.from(e.attributes).map(e=>e.name))(e).forEach(i=>{n[t[i]||i]=e.getAttribute(i)}),n.dangerouslySetInnerHTML={__html:e.innerHTML},n};function d(e){return e.filter(c).map(e=>{const t=l(e);t["data-user-hover-bound"]="true",t.href=o(t["data-account-id"],null);const n=window.document.createElement("span");return e.parentNode?(e.parentNode.replaceChild(n,e),{props:t,placeholder:n}):{}})}},bhMQ:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));const i=()=>{if("undefined"==typeof window||!("matchMedia"in window))return!1;const{matches:e}=window.matchMedia("(prefers-reduced-motion: reduce)");return e},r=()=>({"@media (prefers-reduced-motion: reduce)":{animation:"none",transition:"none"}})},cphC:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var i=n("Czhu"),r=n("zjfJ"),o=n("ERkP"),a=n.n(o),s=n("fYnN"),c=n.n(s),l=n("C+A9"),d=n("KIs4");const u=()=>{};function m(e){var t,n;return n=t=class extends o.Component{constructor(...e){super(...e),Object(r.a)(this,"isEngagementDisabledForTests",Boolean(c.a.get("confluence.disable-engagement-for-tests")))}render(){return a.a.createElement(d.a,null,({cloudId:t})=>{const n=this.isEngagementDisabledForTests?{start:u,stop:u}:new l.a(t,"/gateway/api");return a.a.createElement(e,Object(i.a)(Object(i.a)({},this.props),{},{coordinationClient:n}))})}},Object(r.a)(t,"displayName",`withCoordinationClient(${e.displayName||e.name})`),n}},h5Yo:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("H5qd");const r=n.n(i).a`mutation UpdateInlineCommentMutation($input:UpdateCommentInput!){updateComment(input:$input){id}}`},i4Pk:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var i=n("Czhu"),r=n("HbGN"),o=n("ERkP"),a=n.n(o),s=n("1U1M"),c=n("82Bo"),l=n("Licu"),d=n("3VMZ"),u=n("hpu0"),m=n("KuFb"),h=n("adTp"),p=n("xkEZ"),f=n("X2PC"),g=n("KIs4");const b=Object(o.memo)(e=>{var t;let{appearance:n,contentId:p,contentType:f,getEventHandlers:b}=e,v=Object(r.a)(e,["appearance","contentId","contentType","getEventHandlers"]);const[y,E]=Object(o.useState)(null),{data:C,error:I}=Object(s.d)(l.a,{variables:{contentId:p,status:"inlineComment"!==f?["current"]:["current","draft"]},fetchPolicy:"cache-and-network",context:{single:!0}}),O=Object(o.useCallback)((e,t)=>{let n=d.a.VIEW_INLINE_COMMENT_TOP_LEVEL;"inlineReply"===e&&(n=d.a.VIEW_INLINE_COMMENT_REPLY),Object(u.b)().fail({name:n,error:t})},[]);if(!p)return null;if(I)throw O(f,I),I;let w=null,T=n;const k=null!=(t=C)&&null!=(t=t.content)&&null!=(t=t.nodes)?t[0]:t;try{var N;!T&&k&&(T=Object(m.a)(Object(h.e)(k).appearance));const e=null!=(N=C)&&null!=(N=N.content)&&null!=(N=N.nodes)&&null!=(N=N[0])&&null!=(N=N.body)&&null!=(N=N.atlas_doc_format)?N.value:N;w=e?JSON.parse(e):null}catch(j){throw O(f,j),j}return a.a.createElement("div",{ref:E,"data-test-appearance":T},a.a.createElement(g.a,null,({featureFlags:e})=>a.a.createElement(c.a,Object(i.a)({appearance:T,contentId:p,document:w,eventHandlers:b&&b(),featureFlags:e,portalRef:y},v))))}),v=Object(p.a)({attribution:f.a.BACKBONE})(b)},i8tr:function(e,t,n){"use strict";n.r(t);var i=n("jUyC"),r=n("HvGa"),o=n.n(r),a=n("jqY8"),s=n("Jygk"),c=n.n(s),l=n("+frj"),d=n.n(l),u=n("UYEP"),m=n.n(u),h=n("cld1"),p=n("kC4U"),f=n("94Z3"),g=n("hpu0"),b=n("3VMZ");var v=new(m.a.View.extend({initialize(){this.setPageContentElByCSSSelector("#content"),this.pageHeader=null},destroy(){this.el&&(this.el.style.minHeight="",this.el.classList.remove("ic-shrink-to-show-sidebar")),this.pageHeader&&this.pageHeader.classList.remove("ic-shrink-to-show-sidebar")},setPageContentElByCSSSelector(e){let t=!1;if(e){const n=c.a.document.querySelector(e);n?this.setElement(n):t=!0}else t=!0;if(t){const e=c.a.document.querySelector("#content");this.setElement(e)}},setPageHeaderElByCSSSelector(e){this.pageHeader=e?c.a.document.querySelector(e):null},shrinkToShowSideBar(){this.el.classList.add("ic-shrink-to-show-sidebar"),this.pageHeader&&this.pageHeader.classList.add("ic-shrink-to-show-sidebar")},updateMinHeight(e){const t=e-this.$el.offset().top,n=parseInt(this.el.style.minHeight,10);(t>n||isNaN(n))&&(this.el.style.minHeight=t+"px")}}));const y=c.a.top,E={INLINE_COMMENTS:o.a.DarkFeatures.isEnabled("confluence-inline-comments"),RESOLVED_INLINE_COMMENTS:o.a.DarkFeatures.isEnabled("confluence-inline-comments-resolved"),RICH_TEXT_EDITOR:o.a.DarkFeatures.isEnabled("confluence-inline-comments-rich-editor"),DANGLING_COMMENT:o.a.DarkFeatures.isEnabled("confluence-inline-comments-dangling-comment"),LIKES_ADMIN_TOGGLE:o.a.DarkFeatures.isEnabled("optional-likes-CONFDEV-53297")},C=["dateautocomplete","confluencemacrobrowser","propertypanel","jiraconnector","dfe"],I=["autoresize","confluenceleavecomment"],O=["code"];function w(e,t,n,i){null==t||t.isResolved()||t.isDangling()||m.a.trigger("ic:view",t,"permalink",{isReplyComment:i})}function T(){return o.a.Meta.get("user-display-name")||o.a.Meta.get("current-user-fullname")}function k(){return o.a.Meta.get("atlassian-account-id")}function N(e){if("number"==typeof e.selectionStart){const t=e.value.length;e.selectionStart=t,e.selectionEnd=t}else if(null!=typeof e.createTextRange){e.focus();const t=e.createTextRange();t.collapse(!1),t.select()}}function j(e){let t=Object(i.default)(e).closest("a");return t.length||(t=Object(i.default)(e).find("a")),t}function M(){return!!Object(i.default)(".ic-sidebar #wysiwygTextarea_ifr").length}function R(e,t,n){n=n||1,e=e||Object(i.default)(y).scrollTop();const r=i.default.Deferred();if(x()){const o={duration:100,step(e){Object(i.default)(y).scrollTop(e)},complete(){setTimeout(r.resolve,n)}};Object(i.default)({scrollTop:e}).animate({scrollTop:t},o)}else c.a.scrollTo(0,t);return r.promise()}function x(){const e=c.a.frameElement&&c.a.frameElement.getAttribute("name"),t=c.a.frameElement&&"true"===c.a.frameElement.getAttribute("data-is-fallback-mode-iframe");return c.a.top!==c.a.self&&e&&"fallback-mode-iframe"===e||t}const S=function(){let e=null,t=null;function n(t){const n=((t||{}).data||{}).user||{},i=(n.photos||[]).find(e=>e.isPrimary);return e={authorAccountId:n.id,authorDisplayName:n.displayName,authorAvatarUrl:(i||{}).value},e}function i(){return e={authorAccountId:k(),authorDisplayName:T(),authorAvatarUrl:o.a.contextPath()+o.a.Meta.get("current-user-avatar-url")},e}return()=>{if(e)return Promise.resolve(e);if(!t){const e=e=>e.json();t=Object(p.a)("/cgraphql?q=InlineCommentCurrentUserData",{method:"POST",headers:{"Content-Type":"application/json","X-APOLLO-OPERATION-NAME":"InlineCommentCurrentUserData"},body:JSON.stringify({query:"\n          query {\n            user(current: true) {\n              id\n              displayName\n              photos {\n                value\n                isPrimary\n              }\n            }\n          }\n        ",variables:null})}).then(e,t=>{if(t instanceof f.a)return e(t.response);throw t}).then(n).catch(i)}return t}}();S();var A={overlappedSelection:function(e,t){let n;if(!e||!t)return;let r=Object(i.default)(e.containingElement);if(r.is(".inline-comment-marker.valid")||(r=Object(i.default)("<div/>").append(e.html).find(".inline-comment-marker.valid")),r.length>0&&function(e){return e.filter((function(){return Object(i.default)(this).text().length>0})).length>0}(r)){const e=r.first().data("ref");return n=t.findWhere({markerRef:e}),n}},focusedCommentUrl:function(e){return`${o.a.contextPath()}/pages/viewpage.action?pageId=${o.a.Meta.get("latest-page-id")}&focusedCommentId=${e}#comment-${e}`},showFocusedComment:function(e,t,n){const r=t.match(/(focusedCommentId|replyToComment)=(\d+)/);if(null==r)return;const a="replyToComment"===r[1],s=parseInt(r[2],10);if(!e.findWhere)return;let c=e.findWhere({id:s});null!=c?w(e,c,n,a):i.default.ajax({url:`${o.a.contextPath()}/rest/inlinecomments/1.0/comments/replies/${s}/commentId`}).done(t=>{c=e.findWhere({id:t}),w(e,c,n,a)})},getAuthorAvatarUrl:function(){return o.a.Meta.get("current-user-avatar-url")?o.a.contextPath()+o.a.Meta.get("current-user-avatar-url"):o.a.Meta.get("static-resource-url-prefix")+"/images/icons/profilepics/anonymous.png"},moveCaretToEnd:function(e){N(e),c.a.setTimeout(()=>{N(e)},1)},animateSidebar:function(e,t){const n="webkitAnimationEnd oanimationend msAnimationEnd animationend",r=e.$wikiContent,o=i.default.Deferred();if(t){const t=Object(i.default)(".inline-comment-marker.active");e.$el.addClass("ic-slide-in"),e.$el.one(n,(function(){Object(i.default)(this).removeClass("ic-slide-in"),t.addClass("ic-highlight-pulse"),t.one(n,()=>{t.removeClass("ic-highlight-pulse")})})),o.resolve()}else{e.$el.addClass("ic-slide-out");const t=function t(){e.$el.removeClass("ic-slide-out"),e._emptySidebar(),v.destroy(),r.css("position","static"),o.resolve(),e.$el.off(n,t)};e.$el.on(n,t)}return o.promise()},getDarkFeatures:function(){return d.a.clone(E)},getInlineLinks:j,removeInlineLinksDialog:function(e){e.each((function(){const e=j(this);e.length&&e.off("mousemove")}))},isAnimationSupported:function(){return void 0!==document.body.style.animation||void 0!==document.body.style.webkitAnimation},showHighlightContent:function(e){e.parents(".expand-content.expand-hidden").each((function(){Object(i.default)(this).siblings(".expand-control").click()}))},getUnsupportedRtePlugins:function(){return d.a.clone(C)},getSupportedRtePlugins:function(){return d.a.clone(I)},confirmProcess:function(e,t=!1,n=!1){if(n)return!!confirm(e({id:"inline.comments.editor.lost"}))&&(m.a.trigger(m.a,"ic:fabric-editor-dirty",!1),!0);{const n=o.a&&o.a.Rte&&o.a.Rte.getEditor&&o.a.Rte.getEditor();if(n&&n.isDirty()&&(t&&M()||c.a.Confluence.Editor&&!c.a.Confluence.Editor.getContentType))return confirm(e({id:"inline.comments.editor.lost"}))}return!0},getAuthorDisplayName:T,isKeyboardShortcutsEnable:function(){return o.a.Meta.get("use-keyboard-shortcuts")&&c.a.Confluence.KeyboardShortcuts&&c.a.Confluence.KeyboardShortcuts.enabled},addSidebarHeadingTooltip:function(e){e.$("button.ic-action-hide").tooltip({gravity:"se"}),e.$("#ic-nav-next").tooltip({gravity:"s"}),e.$("#ic-nav-previous").tooltip({gravity:"s"})},hasEditorInSidebar:M,recalculateContentHeight:function(e){const t=e.height(),n=e.offset().top+t;v.updateMinHeight(n)},resizeContentAfterLoadingImages:function(e){e=e.closest(".ic-display-comment-view");const t=this,n=Object(i.default)(".confluence-embedded-image, .confluence-embedded-file img",e),r=n.length;let o=0;r>0&&n.off("load").one("load",()=>{++o===r&&t.recalculateContentHeight(e)}).each((function(){this.complete&&Object(i.default)(this).load()}))},scrollToCommentAfterToggleSideBar:function(e,t,n){const r=function(){const n=t&&t.is(":visible");if(e&&n){const n=t.offset().top-e;Object(i.default)(y).scrollTop(n)}};(n=void 0!==n?n:x())?setTimeout(r,1):r()},getEditorFormat:function(e){const t=i.default.Deferred();return i.default.ajax({url:`${o.a.contextPath()}/rest/api/content/${e}?expand=body.editor`,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8"}).then(e=>{const n=e.body.editor.value;t.resolve(n)}).fail((e,n,i)=>{t.reject(e,n,i)}),t.promise()},containUnsupportedMacro:function(e){const t=e.closest(".conf-macro");return!1===t.data("hasbody")||e.find('.conf-macro[data-hasbody="false"]').length>0||-1!=O.indexOf(t.data("macro-name"))},containInternalLink:function(e){return e.closest(".user-mention").length>0||e.find(".user-mention").length>0},containUserMetion:function(e){return e.closest("a[href^='/']:not('.user-mention')").length>0||e.find("a[href^='/']:not('.user-mention')").length>0},getCurrentUserInfo:function(){let e={isDefault:!0,path:o.a.Meta.get("static-resource-url-prefix")+"/images/icons/profilepics/default.png"};return"/images/icons/profilepics/default.png"!==o.a.Meta.get("current-user-avatar-url")&&(e={isDefault:!1,path:o.a.contextPath()+o.a.Meta.get("current-user-avatar-url")}),{accountId:o.a.Meta.get("atlassian-account-id"),displayName:o.a.Meta.get("current-user-fullname"),profilePicture:e}},getOffsetTopRelativeInWindowCoordinate:function(e){return e.offset().top-Object(i.default)(y).scrollTop()},scrollToActiveHighlight:function(e,t){const n=Object(i.default)(y),r=n.scrollTop(),o=n.height();let a;return a=e>r&&e<r+o?r+e-t:e-o/4,R(r,a)},scrollToTop:function(){return R(null,0,100)},sendMessageToParent:function(e){e.bridgeId=""+(c.a.frameElement&&c.a.frameElement.getAttribute("data-bridge-id")),c.a.parent.postMessage(e,c.a.location.origin)},isFallbackModeIframe:x,isSPAPage:function(){return Object(i.default)("#confluence-ui").length>0},getPageContentClassName:function(){return"view-page-body"},getAuthorAccountId:k,getCurrentUserData:S,getAnalyticsClient:Object(h.getAnalyticsWebClient)(),getUnresolvedComments:e=>e.models?e.models.filter(e=>!e.attributes.resolveProperties.resolved):[],failEditDisplay:function(e,{errorThrown:t}){const n=t instanceof Error?t:new Error(t);Object(g.c)(b.a.EDIT_INLINE_COMMENT_LOAD,n),m.a.trigger("ic:error",e)}};var D=n("IC1n"),_=n.n(D),P=n("uIYj"),$=n("J7sl"),L=n("mAAb"),F=m.a.Model.extend({defaults:{authorDisplayName:A.getAuthorDisplayName(),authorAccountId:o.a.Meta.get("atlassian-account-id"),authorAvatarUrl:o.a.contextPath()+o.a.Meta.get("current-user-avatar-url"),body:"",commentId:"0",hasDeletePermission:!0,hasEditPermission:Boolean(o.a.Meta.get("atlassian-account-id"))},urlRoot(){return`${o.a.contextPath()}/rest/inlinecomments/1.0/comments/${this.get("commentId")}/replies`},sync(e,t,n){return n=n||{},"create"===e&&(n.url=`${this.urlRoot()}?containerId=${o.a.Meta.get("latest-page-id")}`),m.a.sync.call(this,e,t,n)},validate(){if(!this.get("body"))return!0}}),H=m.a.Collection.extend({model:F}),V=m.a.Model.extend({defaults:{authorDisplayName:A.getAuthorDisplayName(),authorAvatarUrl:o.a.contextPath()+o.a.Meta.get("current-user-avatar-url"),body:"",originalSelection:"",parentCommentId:"0",lastFetchTime:Object(i.default)("meta[name=confluence-request-time]").attr("content"),hasDeletePermission:!0,hasEditPermission:!0,hasResolvePermission:!0,resolveProperties:{resolved:!1,resolvedTime:0},serializedHighlights:"",deleted:!1},urlRoot:o.a.contextPath()+"/rest/inlinecomments/1.0/comments",initialize(e){e=e||{},this._setHighlights(e.markerRef);const t=this;this.replies=new H,this.replies.url=function(){return t.url()+"/replies"},this.set({containerId:o.a.Meta.get("latest-page-id")},{silent:!0}),this.set({containerType:o.a.Meta.get("content-type")},{silent:!0}),A.getDarkFeatures().DANGLING_COMMENT&&o.a.Meta.get("page-id")===o.a.Meta.get("latest-page-id")&&this.isDangling(e.contentStatus)&&!this.isResolved()&&this.resolve(!0,{wait:!0,dangling:!0,success:d.a.bind((function(){m.a.trigger("ic:open:dangled",this)}),this),error:d.a.bind((function(){m.a.trigger("ic:resolve:dangled:failed",this)}),this)})},validate(){if(!this.get("body"))return!0},resolve(e,t){t=t||{},this.save({},d.a.extend(t,{url:`${this.urlRoot}/${this.get("id")}/resolve/${e}/dangling/${!0===t.dangling}`}))},isResolved(){return this.get("resolveProperties").resolved},isDangling(e){return void 0===this.highlight&&"current"===e},isDeleted(){return this.get("deleted")},_setHighlights(e){let t;t=void 0!==e?Object(i.default)("[data-inline-comments-target=true]:first").find(`.inline-comment-marker[data-ref="${e}"],span[data-mark-type=confluenceInlineComment][data-reference="${e}"],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment][data-id="${e}"]`):Object(i.default)(".ic-current-selection"),0!==t.length?(this.highlights=t,this.highlight=t.first()):(this.highlights=void 0,this.highlight=void 0)},destroy(e){e=e?d.a.clone(e):{};const t=this,n=e.success;return e.success=function(i){n&&n(t,i,e)},function(e,t){const n=t.error;t.error=function(i){n&&n(e,i,t),e.trigger("error",e,i,t)}}(this,e),this.sync("delete",this,e)}}),B=m.a.Collection.extend({model:V,initialize(){this.listenTo(this,"sort",this._removeCachedMarkers)},url:()=>o.a.contextPath()+"/rest/inlinecomments/1.0/comments?containerId="+o.a.Meta.get("page-id"),getResolvedCount(){return this.getResolvedComments().length},getUnresolveCount(){return this.reject(e=>!0===e.isResolved()&&!1===e.isDeleted()).length},getResolvedComments(){return this.filter(e=>!0===e.isResolved()&&!1===e.isDeleted())},getResolvedCommentsDesc(){return d.a.sortBy(this.getResolvedComments(),e=>0-e.get("resolveProperties").resolvedTime)},getNextCommentOnPage(){return this._getCommentAtRelativeOffset(1)},getPrevCommentOnPage(){return this._getCommentAtRelativeOffset(-1)},_getCommentAtRelativeOffset(e){const t=this.getCommentsOnPage(),n=this.findWhere({active:!0});if(void 0===n||t.length<=1)return null;const i=d.a.pluck(t,"id");return t[(d.a.indexOf(i,n.get("id"))+e+t.length)%t.length]},getCommentsOnPage(){return this.filter(e=>!1===e.isResolved()&&!e.isDangling()&&!1===e.isDeleted()||!0===e.get("active"))},getCommentsOnPageCount(){return this.getCommentsOnPage().length},getActiveIndexWithinPageComments(){const e=d.a.pluck(this.getCommentsOnPage(),"id"),t=this.findWhere({active:!0});if(void 0===t)return null;const n=t.get("id");return d.a.indexOf(e,n)},comparator(e,t){return void 0===this.markers&&(this.markers=Object(i.default)("[data-inline-comments-target=true]:first").find("[data-mark-annotation-type='inlineComment'],.inline-comment-marker")),void 0===e.highlight?1:void 0===t.highlight?-1:this.markers.index(e.highlight)-this.markers.index(t.highlight)},_removeCachedMarkers(){this.markers=void 0}});const U={};d.a.extend(U,m.a.Events),U.start=function(){!0!==this.running&&(this.running=!0,this.send=function(e,t){o.a.trigger("analytics",{name:e,data:t})},this.listenTo(m.a,"ic:highlight-panel-click",(function(){this.send("confluence.highlight.actions.comment.inline")})),this.listenTo(m.a,"ic:view",(function(e,t){this.send("confluence.comment.inline.view"),"nav"===t&&this.send("confluence.comment.inline.view.nav"),"permalink"===t&&this.send("confluence.comment.inline.view.permalink")})),this.listenTo(m.a,"ic:overlap",(function(){this.send("confluence.comment.inline.overlap")})),this.listenTo(m.a,"ic:edit",(function(){this.send("confluence.comment.inline.edit")})),this.listenTo(m.a,"ic:persist",(function(){this.send("confluence.comment.inline.create")})),this.listenTo(m.a,"ic:sidebar:close",(function(){this.send("confluence.comment.inline.sidebar.close")})),this.listenTo(m.a,"ic:reply:persist",(function(){this.send("confluence.comment.inline.reply")})),this.listenTo(m.a,"ic:delete ic:reply:delete",(function(){this.send("confluence.comment.inline.delete")})),this.listenTo(m.a,"ic:resolved",(function(){this.send("confluence.comment.inline.resolved")})),this.listenTo(m.a,"ic:unresolved",(function(){this.send("confluence.comment.inline.unresolved")})),this.listenTo(m.a,"ic:resolved:view",(function(e){const t={total:e};this.send("confluence.comment.inline.resolved.view",t)})),this.listenTo(m.a,"ic:resolved:dismiss:recovery",(function(){this.send("confluence.comment.inline.resolved.dismiss")})),this.listenTo(m.a,"ic:resolved:show:recovery",(function(){this.send("confluence.comment.inline.resolved.discovery")})),this.listenTo(m.a,"ic:open:dangled",(function(e){const t={commentId:e.get("id"),pageId:o.a.Meta.get("page-id")};this.send("confluence.comment.inline.open.dangled",t)})),this.listenTo(m.a,"ic:editor:load:fail",(function(){const e={pageId:o.a.Meta.get("page-id")};this.send("confluence.comment.inline.editor.load.fail",e)})),this.listenTo(m.a,"ic:resolve:dangled:failed",(function(e){const t={commentId:e.get("id"),pageId:o.a.Meta.get("page-id")};this.send("confluence.comment.inline.resolved.dangled.failed",t)})))},U.stop=function(){this.running=!1,this.stopListening()};var z=U,q=n("0wgO");const G="FABRIC",W="add",Y="add-reply",K="edit",Q="edit-reply",J="reply",X="view",Z="Comment with provided comment id not found",ee="Page with provided page id not found",te="Reading a comment not permitted for this user",ne="Creating a comment not permitted for this user",ie="Deleting a comment not permitted for this user",re="Resolving a comment not permitted for this user",oe="Editing a comment not permitted for this user",ae="Comment id in the input was not expected to be null",se="Cannot create inline comments on macros (mentions, images, emojis, etc.)",ce="creationBean can not be null",le="body for creationBean can not be null",de="Incorrect data in the request",ue="Captcha check failed",me="Captcha check successfull";n("wS3D");function he(){i.default.textHighlighter.createWrapper=function(e){return Object(i.default)("<span></span>").addClass(e.highlightedClass)},this.$el=Object(i.default)("[data-inline-comments-target=true]").first(),this.$el.length>0&&this.$el.textHighlighter({highlightedClass:"ic-current-selection"})}he.prototype.highlight=function(e){if(0===this.$el.length)return;const t=Object(i.default)(this.$el.getHighlighter().doHighlight(e));return this.$el.getHighlighter().serializeHighlights(t)},he.prototype.removeHighlight=function(){if(0!==this.$el.length)return this.$el.getHighlighter().removeHighlights(),this},he.prototype.deserializeHighlights=function(e,t){if(0===this.$el.length)return;const n=`<span class="inline-comment-marker" data-ref="${t}"></span>`;return this.$el.getHighlighter().deserializeHighlights(e,n)};var pe=he,fe=n("frZf");function ge(e,t){return`<div class="ic-sidebar-heading"><div id="ic-nav-container">${1==e.createComment?Ee({disabled:!0,showIndex:!1},t):""}</div><div class="ic-right-toolbar">${e.showMenu?function(e,t){return""+(e.darkFeatures.INLINE_COMMENTS&&(e.hasDeletePermission||e.hasReplyPermission||e.hasResolvePermission&&e.darkFeatures.RESOLVED_INLINE_COMMENTS)?c.a.aui.buttons.button({type:"subtle",extraClasses:"aui-button-compact aui-dropdown2-trigger-arrowless aui-style-default ic-action-menu",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-more",text:"",dropdown2Target:"ic-menu-items"})+c.a.aui.dropdown2.contents({id:"ic-menu-items",extraClasses:"aui-style-default",content:`<ul class="aui-list-truncate">${e.hasResolvePermission&&e.darkFeatures.RESOLVED_INLINE_COMMENTS?`<li class="ic-action-resolve"><a href="#">${c.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.resolve"}))}</a></li>`:""}${e.hasReplyPermission?`<li class="ic-action-reply"><a href="#">${c.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.reply"}))}</a></li>`:""}${e.hasEditPermission?`<li class="ic-action-edit"><a href="#">${c.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.edit"}))}</a></li>`:""}${e.hasDeletePermission?`<li class="ic-action-delete"><a href="#">${c.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.delete"}))}</a></li>`:""}</ul>`}):"")}(e,t):""}${c.a.aui.buttons.button({type:"text",extraClasses:"aui-button-text ic-action-hide",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-close-dialog",text:"",extraAttributes:{title:t({id:"inline.comments.sidebar.tooltip.close.description"})}})}</div></div><div class="ic-error"></div>`}function be(e,t){return`<div class="ic-author">${function(e){return""+(e.authorAccountId&&""!=e.authorAccountId?`<a data-account-id="${c.a.soy.$$escapeHtml(e.authorAccountId)}" href="${c.a.soy.$$escapeHtml("/people")}/${c.a.soy.$$escapeHtml(e.authorAccountId+"?ref=confluence")}" title="" data-user-hover-bound="true">${c.a.aui.avatar.avatar({size:e.size,avatarImageUrl:e.authorAvatarUrl,extraClasses:"ic-author-avatar-fabric"})}</a>`:c.a.aui.avatar.avatar({size:e.size,avatarImageUrl:fe.a+"/images/icons/profilepics/anonymous.png",extraClasses:"ic-author-avatar-fabric"}))}({authorAvatarUrl:e.authorAvatarUrl,authorAccountId:e.authorAccountId,size:"small"})}${function(e){return""+(e.accountId&&""!=e.accountId?`<a href="${function(e){return`${c.a.soy.$$escapeHtml("/people")}/${c.a.soy.$$escapeHtml(e.accountId+"?ref=confluence")}`}(e)}"${e.canView?`class="url fn confluence-userlink" data-account-id="${c.a.soy.$$escapeHtml(e.accountId)}"`:'class="url fn"'}>${c.a.soy.$$escapeHtml(e.fullName)}</a>`:c.a.soy.$$escapeHtml("Anonymous"))}({canView:!!e.authorAccountId,fullName:e.authorDisplayName,accountId:e.authorAccountId})}</div>`}function ve(e,t){let n=`<div class="ic-container ic-create-comment">${be(e)}<div class="ic-body"><form class="aui" action="">`;if(!e.darkFeatures.RICH_TEXT_EDITOR){const i=""+("reply"==e.type?c.a.soy.$$escapeHtml(t({id:"inline.comments.create.reply.placeholder"})):c.a.soy.$$escapeHtml(t({id:"inline.comments.create.placeholder"})));n+=`<textarea class="textarea ic-textarea" name="body" placeholder="${c.a.soy.$$escapeHtml(i)}">${c.a.soy.$$escapeHtml(e.text)}</textarea><div class="ic-actions"><ul><li>${c.a.aui.buttons.button({tagName:"button",text:t({id:"inline.comments.sidebar.save"}),type:"link",extraClasses:"ic-action-save",isDisabled:!0})}</li>${"topLevel"!=e.type?`<li>${c.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.cancel"}),type:"link",extraClasses:"ic-action-discard"})}</li>`:""}</ul></div>`}return n+="</form></div></div>",n}function ye(e,t){return`<div data-comment-id="${c.a.soy.$$escapeHtml(e.id)}" class="ic-container ic-display-comment">${be(e)}<div class="ic-body wiki-content"><div class="ic-content">${e.resolveProperties.resolved?`<blockquote><span class="ic-resolved-marker">${c.a.soy.$$escapeHtml(e.originalSelection)}</span></blockquote>`:""}${c.a.soy.$$filterNoAutoescape(e.body)}</div></div>${e.resolveProperties.resolved?function(e,t){return""+(e.darkFeatures.INLINE_COMMENTS?`<div class="ic-actions"><ul class="aui-list-truncate">${e.hasResolvePermission&&!e.isDangling?`<li>${c.a.aui.buttons.button({text:t({id:"inline.comments.resolved.menu.unresolve"}),type:"link",extraClasses:"ic-action-unresolve"})}</li>`:""}<li class="hidden">${c.a.aui.buttons.button({type:"link",extraClasses:"ic-action-show-reply"})}</li>${e.hasReply,""}${e.resolveProperties.resolvedTime>0?`<li class="ic-resolved-message">${c.a.aui.icons.icon({useIconFont:!0,size:"small",icon:"success"})}  <span>${Ce({time:""+(e.isDangling&&e.resolveProperties.resolvedByDangling?c.a.soy.$$filterNoAutoescape(t({id:"inline.comments.resolved.dangling.message"},{0:e.resolveProperties.resolvedUser,1:e.resolveProperties.resolvedFriendlyDate})):c.a.soy.$$filterNoAutoescape(t({id:"inline.comments.resolved.message"},{0:e.resolveProperties.resolvedUser,1:e.resolveProperties.resolvedFriendlyDate}))),commentUrl:e.commentDateUrl})}</span></li>`:""}</ul></div>`:"")}(e,t):function(e,t){if(!e.darkFeatures.INLINE_COMMENTS)return"";return`\n    <div class="ic-actions">\n      <ul class="aui-list-truncate">\n        <li class="ic-action-like"></li>\n        ${e.hasResolvePermission&&e.darkFeatures.RESOLVED_INLINE_COMMENTS?`<li>\n            ${c.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.resolve"}),type:"link",extraClasses:"ic-action-resolve"})}\n          </li>`:""}\n      </ul>\n    </div>`}(e,t)}</div>${!e.resolveProperties.resolved&&e.resolveProperties.resolvedTime>0&&e.resolveProperties.resolvedUser?`<div class="ic-unresolved-message">${c.a.soy.$$escapeHtml(t({id:"inline.comments.unresolved.message"},{0:e.resolveProperties.resolvedUser,1:e.resolveProperties.resolvedFriendlyDate}))}</div>`:""}`}function Ee(e,t){return`${c.a.aui.buttons.button({type:"text",id:"ic-nav-next",extraClasses:"aui-button-text",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-arrow-down",text:"",isDisabled:e.disabled,extraAttributes:{tabIndex:e.disabled?"":0,title:t({id:"inline.comments.sidebar.tooltip.next.ic.description"})}})}${c.a.aui.buttons.button({type:"text",id:"ic-nav-previous",extraClasses:"aui-button-text",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-arrow-up",text:"",isDisabled:e.disabled,extraAttributes:{tabIndex:e.disabled?"":0,title:t({id:"inline.comments.sidebar.tooltip.previous.ic.description"})}})}${e.showIndex?`<span class="ic-nav-x-out-of-y">${c.a.soy.$$escapeHtml(t({id:"inline.comments.navigation.index.of"},{0:e.index,1:e.size}))}</span>`:""}`}function Ce(e){return`<a class="ic-date-link" title="${c.a.soy.$$escapeHtml(e.time)}" href="${c.a.soy.$$escapeHtml("/wiki"+e.commentUrl)}"><span>${c.a.soy.$$escapeHtml(e.time)}</span></a>`}var Ie={comment:ye,commentForm:ve,confirmDialog:function(e,t){return`<strong class="ic-confirm-label">${c.a.soy.$$escapeHtml(e.label)}</strong><div class="ic-confirm-message">${c.a.soy.$$escapeHtml(e.message)}</div><div class="ic-confirm-buttons">${c.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.delete"}),tagName:"button",extraClasses:["ic-action-delete-confirm","aui-button-compact"]})}${c.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.cancel"}),tagName:"button",type:"link",extraClasses:["ic-action-cancel-confirm","aui-button-compact"]})}</div>`},createComment:function(e,t){return`<div class="ic-comment-container">${"topLevel"==e.type||"pageComment"==e.type?ge({showMenu:!1,createComment:!0,darkFeatures:e.darkFeatures},t):""}${ve(e,t)}</div>`},deleteComment:function(e){return`<div class="ic-comment-container ic-deleted">${ge({createComment:!1,showMenu:!1},e)}<div class="ic-delete-comment-view"><h2><span class="aui-icon ic-delete-image line">::before</span>${c.a.soy.$$escapeHtml(e({id:"inline.comments.sidebar.deleted"}))}</h2></div></div>`},displayComment:function(e,t){return`\n    <div class="ic-comment-container">\n      ${ge({hasDeletePermission:e.hasDeletePermission,hasResolvePermission:e.hasResolvePermission,hasEditPermission:e.hasEditPermission,hasReplyPermission:e.hasReplyPermission,showMenu:e.showMenu&&!e.resolveProperties.resolved,darkFeatures:e.darkFeatures},t)}\n      ${e.resolveProperties.resolved?function(e,t){return`<div class="ic-resolved-mask"><div class="ic-resolved-mask-content"><h2 class="ic-resolved-icon">${c.a.aui.icons.icon({useIconFont:!0,size:"large",icon:"success",extraClasses:"line"})}${c.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.resolved"}))}</h2></div><div class="resolved-message-container"><div class="resolved-message-sideline"><p>${c.a.soy.$$escapeHtml(t({id:"inline.comments.resolved.dialog.message"}))}</p>${c.a.aui.buttons.button({text:t({id:"adg3.onboarding.docs.link"}),href:"https://confluence.atlassian.com/display/ConfCloud/Comment+on+pages+and+blog+posts#Commentonpagesandblogposts-Resolveinlinecomments",type:"link",extraAttributes:{target:"_blank"},id:"show-resolved-comments"})}</div></div></div>`}(0,t):ye(e,t)}\n    </div>\n    ${e.resolveProperties.resolved?"":'<div class="ic-list"></div>\n      '+(e.hasReplyPermission?`<div class="ic-reply-container">\n          ${e.darkFeatures.INLINE_COMMENTS&&e.hasReplyPermission?`<div class="ic-reply-placeholder">\n              ${be({authorAvatarUrl:e.currentAuthorAvatarUrl,authorDisplayName:e.currentAuthorDisplayName,authorAccountId:e.currentAuthorAccountId,isGDPRInlineCommentsEnabled:e.isGDPRInlineCommentsEnabled})}\n              <div class="ic-body">\n                <form class="aui">\n                  <textarea class="textarea ic-textarea" name="body" placeholder="${c.a.soy.$$escapeHtml(t({id:"inline.comments.create.reply.placeholder"}))}" />\n                </form>\n              </div>\n            </div>`:""}\n        </div>`:"")}`},highlightTextLink:function(e){return`${c.a.aui.icons.icon({useIconFont:!0,size:"small",icon:"link"})}<a href='${c.a.soy.$$escapeHtml(e.link)}'>${c.a.soy.$$escapeHtml(e.link)}</a>`},likes:function(e,t){return`${e.showLikeButton?c.a.aui.buttons.button({text:e.isLikedByUser?t({id:"inline.comments.likes.unlike"}):t({id:"inline.comments.likes.like"}),type:"link",extraClasses:"ic-like-button"}):""}${e.likesCount>0?`<span class="ic-like-summary"><span class="ic-small-like-icon"></span><a class="ic-likes-count" data-content-id="${c.a.soy.$$escapeHtml(e.contentId)}"><span class="ic-like-summary">${c.a.soy.$$escapeHtml(e.likesCount)}</span></a></span>`:""}`},navigation:Ee,pageComment:function(e,t){return`<div class="ic-comment-container">${ge({createComment:!1,showMenu:!1},t)}<div class="ic-page-comment-view"><div class="ic-page-comment"><div class="ic-page-comment-content"><h2 class="ic-resolved-icon">${c.a.aui.icons.icon({useIconFont:!0,size:"large",icon:"success",extraClasses:"line"})}${c.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.saved"}))}</h2></div><div class="ic-page-comment-message-container"><div class="ic-page-comment-message-sideline"><p>${c.a.soy.$$escapeHtml(t({id:"page.comments.saved.dialog.message"}))}</p><button id="show-page-comment" class="aui-button aui-button-link" data-comment-id="${c.a.soy.$$escapeHtml(e.commentId)}">${c.a.soy.$$escapeHtml(t({id:"inline.comments.resolved.dialog.show.me"}))}</button></div></div></div></div></div>`},renderReply:function(e,t){return`${be(e)}<div class="ic-body wiki-content"><div class="ic-content ic-reply-content">${c.a.soy.$$filterNoAutoescape(e.body)}</div></div>${e.darkFeatures.INLINE_COMMENTS&&!e.resolved?function(e,t){return`\n    <div class="ic-actions">\n      <ul>\n        <li class="ic-action-like-reply"></li>\n        ${e.hasDeletePermission?`<li>\n            ${c.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.delete"}),type:"link",extraClasses:"ic-action-delete-reply"})}\n          </li>`:""}\n        ${e.hasEditPermission?`<li>\n            ${c.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.edit"}),type:"link",extraClasses:"ic-action-edit-reply"})}\n          </li>`:""}\n      </ul>\n    </div>`}(e,t):`<div>${Ce({time:e.lastModificationDate,commentUrl:e.commentDateUrl})}</div>`}`},resolvedCommentDialog:function(e,t){return""+c.a.aui.dialog.dialog2({id:"ic-resolved-comment-dialog",removeOnHide:!0,extraClasses:"ic-resolved-comment-dialog-content",modal:!0,titleText:t({id:"inline.comments.resolved.view.menu"}),footerActionContent:""+c.a.aui.buttons.button({id:"resolved-dialog-close-button",text:t({id:"inline.comments.sidebar.close"}),type:"link"}),content:'\x3c!-- Placeholder for error message --\x3e<div id="ic-resolved-comment-dialog-error" />'})},showmoreReply:function(e,t){return`<div id="ic-showmore-container"><div class="ic-decor-line"/><div class="ic-decor-line"/><div class="ic-collapse-decor-center"><span>${c.a.soy.$$escapeHtml(t({id:"inline.comments.expand.replies"},{0:e.totalReplies}))}</span></div></div>`}};var Oe=m.a.View.extend({el:"[data-inline-comments-target=true]:first",events:{"click .inline-comment-marker.valid":"commentClick","click span[data-mark-type=confluenceInlineComment].valid":"commentClick","click span[data-mark-type=annotation][data-mark-annotation-type=inlineComment].valid":"commentClick"},initialize(e){this.formatMessage=e.formatMessage,this.isFabricEditorDirty=!1,this.collection&&(this.listenTo(this.collection,"sync remove change:deleted",this.render),this.listenTo(this.collection,"change:active",this.setActive)),this.listenTo(m.a,"ic:view ic:overlap ic:sidebar-hidden",this.clearSelection),this.listenTo(m.a,"ic:persist",this.persistComment),this.listenTo(m.a,"ic:delete",this.render),this.listenTo(m.a,"ic:fabric-editor-dirty",this.setIsFabricEditorDirty),o.a.bind("qr:add-new-highlight-text.ic-highlight",this._addQuickReloadMarker)},destroy(){o.a.unbind(".ic-highlight"),this.stopListening(),this.undelegateEvents()},render(){this.inlineLinks=[],this.$(".inline-comment-marker,span[data-mark-type=confluenceInlineComment],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment]").removeClass("valid"),this.collection.each((function(e){e.isResolved()||e.get("deleted")||!e.highlights||"current"!==e.attributes.contentStatus||(e.highlights.addClass("valid"),this._pushToInlineLinks(e.highlights))}),this),this._setupLinkDialog(),o.a.trigger("ic-highlight-rendered",this.collection)},_pushToInlineLinks(e){const t=this;e.each((function(){A.getInlineLinks(this).each((function(){Object(i.default)(this).attr("href")&&t.inlineLinks.push(Object(i.default)(this))}))}))},_setupLinkDialog(){const e={width:200,onHover:!0,noBind:!0,calculatePositions:this._calculatePositions,hideDelay:1e3};Object(i.default)(this.inlineLinks).each((function(){const t=this;o.a.InlineDialog(t,"inline-comment-link",(e,n,i)=>(e.addClass("inline-comment-link"),e.html(Ie.highlightTextLink({link:t.attr("href")})),i(),!1),e)}))},_calculatePositions:(e,t,n)=>({displayAbove:!0,popupCss:{top:t.target.offset().top-e.height()-10,left:n.x-e.width()/2},arrowCss:{top:e.height(),left:e.width()/2-4}}),setActive(e){this.$(".inline-comment-marker,span[data-mark-type=confluenceInlineComment],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment]").removeClass("active");const t=this.$(`.inline-comment-marker[data-ref="${e.get("markerRef")}"],span[data-mark-type=confluenceInlineComment][data-reference="${e.get("markerRef")}"],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment][data-id="${e.get("markerRef")}"]`);e.get("active")&&t.length&&t.addClass("active")},commentClick(e){e.preventDefault(),e.stopPropagation(),Object(g.b)().start({name:b.a.VIEW_INLINE_COMMENT,collect:(e,t)=>{Object(q.a)([b.a.VIEW_INLINE_COMMENT_TOP_LEVEL,b.a.VIEW_INLINE_COMMENT_REPLY])(e,t)},attributes:{renderer:G,mode:L.c.VIEW,framework:L.b.BACKBONE}});try{const t=this.$(e.currentTarget),n=t.parentsUntil(".active",".inline-comment-marker.valid");let i;e.originalEvent.isTrusted||(i="programmaticClick"),t.hasClass("active")?m.a.trigger("ic:hide-sidebar",e,!0):n.length>0?this.displayComment(n.last(),i):this.displayComment(t,i)}catch(t){Object(g.b)().fail({name:b.a.VIEW_INLINE_COMMENT,error:t})}},displayComment(e,t){if(A.confirmProcess(this.formatMessage,!1,this.isFabricEditorDirty)){const n=e.data("ref")||e.data("reference")||e.data("id"),i=this.collection.findWhere({markerRef:n});this.sendAnalytics(i),m.a.trigger("ic:view",i,t)}},clearSelection(){(new pe).removeHighlight()},persistComment(e){Object(i.default)("button[data-test-id='fabric-edit-button']")?this.$(".ic-current-selection").removeClass("ic-current-selection").attr("data-mark-type","annotation").attr("data-mark-annotation-type","inlineComment").attr("data-id",e.get("markerRef")).addClass("valid"):this.$(".ic-current-selection").removeClass("ic-current-selection").addClass("inline-comment-marker").attr("data-ref",e.get("markerRef")),this.collection.add(e)},_addQuickReloadMarker(e,t,n){const i=t.comment;if(this.$(`.inline-comment-marker[data-ref="${i.dataRef}"],span[data-mark-type=confluenceInlineComment][data-reference="${i.dataRef}"],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment][data-id="${i.dataRef}"]`).length)return void n.resolve(t);(new pe).deserializeHighlights(i.serializedHighlights,i.dataRef)?n.resolve(t):n.reject(t)},setIsFabricEditorDirty(e){this.isFabricEditorDirty=e},async sendAnalytics(e){const t=await A.getAnalyticsClient,{attributes:{containerId:n},collection:i}=e,r=A.getUnresolvedComments(i);t.sendTrackEvent({source:"viewPageScreen",actionSubject:"inlineCommentsSidebar",action:"viewed",objectType:"page",objectId:n,attributes:{pageType:o.a.Meta.get("draft-type"),commentsDeckSize:r.length,resolvedComments:i.length-r.length}})}}),we=n("7nmT"),Te=n.n(we),ke=n("Czhu"),Ne=n("HbGN"),je=n("ERkP"),Me=n.n(je),Re=n("96U/"),xe=n("aWzz"),Se=n.n(xe),Ae=n("EcEE");class De extends je.Component{render(){var e;const{userId:t}=this.props,n=null!=(e=this.props)&&null!=(e=e.dangerouslySetInnerHTML)?e.__html:e;return Me.a.createElement(Ae.a,{userId:t,fullName:n,isAnonymous:!t,referralSource:"inline-comments-header"})}}var _e=n("bR0+");const Pe=e=>e.getAttribute("data-account-id"),$e=e=>{const t={class:"className"},n={};return(e=>Array.from(e.attributes).map(e=>e.name))(e).forEach(i=>{n[t[i]||i]=e.getAttribute(i)}),n.dangerouslySetInnerHTML={__html:e.innerHTML},n};const Le=e=>{const t=Array.from(e.el.querySelectorAll(".ic-author")).filter(e=>null!==e.querySelector(".confluence-userlink")).map(e=>e.querySelector(".confluence-userlink"));var n,i;(n=t,n.filter(Pe).map(e=>{const t=$e(e);t["data-user-hover-bound"]="true",t.href=Object(_e.a)(t["data-account-id"],null,i);const n=c.a.document.createElement("span");return e.parentNode?(e.parentNode.replaceChild(n,e),{props:t,placeholder:n}):{}})).forEach(e=>{const t=e.props,{"data-account-id":n}=t,i=Object(Ne.a)(t,["data-account-id"]);Object(Re.a)(Me.a.createElement(De,Object(ke.a)({userId:n},i),e.props.children),e.placeholder)})},Fe=e=>{Array.from(e.el.querySelectorAll(".ic-author a[data-account-id]")).filter(e=>e.getAttribute("href").startsWith("/people/")).forEach(e=>e.setAttribute("href",`${fe.a}${e.getAttribute("href")}`))};var He=n("yLoQ"),Ve=m.a.View.extend({className:"ic-likes",render(){return this.el&&Object(Re.a)(Me.a.createElement(He.a,{contentId:""+this.options.contentId,containerId:""+this.options.containerId,containerType:this.options.containerType,isForInlineComment:!0}),this.el),this}}),Be=n("A79P");function Ue(){o.a.Confluence.EditorLoader.resourcesLoaded()||this.$form.find(".loading-container").spin("small")}function ze(){o.a.Meta.set("content-type","comment"),o.a.Meta.set("use-inline-tasks","false"),o.a.Meta.set("min-editor-height",80)}function qe(e){var t,n;e.$form.find(".loading-container").hide(),e.$form.find("#rte-button-publish").text(this.formatMessage({id:"inline.comments.sidebar.save"})).removeAttr("title"),e.$form.find("#toolbar-hints-draft-status").hide(),this.hideCancelButton&&e.$form.find("#rte-button-cancel").hide(),e.editor.onPostProcess.add((t="onPostProcess",n=e.editor,function e(){c.a.tinymce.DOM.setStyle(c.a.tinymce.DOM.get(n.id+"_ifr"),"height","80px"),n.execCommand("mceAutoResize",{forceExec:!0}),n[t].remove(e)})),c.a.Confluence.Editor&&!c.a.Confluence.Editor.getContentType&&o.a.Confluence.QuickEdit.QuickEditPage.disable(),c.a.Confluence.Editor.removeAllCancelHandlers(),c.a.Confluence.Editor.removeAllSaveHandlers()}var Ge={init:function(e){return"true"!==e.isMacroBrowserCheckEnabled||o.a.MacroBrowser&&o.a.MacroBrowser.setMacroJsOverride?(this.formatMessage=e.formatMessage,o.a.Confluence.QuickEdit.activateEditor({preActivate:Ue,preInitialise:ze,postInitialise:i.default.proxy(qe,e),toolbar:!1,$container:e.container,$form:e.form,saveHandler:e.saveHandler,cancelHandler:e.cancelHandler,fetchContent:e.fetchContent(),closeAnyExistingEditor:!0,postDeactivate:e.postDeactivate,plugins:A.getSupportedRtePlugins(),excludePlugins:A.getUnsupportedRtePlugins()})):i.default.Deferred().reject()},remove:function(){return o.a&&o.a.Rte&&o.a.Rte.getEditor&&o.a.Rte.getEditor()?o.a.Confluence.QuickEdit.deactivateEditor():i.default.Deferred().resolve()},getContent:function(){return o.a.Rte.Content.getHtml()},setEditorBusy:function(e){e?Object(i.default)(".ic-sidebar #rte-spinner").spin():Object(i.default)(".ic-sidebar #rte-spinner").spinStop(),Object(i.default)("#rte-button-publish").prop("disabled",e)}},We=n("gwLK"),Ye=n("lZoD"),Ke=n("rClA"),Qe=n("uDfI"),Je=n("JxFu"),Xe=n("FdGg"),Ze=n("X2PC"),et=n("8TdO"),tt=n("y9AH"),nt=n("lEaq"),it=n.n(nt),rt=n("W47X"),ot=n("mGwS");function at(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function st(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var ct=function(e){function t(){var n,i;at(this,t);for(var r=arguments.length,o=Array(r),a=0;a<r;a++)o[a]=arguments[a];return n=i=st(this,e.call.apply(e,[this].concat(o))),i.history=Object(rt.a)(i.props),st(i,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentWillMount=function(){it()(!this.props.history,"<BrowserRouter> ignores the history prop. To use a custom history, use `import { Router }` instead of `import { BrowserRouter as Router }`.")},t.prototype.render=function(){return Me.a.createElement(ot.a,{history:this.history,children:this.props.children})},t}(Me.a.Component);ct.propTypes={basename:Se.a.string,forceRefresh:Se.a.bool,getUserConfirmation:Se.a.func,keyLength:Se.a.number,children:Se.a.node};var lt=ct,dt=n("7a7X"),ut=n("KIs4"),mt=n("Vgb+"),ht=n("6z9Z"),pt=n("MV18"),ft=n("9m+Y"),gt=n("+mzV"),bt=n("Al9w"),vt=n("AeT/"),yt=n("HEM+"),Et=n("1U1M"),Ct=n("L21V"),It=n("KsTJ"),Ot=n("z9P0"),wt=n("wMvT"),Tt=n.n(wt),kt=n("wn7R"),Nt=n("zJ/j"),jt=n("3IV/"),Mt=n("rhcL"),Rt=n("8Kf2"),xt=n("ltac"),St=n("dIe6"),At=n("vdGo"),Dt=n("o0lc"),_t=n("g92I"),Pt=n("LPS5"),$t=n("H5qd"),Lt=n.n($t);const Ft=Lt.a`query InlineCommentEditQuery($contentId:ID!){content(id:$contentId){edges{node{id type body{atlas_doc_format{value}}space{id}status}}}}`,Ht=Lt.a`query InlineCommentNewQuery($contentId:ID!){content(id:$contentId){edges{node{id type space{id}status}}}}`,Vt=Lt.a`mutation InlineCommentsFabricSaveCommentMutation($params:ExperimentalFabricInlineCommentInput)@experimental{experimentalSaveFabricInlineComment(params:$params){result{id authorAccountId authorDisplayName authorUserName authorAvatarUrl body commentDateUrl hasDeletePermission hasEditPermission hasReplyPermission hasResolvePermission lastModificationDate markerRef parentCommentId originalSelection resolveProperties{resolved resolvedTime resolvedByDangling}}error{errorId message}}}`,Bt=Lt.a`mutation InlineCommentsFabricSaveReplyMutation($params:ExperimentalFabricInlineReplyInput)@experimental{experimentalSaveFabricInlineReply(params:$params){result{id authorAccountId authorDisplayName authorUserName authorAvatarUrl body commentDateUrl hasDeletePermission hasEditPermission lastModificationDate commentId}error{errorId message}}}`,Ut=Lt.a`query EditContentPermissionQuery($contentId:ID!){content(id:$contentId){nodes{id type operations{operation targetType}}}}`,zt=It.default.div`
  height: 143px;
  width: 97%;
  background: ${jt.N0};
`;zt.displayName="StyledLoadingContainer";const qt=It.default.div`
  padding-top: 12px;
  padding-bottom: 12px;
  display: flex;
  justify-content: flex-end;
`,Gt=It.default.div`
  padding: 30px 0;
`,Wt=It.default.div`
  padding-bottom: 12px;
  & [aria-label="calendar"] td > div {
    margin: 0 -1px;
  }
`,Yt=e=>{var t,n,i;const r=null!=(i=e)&&null!=(i=i.content)&&null!=(i=i.edges)&&null!=(i=i[0])&&null!=(i=i.node)&&null!=(i=i.body)&&null!=(i=i.atlas_doc_format)?i.value:i,o=(null!=(n=e)&&null!=(n=n.content)&&null!=(n=n.edges)&&null!=(n=n[0])&&null!=(n=n.node)&&null!=(n=n.space)?n.id:n)||"",a=null!=(t=e)&&null!=(t=t.content)&&null!=(t=t.edges)&&null!=(t=t[0])&&null!=(t=t.node)?t.type:t;return{adfContent:r?JSON.parse(r):null,spaceId:o,contentType:a}},Kt=e=>{switch(e){case W:case Y:return"create";case K:case Q:return"edit"}},Qt=({container:e,model:t,type:n,onCancel:i,onSaveSuccess:r,onSaveError:o,onContentChange:a})=>{var s,c;const{attributes:{id:l,containerId:d,containerType:u}}=t,[m,h]=Object(je.useState)(e),p=Object(je.useContext)(ht.a),[f,g]=Object(je.useState)(b.a.ADD_INLINE_COMMENT),[v,y]=Object(je.useState)(b.a.ADD_INLINE_COMMENT_LOAD),[E,C]=Object(je.useState)(b.a.ADD_INLINE_COMMENT_PUBLISH),I=Object(je.useRef)(()=>{}),{createAnalyticsEvent:O}=Object(Ot.a)();Object(je.useEffect)(()=>{e&&h(e.querySelector(".ic-body"))},[e]),Object(je.useEffect)(()=>{switch(n){case W:g(b.a.ADD_INLINE_COMMENT),y(b.a.ADD_INLINE_COMMENT_LOAD),C(b.a.ADD_INLINE_COMMENT_PUBLISH);break;case Y:g(b.a.REPLY_TO_INLINE_COMMENT),y(b.a.REPLY_TO_INLINE_COMMENT_LOAD),C(b.a.REPLY_TO_INLINE_COMMENT_PUBLISH);break;case K:case Q:g(b.a.EDIT_INLINE_COMMENT),y(b.a.EDIT_INLINE_COMMENT_LOAD),C(b.a.EDIT_INLINE_COMMENT_PUBLISH);break;default:throw new Error("Unknown inline comment type name: "+n)}},[n]);const w=n===W||n===Y,T=w?Ht:Ft,k=w?d:l,{data:N,loading:j,error:M}=Object(Et.d)(T,{variables:{contentId:k}}),{data:R}=Object(Et.d)(Ut,{variables:{contentId:d}}),x=null!=(c=R)&&null!=(c=c.content)&&null!=(c=c.nodes)&&null!=(c=c[0])?c.type:c,S=((null!=(s=R)&&null!=(s=s.content)&&null!=(s=s.nodes)&&null!=(s=s[0])?s.operations:s)||[]).filter(({operation:e,targetType:t})=>"update"===e&&t===x).length>0,[A]=Object(Et.c)(Vt,{refetchQueries:[{query:Pt.a,variables:{pageId:d}}]}),[D]=Object(Et.c)(Bt),_=Object(je.useCallback)(e=>{const{translatedErrorId:t,errorToLog:n}=(e=>{const{message:t,errorId:n}=e;let i;switch(t){case te:i="inline.comments.fabric.editor.error.view.not.permitted";break;case ne:i="inline.comments.fabric.editor.error.create.not.permitted";break;case ie:i="inline.comments.fabric.editor.error.delete.not.permitted";break;case re:i="inline.comments.fabric.editor.error.resolve.not.permitted";break;case oe:i="inline.comments.fabric.editor.error.edit.not.permitted";break;case se:i="inline.comments.fabric.editor.error.invalid.selection";break;case le:i="inline.comments.fabric.editor.error.cannot.be.empty";break;case ue:i="inline.comments.fabric.editor.error.captcha.check.failed";break;case me:i="inline.comments.fabric.editor.error.captcha.check.succeeded";break;case ae:case Z:case ee:case ce:case de:default:i="inline.comments.fabric.editor.error.unexpected"}return{translatedErrorId:i,errorToLog:`${t}${n?` (errorId: ${n})`:""}`}})(e),{errorId:i}=e,r="inline.comments.fabric.editor.error.invalid.selection"===t;if(r||"inline.comments.fabric.editor.error.cannot.be.empty"===t){const e={errorMessage:n,editor:P.d.FABRIC,errorId:i,framework:L.b.BACKBONE};if(r){const t=new Range;t.selectNode(document.querySelector(".ic-current-selection"));const n=document.getSelection();n.removeAllRanges(),n.addRange(t);const i=Object(_t.c)(document.querySelector("#content"),n.getRangeAt(0),d);e.matchTrace=JSON.stringify(i)}O({type:"sendOperationalEvent",data:{source:"viewPage",objectType:"page",objectId:d,action:"invalid",actionSubject:r?"highlight":"content",actionSubjectId:"inlineComment",attributes:e}}).fire()}else p.fail({name:f,error:new Error(n)});return o(t),Promise.reject()},[d,O,f,p,o]),$=Object(je.useCallback)(e=>{e&&!e.isEditorAborted||i()},[i]),F=Object(je.useCallback)((e,t)=>{const{spaceId:i,contentType:r}=Yt(t),o=n===K||n===Q?"updated":"created",a=e.id,s=e.commentId||e.parentCommentId,c={containerType:"space",containerId:i,source:"viewPageScreen",objectType:"page",objectId:d,action:o,actionSubject:"comment",actionSubjectId:a,attributes:{commentType:"inline",pageType:r,parentCommentId:s,editor:P.d.FABRIC,framework:"BACKBONE"}};O({type:"sendTrackEvent",data:c}).fire()},[d,O,n]),H=Object(je.useCallback)((e,i)=>{const o=n===W||n===K;if(p.start({name:E,timeout:Be.a.EDITOR_PUBLISH,attributes:{mode:"view"}}),Object(Mt.h)(e))return _({message:le});const{attributes:{originalSelection:a,serializedHighlights:s,numMatches:c,matchIndex:l,authorDisplayName:m,authorAvatarUrl:h,parentCommentId:f,lastFetchTime:g,id:b,authorAccountId:v,commentId:y,lastModificationDate:C,commentDateUrl:I,hasDeletePermission:O,hasEditPermission:w}}=t;let T,k;return o?(T=A,k={variables:{params:{contentId:d,contentType:u||"page",adfContent:JSON.stringify(e),commentId:b,requestType:n===W?"add":"edit",originalSelection:a,serializedHighlights:s,numMatches:c,matchIndex:l,authorDisplayName:m,authorAvatarUrl:h,parentCommentId:f,lastFetchTime:g,createdFrom:"renderer"}}}):(T=D,k={variables:{params:{contentId:d,adfContent:JSON.stringify(e),replyId:b,requestType:n===Y?"reply":"edit-reply",authorDisplayName:m,authorAvatarUrl:h,authorAccountId:v,parentCommentId:y,hasDeletePermission:O,hasEditPermission:w,lastModificationDate:C,commentDateUrl:I}}}),T(k).then(({data:e})=>{let a,s;if(o?(a=e.experimentalSaveFabricInlineComment.error,s=e.experimentalSaveFabricInlineComment.result):(a=e.experimentalSaveFabricInlineReply.error,s=e.experimentalSaveFabricInlineReply.result),a)return _(a);n===Q&&(s.authorAccountId=t.attributes.authorAccountId,s.authorUserName=t.attributes.authorUserName),r(s),F(s,i)}).catch(e=>{if(!e)return Promise.reject();let{message:t}=e;if(-1!==t.indexOf("{")){const e=t.substr(t.lastIndexOf("}")+3);t="GraphQL Error: "+e}return _({message:t})})},[E,d,u,t,F,A,D,_,n,r,p]),V=Object(je.useCallback)(()=>{a()},[a]),B=Object(je.useCallback)(()=>{p.succeed({name:v})},[v,p]),U=Object(je.useCallback)(e=>{if(e&&!Object(xt.d)(e)){let t=e;for(;t&&!t.classList.contains("ic-create-comment-view");)t=t.parentElement;I.current(t)}},[I]),{adfContent:z,spaceId:q}=Yt(N);return Te.a.createPortal(Me.a.createElement(je.Fragment,null,j&&Me.a.createElement(je.Fragment,null,Me.a.createElement(zt,null),Me.a.createElement(qt,null,Me.a.createElement(kt.a,null,Me.a.createElement(Nt.a,{appearance:"primary",isDisabled:!0},Me.a.createElement(Ct.b,{id:"inline.comments.fabric.inline.button.save",defaultMessage:"Save",description:"Button label for save button for fabric inline comments"})),n!==W&&Me.a.createElement(Nt.a,{appearance:"subtle",isDisabled:!0},Me.a.createElement(Ct.b,{id:"inline.comments.fabric.inline.button.cancel",defaultMessage:"Cancel",description:"Button label for cancel button for fabric inline comments"}))))),M&&Me.a.createElement(St.a,{error:M},Me.a.createElement(Gt,null,Me.a.createElement(Tt.a,{size:"medium",primaryColor:jt.R400}),Me.a.createElement(Ct.b,{id:"inline.comments.fabric.sidebar.loading.error",defaultMessage:"An error occurred, please close the comment window and try again",description:"Generic loading error for fabric inline comments sidebar"})),Me.a.createElement(At.a,{name:v,error:M})),N&&Me.a.createElement(Wt,null,Me.a.createElement(Rt.a,{pageId:d,pageType:u,appearance:"chromeless",commentMode:Kt(n),spaceId:q,onSaveComment:e=>H(e,N),content:z,showCancelButton:n!==W,onCancelComment:$,onContentChange:V,onEditorReady:B,afterActivation:U,hasMediaUploadPermissions:S,hideWatchCheckbox:!0}),Me.a.createElement(Dt.a,null,({scrollToElement:e})=>(I.current=e,null)))),m)};var Jt=n("hATe");const Xt=It.default.div`
  display: flex;
  align-items: center;
`,Zt=It.default.div`
  height: ${({avatarSize:e})=>"medium"===e?"36px":"28px"};
  width: ${({avatarSize:e})=>"medium"===e?"36px":"28px"};
`,en=It.default.div`
  padding-left: 4px;
`,tn=It.default.div`
  display: flex;
  flex-direction: column;
  padding-left: 4px;
  font-size: 14px;
  line-height: 20px;

  a:first-of-type {
    font-weight: 500;
    color: ${jt.N600};

    &:visited,
    &:hover {
      color: ${jt.N600};
    }
  }
`,nn=It.default.a`
  font-size: 11px;
  line-height: 16px;

  &.ic-date-link {
    color: ${jt.N200};

    &:visited,
    &:hover {
      color: ${jt.N200};
    }
  }
`;nn.displayName="StyledCommentDateLink";const rn=({model:e,container:t,header:n,avatarSize:i,showDate:r})=>{const[o,a]=Object(je.useState)(n),{attributes:{authorAccountId:s,authorAvatarUrl:c,authorDisplayName:l,lastModificationDate:d,commentDateUrl:u}}=e;Object(je.useEffect)(()=>{const e=t.querySelector(".ic-author");for(;e.firstChild;)e.removeChild(e.firstChild);a(e)},[t]);return Te.a.createPortal(Me.a.createElement(Xt,null,Me.a.createElement(Zt,{avatarSize:i},Me.a.createElement(Jt.a,{userId:s,src:c,size:i,trigger:"click"})),r?Me.a.createElement(tn,null,Me.a.createElement(Ae.a,{userId:s,fullName:l,referralSource:"inline-comment",canViewProfile:!1}),Me.a.createElement(nn,{className:"ic-date-link",href:"/wiki"+u},d)):Me.a.createElement(en,null,Me.a.createElement(Ae.a,{userId:s,fullName:l,referralSource:"inline-comment",canViewProfile:!1}))),o)},on=({container:e,model:t,selector:n})=>{const{attributes:{id:i,containerId:r,containerType:o,commentId:a}}=t,[s,c]=Object(je.useState)(e);Object(je.useEffect)(()=>{if(e){const t=e.querySelector(n);c(t)}},[e]);return s?Te.a.createPortal(Me.a.createElement(He.a,{contentId:""+i,containerId:r||String(a),containerType:o||"page",isForInlineComment:!0,isForComment:!1,showSeparator:!!t.replies||t.attributes.hasDeletePermission||t.attributes.hasEditPermission}),s):null};var an=n("bU5Q"),sn=n("i4Pk"),cn=n("3oRx"),ln=n("Iy7w"),dn=n("RKN0");const un=Object(ln.a)("span",{target:"e19gntln0"})("color:",e=>e.isReply?"#707070":jt.N50,";font-size:12px;cursor:pointer;user-select:none;"),mn=Object(ln.a)("div",{target:"e19gntln1"})({name:"dkim4n",styles:"width:200px;user-select:none;"}),hn=Object(ln.a)("span",{target:"e19gntln2"})("color:",jt.B400,";display:inline;padding:0;cursor:pointer;:hover{text-decoration:underline;}"),pn=Object(ln.a)("span",{target:"e19gntln3"})({name:"kdqiw2",styles:"padding:3px 10px;font-size:14px;"}),fn=({container:e,isReply:t})=>{const[n,i]=Object(je.useState)(e),[r,o]=Object(je.useState)(!1);Object(je.useEffect)(()=>{let n;if(t){const t=e.querySelector(".ic-action-edit-reply");t&&(n=t.parentElement)}else n=document.querySelector(".ic-sidebar-heading .ic-action-edit");for(;n&&n.firstChild;)n.removeChild(n.firstChild);i(n)},[e,t]);const a=Object(je.useCallback)(()=>{const e=document.querySelector(".ic-reply-container textarea");e&&(e.click(),o(!1))},[r]),s=Me.a.createElement(mn,null,Me.a.createElement("p",null,Me.a.createElement(hn,{onClick:a},Me.a.createElement(Ct.b,{id:"no-edit.action.text",defaultMessage:"Add a new comment",description:"option to add a new comment"}))," ",Me.a.createElement(Ct.b,{id:"no-edit.reason",defaultMessage:"since this one cannot be edited; it contains content created in a legacy version of Confluence.",description:"reason for why we prevent editing the content"}))),c=Object(je.useCallback)(()=>{o(!r)},[r]);return Te.a.createPortal(Me.a.createElement(dn.a,{content:s,isOpen:r,placement:t?"bottom":"bottom-end"},Me.a.createElement(un,{onClick:c,isReply:t},t?Me.a.createElement(Ct.b,{id:"no-edit.action.label",defaultMessage:"Edit is not available",description:"clickable text that tells the user they cannot edit this content"}):Me.a.createElement(pn,null,Me.a.createElement(Ct.b,{id:"no-edit.menu.action",defaultMessage:"Edit",description:"clickable text that is disabled in a menu context"})))),n)},gn=It.default.div`
  & .ak-renderer-document h1 {
    font-weight: 500;
  }
`,bn=({contentId:e,container:t,isReply:n,hasEditPermission:i})=>{const[r,o]=Object(je.useState)(t),[a,s]=Object(je.useState)(b.a.VIEW_INLINE_COMMENT_TOP_LEVEL),[c,l]=Object(je.useState)(!1);Object(je.useEffect)(()=>{let e;if(t&&(e=t.querySelector(".ic-content"),e)){for(;e.firstChild;)e.removeChild(e.firstChild);o(e)}},[t]),Object(je.useEffect)(()=>{n&&s(b.a.VIEW_INLINE_COMMENT_REPLY)},[n]);const d=Object(je.useCallback)(()=>{Object(g.b)().succeed({name:a})},[a]),u=Object(je.useCallback)(e=>{Object(g.b)().fail({name:a,error:e})},[a]),m=Object(je.useCallback)(()=>{l(!0)},[]);return Te.a.createPortal(Me.a.createElement(an.d,null,Me.a.createElement(gn,null,Me.a.createElement(sn.a,{contentId:e,appearance:"comment",extensionHandlers:Object(cn.a)(m,e),contentType:n?"inlineReply":"inlineComment",onComplete:d,onError:u,allowDynamicTextSizing:!1}),c&&i&&Me.a.createElement(fn,{container:t,isReply:n}))),r)},vn=Object(vt.a)();Object(bt.a)(vn);const yn=(e,t={viewToRender:X,currentUserData:{}})=>{let n,i;const{viewToRender:r}=t;r===J?(n=e.el,i=".ic-action-like-reply"):r===Y||r===K||r===Q||r===W?n=e.el:(i=".ic-action-like",n=e.el.querySelector(".ic-container"));const o=n.querySelector(".ic-author"),a=n.innerHTML;let{model:s}=e;if(r===Y){const{currentUserData:{authorAccountId:e,authorDisplayName:n,authorAvatarUrl:i}}=t;s={attributes:{containerId:s.get("containerId"),containerType:"page",spaceKey:s.get("spaceKey"),authorDisplayName:n,authorAvatarUrl:i,authorAccountId:e,commentId:s.get("id"),hasEditPermission:!0,hasDeletePermission:s.get("hasDeletePermission")}}}Object(ut.b)().then(e=>{Te.a.render(Me.a.createElement(gt.a.Provider,{value:{spaceKey:s.attributes.spaceKey,contentId:s.attributes.containerId}},Me.a.createElement(Ye.b,null,Me.a.createElement(We.b,{client:Object(et.b)()},Me.a.createElement(Qe.Provider,{store:vn},Me.a.createElement(mt.a.Provider,{value:e},Me.a.createElement(ht.a.Provider,{value:Object(g.b)()},Me.a.createElement(ft.a,null,Me.a.createElement(Ke.b,{client:Object(h.getAnalyticsWebClient)()},Me.a.createElement(yt.a,null,Me.a.createElement(Je.a,null,Me.a.createElement(lt,null,Me.a.createElement(dt.a,{namedRoutes:tt.a},Me.a.createElement(Xe.a,{attribution:Ze.a.COLLABORATION},Me.a.createElement(je.Fragment,null,Me.a.createElement("div",{dangerouslySetInnerHTML:{__html:a}}),Me.a.createElement(rn,{container:n,model:s,header:o,avatarSize:r!==Y&&r!==W?"medium":"small",showDate:r===X||r===J}),(e=>{if(e===W||e===Y||e===K||e===Q){const{onCancel:i,onSaveSuccess:r,onSaveError:o,onContentChange:a}=t;return Me.a.createElement(Qt,{container:n,model:s,type:e,onCancel:i,onSaveSuccess:r,onSaveError:o,onContentChange:a})}return Me.a.createElement(bn,{contentId:s.id,container:n,isReply:e===J,hasEditPermission:s.get("hasEditPermission")})})(r),i&&Me.a.createElement(on,{container:n,model:s,selector:i}),r===X&&Me.a.createElement(pt.a,{name:b.a.VIEW_INLINE_COMMENT_TOP_LEVEL}),Me.a.createElement(pt.a,{name:b.a.VIEW_PAGE_DISCOVER_INLINE_COMMENTS_FEATURE,attributes:{pageHasInlineComments:!0}}))))))))))))))),n)})};var En=m.a.View.extend({tagName:"div",className:"ic-create-comment-view",events:{"click .ic-action-save":"saveComment","click .ic-action-discard":"discardComment","keyup .ic-textarea":"onInput","focus .ic-textarea":"onFocus","click #show-page-comment":"showPageComment"},template:Ie.createComment,initialize(e){this.formatMessage=e.formatMessage,this.selection=e.selection,this.type=e.type,this.onFinished=e.onFinished||function(){},this.commentText=e.commentText||"",this.stopFocus=e.stopFocus,this.serializedHighlights=e.serializedHighlights,this.isMacroBrowserCheckEnabled=e.isMacroBrowserCheckEnabled,this.isFabricEditorDirty=!1,"edit"!==e.type&&"reply"!==e.type&&"edit-reply"!==e.type||(this.template=Ie.commentForm,m.a.trigger("ic:discard-edit"),this.listenTo(m.a,"ic:discard-edit",this.discardComment)),this.listenTo(m.a,"ic:sidebar:close",this.discardComment),A.isSPAPage()?(this.isTinymceResourceReady="true"===Object(i.default)("."+A.getPageContentClassName()).attr("data-editor-resource-loaded"),this.isPendingRenderEditor=!1,this.listenTo(m.a,"ic:tinymce-resource-loaded",this.tinymceResourceLoaded)):this.isTinymceResourceReady=!0},tinymceResourceLoaded(){this.isTinymceResourceReady=!0,this.isPendingRenderEditor&&(this.isPendingRenderEditor=!1,this.renderEditor())},finish(){this.onFinished(),o.a.trigger("ic-jim-async-supported")},async render(){const e=await this._getAuthorObject(),t={type:this.type,text:this.commentText,showMenu:!1,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled},n=d.a.extend({},e,t,{darkFeatures:A.getDarkFeatures()});return this.$el.html(this.template(n,this.formatMessage)),this.renderEditor(!0),Le(this),"true"===this.options.isFrontendPeopleDirectoryEnabled&&Fe(this),A.addSidebarHeadingTooltip(this),this},onInput(e){const t=""!==this.$(e.target).val().trim();this._saveDisable(!t)},onFocus(){if("edit"===this.type||"edit-reply"===this.type){const e=this.$(".textarea");A.moveCaretToEnd(e[0]),this._saveDisable(""===e.text())}},saveComment(e){e.preventDefault(),this._isValid()&&(this._disableForm(),"reply"===this.type?this._addReply():"edit"===this.type||"edit-reply"===this.type?this._saveEdit():this._addComment())},_getAuthorObject(){let e,t,n;return"edit"===this.type||"edit-reply"===this.type?(e=this.model.get("authorAvatarUrl"),t=this.model.get("authorDisplayName"),n=this.model.get("authorAccountId"),Promise.resolve({authorAvatarUrl:e,authorDisplayName:t,authorAccountId:n})):A.getCurrentUserData()},_saveEdit(){const e=this._getContent(),t={wait:!0,beforeSend:d.a.bind(this.beforeSendAjax,this),success:d.a.bind(this._onSaveSuccess,this),error:d.a.bind(this._onEditError,this)};Object(g.b)().start({name:b.a.EDIT_INLINE_COMMENT_PUBLISH,timeout:Be.a.EDITOR_PUBLISH,attributes:{editor:P.d.TINY_MCE,mode:"view"}}),this.model.save({body:e},t)},_onEditError(e,t){if(this.showCaptchaError(t))return;let n,i;401===t.status?(i=this.formatMessage({id:"inline.comments.edit.permission"}),n="legacy-inline-comments edit permission error; status = "+t.status):(i=this.formatMessage({id:"inline.comments.server.edit.error"}),n="legacy-inline-comments edit error; status = "+t.status),this._triggerError(i),Object(g.c)(b.a.EDIT_INLINE_COMMENT_PUBLISH,new Error(n))},_triggerError(e,t){m.a.trigger("ic:error",e,t),this._disableForm(!1)},_addReply(){const e=new F({body:this._getContent(),commentId:this.model.get("id"),hasDeletePermission:Boolean(o.a.Meta.get("atlassian-account-id"))||this.model.get("hasDeletePermission")});Object(g.b)().start({name:b.a.REPLY_TO_INLINE_COMMENT_PUBLISH,timeout:Be.a.EDITOR_PUBLISH,attributes:{editor:P.d.TINY_MCE,mode:"view"}}),e.save(null,{beforeSend:d.a.bind(this.beforeSendAjax,this),success:d.a.bind(this._onSaveSuccess,this),error:d.a.bind((function(e,t){this.showCaptchaError(t)||(this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.save.reply"})),Object(g.c)(b.a.REPLY_TO_INLINE_COMMENT_PUBLISH,new Error("legacy-inline-comments reply save error; status = "+t.status)))}),this)})},_addComment(){const e=new V({originalSelection:this.selection.searchText.selectedText.replace(/\n/g,""),body:this._getContent(),matchIndex:this.selection.searchText.index,numMatches:this.selection.searchText.numMatches,serializedHighlights:this.serializedHighlights});Object(g.b)().start({name:b.a.ADD_INLINE_COMMENT_PUBLISH,timeout:Be.a.EDITOR_PUBLISH,attributes:{editor:P.d.TINY_MCE,mode:"view"}}),e.save(null,{beforeSend:d.a.bind(this.beforeSendAjax,this),success:d.a.bind(this._onSaveSuccess,this),error:d.a.bind(this._onAddError,this)})},_onAddError(e,t){if(this.showCaptchaError(t))return;let n;409===t.status?(this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.stale"},{0:"<a href='#' class='ic-reload-page'>",1:"</a>"}),{callback:this.bindPageReloadLink}),n="legacy-inline-comments stale page; status = "+t.status):412===t.status?(o.a.trigger("analytics",{name:"confluence.comment.inline.cannot.create"}),this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.create.comment"})),n="legacy-inline-comments error create; status = "+t.status):(this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.save.comment"})),n="legacy-inline-comments error save; status = "+t.status),Object(g.c)(b.a.ADD_INLINE_COMMENT_PUBLISH,new Error(n))},_isValid(){return"<p><br /></p>"!==i.default.trim(this._getContent())||(m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.sidebar.comment.empty"})),!1)},_onSaveSuccess(e){let t;switch(this.type){case"topLevel":e.set&&e.set("hasDeletePermission",!0),m.a.trigger("ic:persist",e),m.a.trigger("ic:view",e,void 0),t=b.a.ADD_INLINE_COMMENT_PUBLISH;break;case"reply":this.model.replies.push(e),m.a.trigger("ic:reply:persist",e),this.finish(),t=b.a.REPLY_TO_INLINE_COMMENT_PUBLISH;break;case"edit":case"edit-reply":m.a.trigger("ic:edit"),this.finish(),t=b.a.EDIT_INLINE_COMMENT_PUBLISH}Object(g.b)().succeed({name:t})},_setEditorIsNotDirty(){o.a&&o.a.Rte&&o.a.Rte.getEditor&&o.a.Rte.getEditor()&&(o.a.Rte.getEditor().isNotDirty=1)},_disableForm(e){void 0===e&&(e=!0),this._saveDisable(e),A.getDarkFeatures().RICH_TEXT_EDITOR||this.$(".ic-action-discard,.ic-textarea").prop("disabled",e).attr("aria-disabled",e)},_saveDisable(e){if(A.getDarkFeatures().RICH_TEXT_EDITOR){Ge.setEditorBusy(e);const t=Object(i.default)("#rte-button-cancel");t.length>0&&(t[0].disabled=e)}else this.$(".ic-action-save").prop("disabled",e).attr("aria-disabled",e)},renderEditor(e){const t=this,n=this.$(".ic-body"),r=this.commentText;if(!e){const e=o.a.Confluence.QuickEdit.QuickComment;if(o.a.Confluence.QuickEdit)try{o.a.Confluence.QuickEdit.deactivateEditor()}catch(a){}return Ge.init({formatMessage:t.formatMessage,container:n,form:n.find("form.aui"),saveHandler:"pageComment"===this.type?e.createSaveHandler(d.a.bind(this._successCreatePageComment,this),e.saveCommentErrorHandler):d.a.bind(this.saveComment,this),cancelHandler:d.a.bind(this.discardComment,this),fetchContent(){const e=new i.default.Deferred;return e.resolve({editorContent:r}),e},postDeactivate:d.a.bind((function(){m.a.trigger("ic:clearError"),this.finish()}),this),hideCancelButton:"topLevel"===this.type,isMacroBrowserCheckEnabled:this.isMacroBrowserCheckEnabled}).done(d.a.bind(this.renderEditorCompleted,this)).fail(d.a.bind(this.renderEditorFail,this))}{let e;switch(this.type){case"edit":e=K;break;case"reply":e=Y;break;case"edit-reply":e=Q,this.model.set({containerId:o.a.Meta.get("latest-page-id"),containerType:"page"});break;case"topLevel":default:e=W,this.model=new V({authorAccountId:A.getAuthorAccountId(),originalSelection:this.selection.searchText.selectedText.replace(/\n/g,""),matchIndex:this.selection.searchText.index,numMatches:this.selection.searchText.numMatches,serializedHighlights:this.serializedHighlights,parentCommentId:0})}this.model.set({spaceKey:o.a.Meta.get("space-key")}),yn(this,{viewToRender:e,onCancel:this.discardComment.bind(this),onSaveSuccess:e=>this.onFabricSaveSuccess(e),onSaveError:e=>this.onFabricSaveError(e),onContentChange:()=>this.onFabricContentChange(),currentUserData:{authorAccountId:A.getAuthorAccountId(),authorAvatarUrl:A.getAuthorAvatarUrl(),authorDisplayName:A.getAuthorDisplayName()}}),this.isReactRootMounted=!0}},showPageComment(e){const t=Object(i.default)(e.target).data("comment-id"),n=Object(i.default)("#comment-"+t);n.addClass("focused"),n.scrollToElement()},_successCreatePageComment(e){c.a.Confluence.CommentDisplayManager.addComment(A.getCurrentUserInfo(),e,!1,!1,!0),o.a.trigger("page.commentAddedOrUpdated",{commentId:e.id}),this._setEditorIsNotDirty(),A.getDarkFeatures().RICH_TEXT_EDITOR&&(this.keepSidebar=!0,Ge.remove()),this.$el.html(Ie.pageComment({commentId:e.id},this.formatMessage)),A.addSidebarHeadingTooltip(this)},renderEditorCompleted(){m.a.trigger("ic:clearError"),"topLevel"!==this.type&&"pageComment"!==this.type||(this.$("#rte-button-cancel").hide(),"pageComment"===this.type&&(m.a.trigger("ic:error",this.formatMessage({id:"page.comments.sidebar.warning"})),this.focusEditor())),this.captchaManager=new o.a.Confluence.QuickEditCaptchaManager(o.a.Confluence.EditorLoader.getEditorForm()),"topLevel"===this.type?Object(g.b)().succeed({name:b.a.ADD_INLINE_COMMENT_LOAD}):"edit"===this.type||"edit-reply"===this.type?Object(g.b)().succeed({name:b.a.EDIT_INLINE_COMMENT_LOAD}):"reply"===this.type&&Object(g.b)().succeed({name:b.a.REPLY_TO_INLINE_COMMENT_LOAD})},renderEditorFail(){const e={closeable:!0,callback:this.bindPageReloadLink};switch(this.type){case"pageComment":this._setEditorIsNotDirty();break;case"topLevel":this.$(".loading-container").hide(),this.$(".ic-create-comment").hide(),e.closeable=!1;break;case"edit":case"edit-reply":case"reply":this.finish()}m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.editor.timeout"},{0:"<a href='#' class='ic-reload-page'>",1:"</a>"}),e),m.a.trigger("ic:editor:load:fail")},bindPageReloadLink(){Object(i.default)(".ic-error").off("click",".ic-reload-page").on("click",".ic-reload-page",()=>(c.a.location.reload(),!1))},discardComment(e){e&&e.preventDefault(),this.isFabricEditorDirty=!1,m.a.trigger("ic:fabric-editor-dirty",!1),"edit"!==this.type&&"edit-reply"!==this.type&&"reply"!==this.type||Object(g.b)().abort({name:"reply"===this.type?b.a.REPLY_TO_INLINE_COMMENT:b.a.EDIT_INLINE_COMMENT,reason:"cancel pressed"}),m.a.trigger("ic:clearError"),this.finish()},_getContent(){return A.getDarkFeatures().RICH_TEXT_EDITOR?Ge.getContent():this.$("textarea").val()},focusEditor(){if(A.getDarkFeatures().RICH_TEXT_EDITOR)if("pageComment"===this.type){const e=Object(i.default)(o.a.Rte.getEditor()&&o.a.Rte.getEditor().getBody()).find("div")[0];o.a.Rte.getEditor().selection.select(e,1),o.a.Rte.getEditor().selection.collapse(1),e.focus()}else o.a&&o.a.Rte&&o.a.Rte.getEditor&&o.a.Rte.getEditor()&&o.a.Rte.getEditor().focus();else this.$(".ic-textarea:visible").focus()},destroy(){A.getDarkFeatures().RICH_TEXT_EDITOR&&Ge.remove(),this.unmountReactBridge(),this.remove()},beforeSendAjax(e){const t=this.captchaManager.getCaptchaData();t&&t.id&&(e.setRequestHeader("X-Atlassian-Captcha-Id",t.id),e.setRequestHeader("X-Atlassian-Captcha-Response",t.response))},showCaptchaError(e){return!(404!==e.status||!e.responseText||-1==e.responseText.search(/captcha/i))&&(this.captchaManager.refreshCaptcha(),this._triggerError(this.formatMessage({id:"captcha.response.failed"})),!0)},trackAnalyticEvent(e,t){let n,r,a;try{n=e.attributes.id.toString(),r=e.changed.active?null:e.attributes.commentId.toString(),a=Object(i.default)(".view-page-body").get(0).dataset.spaceId}catch(c){}const s={containerType:"space",containerId:a,source:"viewPageScreen",objectType:"page",objectId:o.a.Meta.get("content-id"),action:"edit"===t||"edit-reply"===t?"updated":"created",actionSubject:"comment",actionSubjectId:n,attributes:{commentType:"inline",pageType:o.a.Meta.get("draft-type"),parentCommentId:r,editor:P.d.FABRIC}};Object(h.getAnalyticsWebClient)().then(e=>{e.sendTrackEvent(s)})},onFabricSaveSuccess(e){if(m.a.trigger("ic:clearError"),this.isFabricEditorDirty=!1,m.a.trigger("ic:fabric-editor-dirty",!1),"reply"===this.type){const t=new F(e);this._onSaveSuccess(t)}else this.model.set(e),this._onSaveSuccess(this.model)},onFabricSaveError(e){this._triggerError(this.formatMessage({id:e}))},onFabricContentChange(){this.isFabricEditorDirty||(this.isFabricEditorDirty=!0,m.a.trigger("ic:fabric-editor-dirty",!0))},unmountReactBridge(){if(this.isReactRootMounted){const e=this.el;Te.a.unmountComponentAtNode(e)&&(this.isReactRootMounted=!1)}}}),Cn=m.a.View.extend({tagName:"div",className:"ic-confirm-container",initialize(e){this.formatMessage=e.formatMessage,this.$menuEl=e.$menuEl,this.$bodyEl=e.$bodyEl,this.$menuEl.addClass("ic-action-menu-active"),this.render(),d.a.bindAll(this,"clickOutside"),this.$bodyEl.on("click",this.clickOutside)},events:{"click .ic-action-cancel-confirm":"cancel","click .ic-action-delete-confirm":"confirm"},template:Ie.confirmDialog,render(){return this.$el.html(this.template(this.model.toJSON(),this.formatMessage)),this},clickOutside(e){i.default.contains(this.el,e.target)||this.el===e.target||this.cancel()},cancel(){this.destroy()},confirm(){this.trigger("ic:confirm"),this.destroy()},destroy(){this.$bodyEl.off("click",this.clickOutside),this.$menuEl.removeClass("ic-action-menu-active"),this.remove()}}),In=m.a.View.extend({tagName:"div",className:"ic-display-reply",template:Ie.renderReply,events:{"click .ic-action-edit-reply":"editReply","click .ic-action-delete-reply":"confirmDelete"},initialize(e){this.formatMessage=e.formatMessage,this.isFabricEditorDirty=!1,this.listenTo(m.a,"ic:fabric-editor-dirty",this.setIsFabricEditorDirty),d.a.bindAll(this,"onEditCallback"),this.$el.attr("data-comment-id",this.model.get("id"))},_renderLikes(){const e=this.el&&this.el.querySelector(".ic-action-like-reply");this.options.shouldShowInlineCommentLikes?this.options.shouldShowInlineCommentLikes.then(t=>{t?(this.likesView&&this.likesView.remove(),this.likesView=new Ve({contentId:this.model.id,el:e,container:this.el,selector:".ic-action-like-reply"}).render()):e&&e.remove()}):e&&e.remove()},render(){try{const e=d.a.extend(this.model.toJSON(),{resolved:this.options.resolved,darkFeatures:A.getDarkFeatures(),isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled});if(!0===this.isReactRootMounted){Te.a.unmountComponentAtNode(this.el)&&(this.isReactRootMounted=!1)}const t=this.template(e,this.formatMessage);this.$el.html(t),yn(this,{viewToRender:J}),this.isReactRootMounted=!0}catch(e){Object(g.b)().fail({name:b.a.VIEW_INLINE_COMMENT_REPLY,error:e})}return"true"===this.options.isFrontendPeopleDirectoryEnabled&&Fe(this),this},editReply(e){if(A.confirmProcess(this.formatMessage,!1,this.isFabricEditorDirty)){Object($.b)({name:b.a.EDIT_INLINE_COMMENT,id:_()(),attributes:{editor:P.d.FABRIC,type:"reply",mode:L.c.VIEW,framework:L.b.BACKBONE}},{name:b.a.EDIT_INLINE_COMMENT_LOAD},{name:b.a.EDIT_INLINE_COMMENT_PUBLISH});A.getEditorFormat(this.model.get("id")).done(e=>{Te.a.unmountComponentAtNode(this.el)&&(this.isReactRootMounted=!1),this.editView=new En({model:this.model,type:"edit-reply",selection:{},onFinished:this.onEditCallback,commentText:e,formatMessage:this.formatMessage,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,isFrontendPeopleDirectoryEnabled:this.options.isFrontendPeopleDirectoryEnabled,isMacroBrowserCheckEnabled:this.options.isMacroBrowserCheckEnabled}),this.$el.html(this.editView.$el),this.editView.render()}).fail((e,t,n)=>{A.failEditDisplay(this.formatMessage({id:"inline.comments.server.error.edit.reply"}),{errorThrown:n})})}else e&&e.currentTarget.blur()},onEditCallback(){this.editView&&this.editView.destroy(),this.editView=null,this.render()},deleteFail(e,t){401===t.status?m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.delete.permission"})):m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.server.error"}))},confirmDelete(e){!0===window.confirm(this.formatMessage({id:"inline.comments.delete.reply.confirmation.message"}))&&this.deleteReply(e)},deleteReply(e){Object(i.default)(e.target).attr("aria-disabled",!0).prop("disabled",!0),this.model.destroy({wait:!0,error:this.deleteFail,success(){m.a.trigger("ic:reply:delete")}})},destroy(){this.likesView&&this.likesView.remove(),this.editView&&this.editView.destroy(),this.remove()},setIsFabricEditorDirty(e){this.isFabricEditorDirty=e}}),On=m.a.View.extend({tagName:"div",className:"ic-replies",events:{"click #ic-showmore-container":"forceShowAllReplies"},initialize(e){if(this.formatMessage=e.formatMessage,!e.commentModel)throw new Error("Inline Comment Model should be passed as a parameter when init ReplyListView","ReplyListView");this.replyViews=[],this.collection=e.commentModel.replies,this.source=e.source,this.listenTo(this.collection,"add remove",this.render),!0!==this.collection.isFetched&&(this.listenToOnce(this.collection,"sync",this.fetchComplete),this.collection.fetch({reset:!0,cache:!1})),this.expandReplies=!1,this.COMMENT_NUMBER_TO_COLLAPSE=4},fetchComplete(){this.collection.isFetched=!0,this.render(),A.resizeContentAfterLoadingImages(this.$el)},render(e){if(!0!==this.collection.isFetched)return this;this.replyExperienceHasStarted||(this.replyExperienceHasStarted=!0,Object(g.b)().start({name:b.a.VIEW_INLINE_COMMENT_REPLY,attributes:{mode:L.c.VIEW,framework:L.b.BACKBONE}}));try{return e&&this.collection.last()===e?void this.appendReply(e):(this.cleanUpReplyViews(),this.$el.empty(),this.collection.length>this.COMMENT_NUMBER_TO_COLLAPSE&&!1===this.expandReplies&&"permalink"!==this.source&&this.options.commentModel&&!this.options.commentModel.isResolved()?this.renderCollapsibleReplies():this.renderFullReplies(),this.trigger("ic:reply-rendered",this.options.commentModel),this._hightlightReply(),o.a.trigger("ic-jim-async-supported"),this)}catch(t){Object(g.b)().fail({name:b.a.VIEW_INLINE_COMMENT_REPLY,error:t})}},renderFullReplies(){0===this.collection.length&&Object(g.b)().succeed({name:b.a.VIEW_INLINE_COMMENT_REPLY}),this.collection.each((function(e){this.appendReply(e)}),this)},forceShowAllReplies(){this.expandReplies=!0,this.render()},renderCollapsibleReplies(){this.renderExpendButton();const e=this.collection.last();this.appendReply(e)},appendReply(e){const t=this.createReplyView(e);this.replyViews.push(t),this.$el.append(t.render().el)},renderExpendButton(){this.$el.append(Ie.showmoreReply({totalReplies:this.collection.length-1},this.formatMessage))},createReplyView(e){return new In({formatMessage:this.formatMessage,model:e,resolved:this.options.commentModel.isResolved(),shouldShowInlineCommentLikes:this.options.shouldShowInlineCommentLikes,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,isFrontendPeopleDirectoryEnabled:this.options.isFrontendPeopleDirectoryEnabled,isMacroBrowserCheckEnabled:this.options.isMacroBrowserCheckEnabled})},_hightlightReply(){if("permalink"!==this.source)return;const e=c.a.location.search.match(/(focusedCommentId|replyToComment)=(\d+)/);if(null==e)return;const t=parseInt(e[2],10);t&&0!==t&&this.$(`[data-comment-id=${t}]`).addClass("ic-comment-reply-highlight")},cleanUpReplyViews(){let e;for(e=0;e<this.replyViews.length;e++)this.replyViews[e].destroy(),this.replyViews[e]=null;this.replyViews=[]},destroy(){this.cleanUpReplyViews(),this.remove()}});let wn=!1;var Tn=m.a.View.extend({tagName:"div",events:{"click #ic-nav-previous":"showPrevious","click #ic-nav-next":"showNext"},template:Ie.navigation,initialize(e){this.formatMessage=e.formatMessage,this.isFabricEditorDirty=!1,this.collection=this.model.collection,this.listenTo(this.collection,"change:resolveProperties",this.onResolveToggle),this.disabled=this.collection.getCommentsOnPageCount()<=1,this.listenTo(m.a,"ic:show-previous",this.showPrevious),this.listenTo(m.a,"ic:show-next",this.showNext),this.listenTo(m.a,"ic:fabric-editor-dirty",this.setIsFabricEditorDirty)},render(){return this.$el.html(this.template({disabled:this.disabled,showIndex:!(this.model.isResolved()||this.model.get("deleted")),index:this.collection.getActiveIndexWithinPageComments()+1,size:this.collection.getCommentsOnPageCount()},this.formatMessage)),this},onResolveToggle(){this.disabled=this.collection.getCommentsOnPageCount()<=1,this.render()},showPrevious(e){if(!this.disabled&&!wn&&A.confirmProcess(this.formatMessage,!1,this.isFabricEditorDirty)){const t=this.collection.getPrevCommentOnPage();null!=t&&(m.a.trigger("ic:view",t,"nav"),e.clientX>0||e.clientY>0?this.sendAnalytics("clicked","previous"):this.sendAnalytics("pressed","previous")),e.view||(wn=!0,setTimeout(()=>{wn=!1},500))}},showNext(e){if(!this.disabled&&!wn&&A.confirmProcess(this.formatMessage,!1,this.isFabricEditorDirty)){const t=this.collection.getNextCommentOnPage();null!=t&&(m.a.trigger("ic:view",t,"nav"),e.clientX>0||e.clientY>0?this.sendAnalytics("clicked","next"):this.sendAnalytics("pressed","next")),e.view||(wn=!0,setTimeout(()=>{wn=!1},500))}},setIsFabricEditorDirty(e){this.isFabricEditorDirty=e},async sendAnalytics(e,t){const n=await A.getAnalyticsClient,{attributes:{containerId:i}}=this.model,r={source:"inlineCommentsSideBar",actionSubjectId:t,objectType:"comment",objectId:String(this.model.id),attributes:{pageId:i}};"pressed"===e?(r.action="pressed",r.attributes.key="previous"===t?"p":"n",r.actionSubject="keyboardShortcut"):(r.action="clicked",r.actionSubject="button"),n.sendUIEvent(r)}}),kn=m.a.View.extend({tagName:"div",className:"ic-display-comment-view",template:Ie.displayComment,events:{"click .ic-action-reply":"replyComment","click .ic-action-resolve":"resolveComment","click .ic-action-edit":"editComment","click #show-resolved-comments":"showResolvedDialogDiscovery","click .ic-reply-placeholder .textarea":"replyComment","focus .ic-reply-container .textarea":"onReplyPlaceholderFocus"},initialize(e){this.formatMessage=e.formatMessage,this.isFabricEditorDirty=!1,d.a.bindAll(this,"confirm","destroy","deleteFail","replyComment","resolveComment","editComment","renderCommentOnly"),this.model.set("active",!0),this.listenTo(this.model,"change:resolveProperties",this.render),this.listenTo(this.model,"remove",this.destroy),this.listenTo(m.a,"ic:fabric-editor-dirty",this.setIsFabricEditorDirty),Object(i.default)("body").on("click",".ic-action-delete a",this.confirm),Object(i.default)("body").on("click",".ic-action-reply a",this.replyComment),Object(i.default)("body").on("click",".ic-action-resolve a",this.resolveComment),Object(i.default)("body").on("click",".ic-action-edit a",this.editComment),this.replyListView=new On({formatMessage:this.formatMessage,commentModel:this.model,source:e.source,shouldShowInlineCommentLikes:this.options.shouldShowInlineCommentLikes,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,isMacroBrowserCheckEnabled:this.options.isMacroBrowserCheckEnabled,isFrontendPeopleDirectoryEnabled:this.options.isFrontendPeopleDirectoryEnabled})},render(){return Object(g.b)().start({name:b.a.VIEW_INLINE_COMMENT_TOP_LEVEL,attributes:{totalReplies:this.model.replies&&this.model.replies.length,mode:L.c.VIEW,framework:L.b.BACKBONE}}),A.getCurrentUserData().then(e=>{this.$el.html(this.template(d.a.extend(this.model.toJSON(),{showMenu:!0,currentAuthorAvatarUrl:e.authorAvatarUrl,currentAuthorDisplayName:e.authorDisplayName,currentAuthorAccountId:e.authorAccountId,darkFeatures:A.getDarkFeatures(),isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled}),this.formatMessage)),this.model.isResolved()?this.$(".ic-comment-container").addClass("ic-resolved"):this.$(".ic-list").append(this.replyListView.render().el),this._renderNavigation(),A.addSidebarHeadingTooltip(this),yn(this),this.isReactRootMounted=!0,"true"===this.options.isFrontendPeopleDirectoryEnabled&&Fe(this)}).catch(e=>{Object(g.c)(b.a.VIEW_INLINE_COMMENT_TOP_LEVEL,e)}),this},_renderNavigation(){this.navigationView&&this.navigationView.remove(),this.navigationView=new Tn({model:this.model,formatMessage:this.formatMessage}),this.navigationView.render(),this.$("#ic-nav-container").html(this.navigationView.el)},_renderLikes(){const e=this.el&&this.el.querySelector(".ic-action-like");this.options.shouldShowInlineCommentLikes?this.options.shouldShowInlineCommentLikes.then(t=>{t?(this.likesView&&this.likesView.remove(),this.likesView=new Ve({contentId:this.model.id,containerId:this.model.get("containerId"),containerType:this.model.get("containerType"),el:e,container:this.el,selector:".ic-action-like"}).render()):e&&e.remove()}):e&&e.remove()},editComment(e){if(e.preventDefault(),Object($.b)({name:b.a.EDIT_INLINE_COMMENT,attributes:{editor:P.d.FABRIC,type:"topLevel",mode:L.c.VIEW,framework:L.b.BACKBONE}},{name:b.a.EDIT_INLINE_COMMENT_LOAD},{name:b.a.EDIT_INLINE_COMMENT_PUBLISH}),this.editView)this.editView.focusEditor();else if(A.confirmProcess(this.formatMessage,!1,this.isFabricEditorDirty)){A.getEditorFormat(this.model.get("id")).done(e=>{const t=this.el.querySelector(".ic-container");Te.a.unmountComponentAtNode(t)&&(this.isReactRootMounted=!1),this.editView=new En({model:this.model,type:"edit",selection:{},onFinished:this.renderCommentOnly,commentText:e,formatMessage:this.formatMessage,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled,isFrontendPeopleDirectoryEnabled:this.options.isFrontendPeopleDirectoryEnabled,isMacroBrowserCheckEnabled:this.options.isMacroBrowserCheckEnabled}),this.$(".ic-display-comment").html(this.editView.$el),this.editView.render()}).fail((e,t,n)=>{A.failEditDisplay(this.formatMessage({id:"inline.comments.server.error.edit.comment"}),{errorThrown:n})})}},renderCommentOnly(){this.editView&&this.editView.destroy(),this.editView=null;const e=d.a.extend(this.model.toJSON(),{darkFeatures:A.getDarkFeatures()});if(this.isReactRootMounted){const e=this.el.querySelector(".ic-container");Te.a.unmountComponentAtNode(e)&&(this.isReactRootMounted=!1)}this.$(".ic-display-comment").html(Object(i.default)(Ie.comment(e,this.formatMessage)).children()),this.isReactRootMounted||(yn(this),this.isReactRootMounted=!0)},replyComment(e){e&&e.preventDefault(),Object($.b)({name:b.a.REPLY_TO_INLINE_COMMENT,attributes:{editor:P.d.FABRIC,mode:L.c.VIEW,framework:L.b.BACKBONE}},{name:b.a.REPLY_TO_INLINE_COMMENT_LOAD},{name:b.a.REPLY_TO_INLINE_COMMENT_PUBLISH}),this.createReplyView?this.createReplyView.focusEditor():A.confirmProcess(this.formatMessage,!1,this.isFabricEditorDirty)?(this.createReplyView=new En({formatMessage:this.formatMessage,model:this.model,type:"reply",isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,onFinished:d.a.bind((function(){this.createReplyView&&this.createReplyView.destroy(),this.createReplyView=null}),this),isFrontendPeopleDirectoryEnabled:this.options.isFrontendPeopleDirectoryEnabled,isMacroBrowserCheckEnabled:this.options.isMacroBrowserCheckEnabled}),this.$(".ic-reply-container").prepend(this.createReplyView.$el),this.createReplyView.render()):e&&e.currentTarget.blur()},confirm(e){if(e.preventDefault(),this.model.replies.length>0)return m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.delete.with.reply"})),!1;const t=new Cn({formatMessage:this.formatMessage,model:new m.a.Model({label:this.formatMessage({id:"inline.comments.sidebar.delete"}),message:this.formatMessage({id:"inline.comments.delete.confirmation.message"})}),$menuEl:Object(i.default)(".ic-action-menu"),$bodyEl:Object(i.default)("body")});this.$(".ic-sidebar-heading").append(t.$el),this.listenTo(t,"ic:confirm",this.deleteComment)},deleteComment(){Object(g.b)().start({name:b.a.DELETE_INLINE_COMMENT,mode:L.c.VIEW,framework:L.b.BACKBONE}),this.model.destroy({wait:!0,success:()=>{this.$el.html(Ie.deleteComment(this.formatMessage)),this.model.set("deleted",!0),this._renderNavigation(),A.removeInlineLinksDialog(this.model.highlights),A.addSidebarHeadingTooltip(this),Object(g.b)().succeed({name:b.a.DELETE_INLINE_COMMENT}),m.a.trigger("ic:delete"),this.sendAnalytics("deleted",this.model)},error:this.deleteFail})},deleteFail(e,t){let n;n=401===t.status?this.formatMessage({id:"inline.comments.delete.permission"}):409===t.status?t.responseText:this.formatMessage({id:"inline.comments.server.error"}),Object(g.b)().fail({name:b.a.DELETE_INLINE_COMMENT,error:n}),m.a.trigger("ic:error",n)},destroy(e){Object(i.default)("body").off("click",".ic-action-delete a",this.confirm),Object(i.default)("body").off("click",".ic-action-reply a",this.replyComment),Object(i.default)("body").off("click",".ic-action-resolve a",this.resolveComment),Object(i.default)("body").off("click",".ic-action-edit a",this.editComment),this.createReplyView&&this.createReplyView.destroy(),this.editView&&this.editView.destroy(),this.replyListView.destroy(),this.navigationView&&this.navigationView.remove(),this.likesView&&this.likesView.remove(),!0!==e&&this.remove()},setIsFabricEditorDirty(e){this.isFabricEditorDirty=e},resolveComment(e){e&&e.preventDefault(),A.confirmProcess(this.formatMessage,!0,this.isFabricEditorDirty)&&(Object(g.b)().start({name:b.a.RESOLVE_INLINE_COMMENT,attributes:{resolved:!0,mode:L.c.VIEW,framework:L.b.BACKBONE}}),this.model.resolve(!0,{wait:!0,success:d.a.bind(this.onResolveComplete,this),error:this.onResolveFail}))},onResolveComplete(){this.createReplyView&&this.createReplyView.destroy(),this.createReplyView=null,Object(g.b)().succeed({name:b.a.RESOLVE_INLINE_COMMENT}),m.a.trigger("ic:resolved"),A.removeInlineLinksDialog(this.model.highlights),this.sendAnalytics("resolved",this.model)},onResolveFail(e,t){let n;n=401===t.status?this.formatMessage({id:"inline.comments.resolve.permission"}):this.formatMessage({id:"inline.comments.server.error"}),Object(g.b)().fail({name:b.a.RESOLVE_INLINE_COMMENT,error:n}),m.a.trigger("ic:error",n)},showResolvedDialogDiscovery(){m.a.trigger("ic:resolved:show:recovery")},onReplyPlaceholderFocus(e){if(A.getDarkFeatures().RICH_TEXT_EDITOR){-1!==navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&e.currentTarget.blur()}},async sendAnalytics(e,t){const n=await A.getAnalyticsClient,{attributes:{id:i,containerId:r}}=t;n.sendTrackEvent({source:"viewPageScreen",action:e,actionSubject:"comment",actionSubjectId:String(i),objectType:"page",objectId:r,attributes:{pageType:o.a.Meta.get("draft-type"),commentType:"inline"}})}});var Nn=m.a.View.extend({tagName:"div",className:"ic-sidebar",events:{"click button.ic-action-hide":function(e){this.hide(e,!0)&&(this.sendUIEvent(),m.a.trigger("ic:sidebar:close"),Object(g.b)().abort({name:b.a.ADD_INLINE_COMMENT,reason:"close sidebar"}),Object(g.b)().abort({name:b.a.EDIT_INLINE_COMMENT,reason:"close sidebar"}),Object(g.b)().abort({name:b.a.REPLY_TO_INLINE_COMMENT,reason:"close sidebar"}))},"updateYPosition .ic-display-comment-view > .ic-comment-container":function(){this.setSidebarYPos()},"requestInlineCommentsClose .ic-display-comment-view > .ic-comment-container":function(e){const t=e.originalEvent.detail;let n;if(null!=this.commentView)n=this.commentView.model.highlight;else{if(null==this.createCommentView)return;n=Object(i.default)(".ic-current-selection")}if(t.parentElement.contains(n[0])){!1===this.hide(null,!0)?e.preventDefault():m.a.trigger("ic:sidebar:close")}}},initialize(e){e=e||{};const t=this;this.analyticsClient=A.getAnalyticsClient,this.shouldSqueeze=e.shouldSqueeze,this.formatMessage=e.formatMessage,this.isFabricEditorDirty=!1,this.isScrollToActiveHighlightCalled=!1,this.listenTo(m.a,"ic:view ic:overlap",this.displayComment),this.listenTo(m.a,"ic:create",this.displayCreateComment),this.listenTo(m.a,"ic:error",this.displayError),this.listenTo(m.a,"ic:hide-sidebar",this.hide),this.listenTo(m.a,"ic:clearError",this.clearError),this.listenTo(m.a,"ic:fabric-editor-dirty",this.setIsFabricEditorDirty),A.getDarkFeatures().RICH_TEXT_EDITOR?o.a.bind("rte-quick-edit-ready.ic-sidebar",()=>{const e=t.$el.find("#wysiwygTextarea_ifr");if(0!==e.length){new MutationObserver(()=>{e.resize()}).observe(e[0],{attributes:!0,attributeFilter:["style"]}),o.a&&o.a.Rte&&o.a.Rte.getEditor&&!o.a.Rte.getEditor().getContent()&&t._scrollToEditorView(e)}else{t.$el.is(":visible")||(t.$wikiContent.css("position","static"),v.destroy())}}):o.a.bind("init.rte.ic-sidebar",d.a.bind(this.hideInEditMode,this)),this.defaultNavOffset=130,this.defaultPermalinkedCommentOffset=100,this.$wikiContent=e.$wikiContent||Object(i.default)("[data-inline-comments-target=true]").first(),this.sidebarObserver=new MutationObserver(d.a.bind(this.setSidebarYPos,this)),this.sidebarObserver.observe(this.el,{childList:!0,subtree:!0}),Object(i.default)(c.a).on("resize.ic-sidebar",d.a.debounce(d.a.bind(this.setSidebarYPos,this),100)),o.a.bind("sidebar.expanded sidebar.collapsed.ic-sidebar",d.a.debounce(d.a.bind(this.setSidebarYPos,this),50));Object(i.default)("#confluence-ui .wrapper-space-view-page").length>0&&this.$el.addClass("ic-is-spa-view-page"),this.$el.addClass("ic-is-fabric-renderer-enabled")},destroy(){o.a.unbind(".ic-sidebar"),Object(i.default)(c.a).off(".ic-sidebar"),this.hide(),this.remove()},displayComment(e,t,n){let r;this.sendTrackEvent(e),e.highlights.each(t=>{const n=e.highlights[t],o=Object(i.default)(n).closest('div[mode="stick"]').length>0,a=Object(i.default)(n).closest(".pm-table-container .pm-table-wrapper").length>0;(o||a&&!r)&&(r=Object(i.default)(n))}),r&&r!==e.highlight&&(e.highlight=r);(function(){if(e.highlight.is(":hidden")&&(A.showHighlightContent(e.highlight),e.highlight.is(":hidden")))return;this.isFabricEditorDirty=!1,m.a.trigger("ic:fabric-editor-dirty",!1),this.distanceToTop=this.previousHighlightOffset||this.defaultNavOffset,this._emptySidebar(!0),this.commentView=new kn({formatMessage:this.formatMessage,model:e,source:t,shouldShowInlineCommentLikes:this.options.shouldShowInlineCommentLikes,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,isFrontendPeopleDirectoryEnabled:this.options.isFrontendPeopleDirectoryEnabled,isMacroBrowserCheckEnabled:this.options.isMacroBrowserCheckEnabled}),this.show(!0);const r=this.$wikiContent.offset()||Object(i.default)("[data-inline-comments-target=true]").first().offset()||{top:0},o=e.highlight.offset().top-r.top;this.previousHighlightOffset=o;const a=this.commentView.render().$el;a.css("visibility","hidden"),"nav"===t?A.scrollToActiveHighlight(o,this.distanceToTop):"permalink"!==t||this.isScrollToActiveHighlightCalled?"quickreload"===t?this._scrollToQuickReloadComment(e):"programmaticClick"===t&&c.a.scrollTo(0,o):(this.isScrollToActiveHighlightCalled=!0,A.scrollToActiveHighlight(o,this.defaultPermalinkedCommentOffset).done(()=>{n&&n.isReplyComment&&this.commentView.replyComment()})),this.$el.html(a),c.a.Confluence.Binder&&c.a.Confluence.Binder.userHover()}).call(this),o.a.trigger("ic-jim-async-supported")},_scrollToQuickReloadComment(e){const t=Object(i.default)(".qr-feedback:first");let n=this.defaultPermalinkedCommentOffset;t.length>0&&(n=t.height()+67);const r=e.highlight.position().top;A.scrollToActiveHighlight(r,n)},_scrollToEditorView(e){const t=Object(i.default)("body, html"),n=this.$(".ic-display-comment-view").position().top,r=e.closest(".ic-create-comment-view").position().top+n;(t.height()<r||t.scrollTop()>r)&&t.animate({scrollTop:r},100)},displayCreateComment(e,t,n){const r=this.isOnUnsupportedMacro();this._emptySidebar(!0),this.createCommentView=new En({formatMessage:this.formatMessage,collection:e,selection:t,type:r?"pageComment":"topLevel",isFocus:!1,stopFocus:!0,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,commentText:r?`<blockquote>${Object(i.default)("<div/>").text(t.text).html()}</blockquote> <div/>`:"",onFinished:d.a.bind((function(){this.createCommentView.keepSidebar||this.isShowing&&this.hide()}),this),serializedHighlights:n,isFrontendPeopleDirectoryEnabled:this.options.isFrontendPeopleDirectoryEnabled,isMacroBrowserCheckEnabled:this.options.isMacroBrowserCheckEnabled}),this.show(),this.createCommentView.$el.css("visibility","hidden"),this.$el.html(this.createCommentView.$el),this.createCommentView.render()},isOnUnsupportedMacro(){const e=Object(i.default)(".ic-current-selection");return A.containUnsupportedMacro(e)||A.containInternalLink(e)||A.containUserMetion(e)},displayError(e,t){t=d.a.extend({closeable:!0},t),this.clearError(),o.a.messages.warning(".ic-error",{body:e,closeable:t.closeable}),t.callback&&t.callback()},clearError(){Object(i.default)(".ic-error").empty()},show(e){this.isShowing||(this._toggleSidebar(e),this.isShowing=!0)},hideInEditMode(e){"comment"!==o.a.Meta.get("content-type")&&(this.sidebarObserver.disconnect(),this.hide(e))},hide(e,t){return e&&e.preventDefault(),!!A.confirmProcess(this.formatMessage,!0,this.isFabricEditorDirty)&&(!this.isShowing||(this._toggleSidebar(t).done(()=>{v.destroy(),m.a.trigger("ic:sidebar-hidden"),m.a.trigger("ic:fabric-editor-dirty",!1),this.isShowing=!1}),!0))},async sendUIEvent(){const e=Object(i.default)(".view-page-body").attr("data-content-id");(await this.analyticsClient).sendUIEvent({source:"viewPageScreen",actionSubject:"button",actionSubjectId:"closeInlineCommentsSidebar",objectType:"page",objectId:String(e),action:"clicked"})},async sendTrackEvent(e){const{attributes:{id:t,containerId:n},collection:i,cid:r}=e,a=A.getUnresolvedComments(i),s=a.map(e=>e.cid).indexOf(r)+1;(await this.analyticsClient).sendTrackEvent({source:"viewPageScreen",actionSubject:"comment",actionSubjectId:String(t),objectType:"page",objectId:n,action:"viewed",attributes:{commentType:"inline",pageType:o.a.Meta.get("draft-type"),commentsDeckSize:a.length,position:s}})},_toggleSidebar(e){const t=Object(i.default)(".inline-comment-marker.active:first, .ic-current-selection:first");let n;t.length>0&&(n=A.getOffsetTopRelativeInWindowCoordinate(t));const r=i.default.Deferred();let o=r.promise();return this.isShowing?e&&A.isAnimationSupported()?o=A.animateSidebar(this,!1):(v.destroy(),this.$wikiContent.css("position","static"),this._emptySidebar(),r.resolve()):("true"===this.shouldSqueeze&&v.shrinkToShowSideBar(),e&&A.isAnimationSupported()?o=A.animateSidebar(this,!0):r.resolve(),this.$wikiContent.css("position","relative")),o.done(()=>{A.scrollToCommentAfterToggleSideBar(n,t)}),o},_emptySidebar(e){this.commentView&&(this.commentView.model.unset&&this.commentView.model.unset("active"),this.commentView.destroy(),this.commentView=null),this.createCommentView&&(this.createCommentView.keepSidebar=e,this.createCommentView.destroy(),this.createCommentView=null)},setSidebarYPos(){if(!this.isShowing)return;const e=this.$el.offset().top;let t,n;if(null!=this.commentView)t=this.commentView.$el,n=this.commentView.model.highlight;else{if(null==this.createCommentView)return;t=this.createCommentView.$el,n=Object(i.default)(".ic-current-selection")}if(!n)return;const r=this.$(".ic-sidebar-heading").height();t.css({visibility:"visible",position:"absolute",top:n.offset().top-e-r+"px"}),A.recalculateContentHeight(t)},setIsFabricEditorDirty(e){this.isFabricEditorDirty=e}}),jn=m.a.View.extend({tagName:"div",className:"ic-display-comment-view",template:Ie.comment,events:{"click .ic-action-unresolve":"unresolveComment","click .ic-action-show-reply":"showReply"},initialize(e){this.formatMessage=e.formatMessage,d.a.bindAll(this,"onUnresolveComplete","destroy"),this.replyListView=new On({formatMessage:this.formatMessage,commentModel:this.model}),this.listenTo(this.replyListView,"ic:reply-rendered",(function(){this.renderNumberOfReplies()}))},render(){const e=this.template(d.a.extend(this.model.toJSON(),{showMenu:!1,isDangling:this.model.isDangling(),darkFeatures:A.getDarkFeatures(),hasReply:this.model.replies.length>0}),this.formatMessage);return this.$el.html(e),this.likesView&&this.likesView.remove(),this.likesView=new Ve({contentId:this.model.id,showLikeButton:!1}).render(),this.$(".ic-action-like").html(this.likesView.el),this.$el.append(this.replyListView.$el.hide()),this.replyListView.render(),this},unresolveComment(){m.a.trigger("ic:resolvedClearError"),this.model.resolve(!1,{wait:!0,success:this.onUnresolveComplete,error:this.onUnresolveFail})},onUnresolveComplete(){m.a.trigger("ic:unresolved"),this.$el.slideUp(this.destroy)},onUnresolveFail(e,t){401===t.status?m.a.trigger("ic:resolvedError",this.formatMessage({id:"inline.comments.resolve.permission"})):m.a.trigger("ic:resolvedError",this.formatMessage({id:"inline.comments.server.error"}))},showReply(){this.$(".ic-action-show-reply").parent().remove(),this.$(".ic-replies").slideDown()},renderNumberOfReplies(){const e=this.model.replies.length,t=this.$(".ic-action-show-reply");if(e>0){let n;n=1===e?this.formatMessage({id:"inline.comments.resolved.menu.show.reply"},{0:e}):this.formatMessage({id:"inline.comments.resolved.menu.show.replies"},{0:e}),t.text(n),t.parent().removeClass("hidden")}else t.parent().remove()},destroy(){this.replyListView.destroy(),this.remove()}}),Mn=m.a.View.extend({events:{"click #resolved-dialog-close-button":"destroy"},template:Ie.resolvedCommentDialog,initialize(e){this.formatMessage=e.formatMessage,d.a.bindAll(this,"render","destroy","_onKeyDown"),this._resolvedCommentViews=[],this.listenTo(this.collection,"change:resolveProperties",this.onResolvedChanged),this.listenTo(m.a,"ic:resolvedError",this.displayError),this.listenTo(m.a,"ic:resolvedClearError",this.clearErrors);const t=Object(i.default)(this.template(null,this.formatMessage));this.setElement(t),this.dialog=o.a.dialog2(this.$el),Object(i.default)(c.a.document).bind("keydown",this._onKeyDown),o.a.trigger("remove-bindings.keyboardshortcuts")},render(){Object(h.getAnalyticsWebClient)().then(e=>{e.sendTrackEvent({action:"opened",actionSubject:"dialog",attributes:{componentVersion:"v1"},source:"ResolvedInlineCommentsDialog"}).fire()});const e=Object(i.default)("<div>"),t=this.collection.getResolvedCount();return 0!==t?d.a.each(this.collection.getResolvedCommentsDesc(),(function(t){const n=new jn({formatMessage:this.formatMessage,model:t});this._resolvedCommentViews.push(n),e.append(n.render().$el)}),this):this.displayNoCommentMessage(),this.$(".aui-dialog2-content").append(e),this.dialog.show(),this.options.focusCommentId&&this.scrollToComment(this.options.focusCommentId),m.a.trigger("ic:resolved:view",t),o.a.trigger("ic-jim-async-supported"),this},onResolvedChanged(){0===this.collection.getResolvedCount()&&this.displayNoCommentMessage()},displayNoCommentMessage(){o.a.messages.generic(this.$(".aui-dialog2-content"),{body:this.formatMessage({id:"inline.comments.resolved.dialog.empty"}),closeable:!1})},displayError(e){this.clearErrors(),o.a.messages.warning(this.$("#ic-resolved-comment-dialog-error"),{body:e})},clearErrors(){this.$("#ic-resolved-comment-dialog-error").empty()},scrollToComment(e){const t=this.$(o.a.format("[data-comment-id={0}]",e));if(t.length)return t.addClass("focused"),this.$(".aui-dialog2-content").animate({scrollTop:t.parent().position().top},100);return(new i.default.Deferred).reject()},_onKeyDown(e){this.$el&&this.$el.is(":visible")&&e.keyCode===o.a.keyCode.ESCAPE&&this.destroy()},destroy(){o.a.trigger("add-bindings.keyboardshortcuts"),Object(i.default)(c.a.document).unbind("keydown",this._onKeyDown),this.dialog.hide(),this.dialog.remove(),d.a.each(this._resolvedCommentViews,e=>{e.destroy()}),this._resolvedCommentViews=null,this.remove()}}),Rn=m.a.Model.extend({}),xn=m.a.Collection.extend({model:Rn,url:o.a.contextPath()+"/rest/experimental/webfragment/panels?location=atl.page.content.footer.actions"});let Sn,An=null;var Dn={init(e,t){Sn=t,An=e.commentCollection;const n=new Promise(t=>{A.getDarkFeatures().LIKES_ADMIN_TOGGLE?(e.webPanelCollection||(e.webPanelCollection=new xn),e.webPanelCollection.fetch({cache:!1}).done(e=>{t(e.length>0)})):t(!0)});e.views.sidebar&&e.views.sidebar.destroy(),e.views.sidebar=new Nn({formatMessage:Sn,$wikiContent:Object(i.default)("[data-inline-comments-target=true]").first(),shouldShowInlineCommentLikes:n,shouldSqueeze:e.shouldSqueeze,isGDPRInlineCommentsEnabled:e.isGDPRInlineCommentsEnabled,isFrontendPeopleDirectoryEnabled:e.isFrontendPeopleDirectoryEnabled,isMacroBrowserCheckEnabled:e.isMacroBrowserCheckEnabled}),v.$el.append(e.views.sidebar.$el),e.views.highlight&&e.views.highlight.destroy(),e.views.highlight=new Oe({formatMessage:Sn,collection:An}),e.views.highlight.render()},loadSidebarOnClick(e,t){if(A.confirmProcess(Sn,!1,t)){m.a.trigger("ic:highlight-panel-click"),Object(i.default)(".inline-comment-marker,span[data-mark-type=confluenceInlineComment],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment]").removeClass("active");const t=A.overlappedSelection(e,An);if(t){const e=Object(i.default)(`.inline-comment-marker[data-ref="${t.get("markerRef")}"],span[data-mark-type=confluenceInlineComment][data-reference="${t.get("markerRef")}"],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment][data-id="${t.get("markerRef")}"]`);c.a.Confluence.HighlightAction.clearTextSelection(),t.highlight=e,m.a.trigger("ic:overlap",t)}else{const t=(new pe).removeHighlight().highlight(e.range);m.a.trigger("ic:create",An,e,t)}}},updateResolvedCommentCountInToolsMenu(){Object(i.default)("#view-resolved-comments>span").text(Sn({id:"inline.comments.resolved.view.menu"})+o.a.format(" ({0})",An.getResolvedCount()))},afterSyncCommentCollection(){const e=this;An.once("sync",t=>{e.displayPermalinkedComment(t)}),An.on("change:resolveProperties",()=>{e.updateResolvedCommentCountInToolsMenu()}),this.updateResolvedCommentCountInToolsMenu()},displayPermalinkedComment(e){const t=c.a.location.search;A.showFocusedComment(e,t,Mn)},createResolvedCommentListView(){new Mn({formatMessage:Sn,collection:An}).render()}};let _n,Pn;const $n=function(e){return Dn.init(e,Pn),Dn};function Ln(){return Fn.firstCaller&&(Fn.firstCaller=!1,_n&&_n.isResolved()?$n(Fn):(_n=i.default.Deferred(),_n.resolve($n(Fn)))),Fn.isSidebarLoaded=!1,_n.promise()}const Fn={firstCaller:!0,isSidebarLoaded:!1,commentCollection:null,webPanelCollection:null,shouldSqueeze:!1,views:{sidebar:null},init(e){e=e||{},Fn.firstCaller=!0,Fn.isSidebarLoaded=!1,Fn.shouldSqueeze=e.shouldSqueeze,Fn.isUnifiedProfileCardsEnabled=e.isUnifiedProfileCardsEnabled,Fn.isGDPRInlineCommentsEnabled=e.isGDPRInlineCommentsEnabled,Fn.isFrontendPeopleDirectoryEnabled=e.isFrontendPeopleDirectoryEnabled,Fn.isMacroBrowserCheckEnabled=e.isMacroBrowserCheckEnabled,Fn.isFabricEditorDirty=!1,Fn.commentCollection||(Fn.commentCollection=new B),Fn.commentCollection.reset(),v.setPageContentElByCSSSelector(e.pageContentCSSSelector),v.setPageHeaderElByCSSSelector(e.pageHeaderCSSSelector),Fn.bindDOMEvents(),Fn.fetch(),Fn.bindQuickReloadEvents(),Fn.bindAppEvents(),Fn.focusOnComment(),Fn.updateResolvedCount(),o.a.bind("ic.force-refetch",Fn.fetch)},initAsync(){Ln().done(e=>{e.afterSyncCommentCollection(),e.displayPermalinkedComment(Fn.commentCollection)})},destroy(){o.a.unbind(".ic-app"),v.destroy()},bindDOMEvents(){Object(i.default)("body").off("click.ic-app","#view-resolved-comments").on("click.ic-app","#view-resolved-comments",e=>{e.preventDefault(),Ln().done(e=>{e.createResolvedCommentListView()})})},bindAppEvents(){m.a.listenTo(m.a,"ic:resolved..ic-app",()=>{Fn.initAsync()}),m.a.listenTo(m.a,"ic:fabric-editor-dirty",e=>{Fn.isFabricEditorDirty=e})},fetch:()=>Fn.commentCollection.fetch({cache:!1}).done(()=>{Fn.commentCollection.getCommentsOnPageCount()>0&&Fn.initAsync(),Fn.commentCollection.getResolvedCount()>0&&Ln().done(e=>{e.updateResolvedCommentCountInToolsMenu()}),o.a.trigger("ic-fetch-completed",Fn.commentCollection)}),focusOnComment(){-1!==c.a.location.search.indexOf("focusedCommentId")&&Fn.initAsync()},bindQuickReloadEvents(){o.a.unbind("qr:show-new-thread.ic-app").bind("qr:show-new-thread.ic-app",(e,t)=>{Ln().done(()=>{!function(e,t){let n=Fn.commentCollection.get(t),i=!1;void 0===n&&(n=new V({id:t}),i=!0),n.fetch({success(e){e._setHighlights(e.get("markerRef")),i?Fn.commentCollection.add(e):n.replies.isFetched=!1,m.a.trigger("ic:view",n,"quickreload")}})}(0,t)})}),o.a.unbind("qr:add-new-highlight.ic-app").bind("qr:add-new-highlight",(e,t,n)=>{Ln().done(()=>{o.a.trigger("qr:add-new-highlight-text",[t,n])})})},updateResolvedCount(){Object(i.default)("#view-resolved-comments>span").text(Pn({id:"inline.comments.resolved.view.menu"})+o.a.format(" ({0})",Fn.commentCollection.getResolvedCount()))}};function Hn(){c.a.removeEventListener("create-inline-comment",Vn),Object(i.default)(".tipsy").remove()}function Vn(e){Bn(e.detail)}function Bn(e){Object($.b)({name:b.a.ADD_INLINE_COMMENT,id:_()(),attributes:{editor:P.d.FABRIC,mode:L.c.VIEW,framework:L.b.BACKBONE}},{name:b.a.ADD_INLINE_COMMENT_LOAD},{name:b.a.ADD_INLINE_COMMENT_PUBLISH}),Ln().done(t=>{Fn.isSidebarLoaded||(Fn.isSidebarLoaded=!0,t.loadSidebarOnClick(e,Fn.isFabricEditorDirty))})}var Un={init:function(e){Pn=e.formatMessage,z.start(),Hn(),Fn.init(e),c.a.addEventListener("create-inline-comment",Vn),c.a.Confluence&&c.a.Confluence.HighlightAction&&c.a.Confluence.HighlightAction.registerButtonHandler("com.atlassian.confluence.plugins.confluence-inline-comments:create-inline-comment",{onClick:Bn,shouldDisplay:c.a.Confluence.HighlightAction.WORKING_AREA.MAINCONTENT_ONLY})},destroy:function(){Hn(),Fn.destroy()},notifyEditor:function(){m.a.trigger("ic:tinymce-resource-loaded")}};const zn=Object(a.d)("skate");if(!A.isSPAPage()){const e=o.a.Meta.get("page-id"),t=o.a.Meta.get("latest-page-id");e&&e===t&&Object(i.default)(Un.init)}const qn=(e,t)=>{const n=e.getAttribute("data-page-content-css-selector"),i=e.getAttribute("data-page-header-css-selector"),r=e.getAttribute("data-content-id"),o=e.getAttribute("data-should-squeeze"),a=e.getAttribute("data-gdpr-inline-comments"),s=e.getAttribute("data-frontend-people-directory"),c=e.getAttribute("data-inline-comments-macro-browser");Un.init({formatMessage:t,pageContentCSSSelector:n,pageHeaderCSSSelector:i,contentId:r,shouldSqueeze:o,isGDPRInlineCommentsEnabled:a,isFrontendPeopleDirectoryEnabled:s,isMacroBrowserCheckEnabled:c})};t.default=(e,t=!1)=>{var n;if(n=A.getPageContentClassName(),__skate&&__skate.registry&&void 0!==__skate.registry[n]){if(t){const t=document.getElementsByClassName(A.getPageContentClassName())[0];t&&(Un.destroy(),qn(t,e))}}else zn(A.getPageContentClassName(),{type:zn.types.CLASS,attributes:{"data-content-id":{updated(e){this._init(e)}},"data-editor-resource-loaded":{updated(){Un.notifyEditor()}}},attached(e){this._init(e)},detached(){Un.destroy()},_init(t){qn(t,e)}})}},jYB6:function(e){e.exports=JSON.parse('{"a":"@atlaskit/tooltip","b":"17.1.1"}')},jqY8:function(e,t,n){"use strict";function i(){return"undefined"!=typeof window?window.location:void 0}function r(){if("undefined"==typeof window||!window.location)return;let e=window.location.origin;return e||(e=`${window.location.protocol}//${window.location.hostname}${window.location.port?":"+window.location.port:""}`),e}function o(){"undefined"!=typeof window&&window.location.reload()}function a(e){return"undefined"==typeof window||window.confirm(e)}function s(...e){"undefined"!=typeof window&&window.addEventListener.apply(window,e)}function c(...e){"undefined"!=typeof window&&window.removeEventListener.apply(window,e)}function l(){return"undefined"==typeof window?0:window.pageYOffset}function d(){return"undefined"==typeof window?0:window.innerHeight}function u(...e){if(window&&window.require)return window.require.apply(window,e)}function m(){return window}n.d(t,"f",(function(){return i})),n.d(t,"g",(function(){return r})),n.d(t,"i",(function(){return o})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return s})),n.d(t,"j",(function(){return c})),n.d(t,"h",(function(){return l})),n.d(t,"e",(function(){return d})),n.d(t,"d",(function(){return u})),n.d(t,"c",(function(){return m}))},keNr:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));const i="confluence.frontend.bm.disable-non-page-load-metrics"},lXfh:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n("D57K"),r=n("I4sB");i.__exportStar(n("O1he"),t);class o extends Error{constructor(e,t){super(`Invalid ari string: ${e}${t?". "+t:""}`),this.ariString=e,Object.setPrototypeOf(this,o.prototype)}static withConstraintViolations(e,t){return new o(e,t.map(e=>e.toString()).join("\n"))}}function a(e,t){return e===t||void 0===e}t.InvalidAriError=o;const s=r.pattern(/^[a-z][a-z.-]*$/),c=r.pattern(/^[a-z][a-z.-]*$/i),l=[r.lengthBetween(3,255),s],d=[r.lengthBetween(3,255),c],u=[r.lengthBetween(3,255)],m=/[\w-._~:@#]/.source,h=[r.pattern(new RegExp(`^${m}+(/${m}*)*(;v=${m}*)*$`))];class p{get cloudId(){return"site"===this.resourceType?this.internalCloudId?this.internalCloudId:this.resourceId:this.internalCloudId}constructor(e){const{resourceId:t,resourceOwner:n,resourceType:i,cloudId:r}=function(e){const{resourceId:t,resourceOwner:n,cloudId:i}=e;return!t&&i?{resourceOwner:n,resourceType:"site",resourceId:i}:e}(e);this.resourceOwner=n,this.internalCloudId=r,this.resourceType=i,this.resourceId=t,this.validate()}static parse(e){if(!e)throw new o(e);const t=e.match(/^ari:cloud:([^:/]+):([^:/]*):([^:/]*)\/(.*)$/);if(!t||5!==t.length)throw new o(e);const n=t.map(e=>e&&e.length>0?e:void 0),i=n[1];if(!i)throw new o(e);return new p({resourceOwner:i,cloudId:n[2],resourceType:n[3],resourceId:n[4]})}static parseEncoded(e){return f(decodeURIComponent(e))}toString(){if(!this.ariString){const e="site"===this.resourceType&&this.internalCloudId?this.internalCloudId:this.resourceId||"",t=this.resourceType||"",n="site"===this.resourceType?"":this.internalCloudId||"";this.ariString=`ari:cloud:${this.resourceOwner}:${n}:${t}/${e}`}return this.ariString}toJSON(){return this.toString()}equals(e){return e instanceof p&&this.resourceOwner===e.resourceOwner&&this.cloudId===e.cloudId&&this.resourceType===e.resourceType&&this.resourceId===e.resourceId}contains(e){return this.matches(new p(e))}matches(e){return a(this.resourceOwner,e.resourceOwner)&&a(this.cloudId,e.cloudId)&&("site"===this.resourceType&&!!e.resourceType||a(this.resourceType,e.resourceType))&&("site"===this.resourceType&&!!e.resourceType||a(this.resourceId,e.resourceId))}validateSiteWide(){const{resourceType:e,cloudId:t}=this;if("site"===e&&!t)return new r.GeneralValidationError("site wide ARIs must have a cloudId")}validate(){const e=[r.validateField(this,"resourceOwner",l),r.validateField(this,"resourceType",d),r.validateField(this,"resourceId",h),r.validateField(this,"cloudId",u),this.validateSiteWide()].filter(e=>e);if(e.length>0)throw o.withConstraintViolations(this.toString(),e);if(void 0!==this.resourceId&&void 0===this.resourceType)throw new o(this.toString(),"The resource type must be specified if the resource id is defined.")}urlEncode(){return encodeURIComponent(this.toString())}urlDecode(){return decodeURIComponent(this.toString())}}function f(e){return p.parse(e)}t.ResourceIdentifier=p,t.parse=f,t.parseEncoded=function(e){return p.parseEncoded(e)}},liuE:function(e,t,n){"use strict";var i=n("ERkP"),r=n.n(i),o=n("Czhu"),a=n("3IV/"),s=n("8pvK");const c={default:{light:a.N40,dark:a.N40},inprogress:{light:a.B50,dark:a.B50},moved:{light:a.Y75,dark:a.Y75},new:{light:a.P50,dark:a.P50},removed:{light:a.R50,dark:a.R50},success:{light:a.G50,dark:a.G50}},l={default:{light:a.N500,dark:a.N500},inprogress:{light:a.B500,dark:a.B500},moved:{light:a.N800,dark:a.N800},new:{light:a.P500,dark:a.P500},removed:{light:a.R500,dark:a.R500},success:{light:a.G500,dark:a.G500}},d={default:{light:a.N500,dark:a.N500},inprogress:{light:a.B400,dark:a.B400},moved:{light:a.Y500,dark:a.Y500},new:{light:a.P400,dark:a.P400},removed:{light:a.R400,dark:a.R400},success:{light:a.G400,dark:a.G400}},u={default:{light:a.N0,dark:a.N0},inprogress:{light:a.N0,dark:a.N0},moved:{light:a.N800,dark:a.N800},new:{light:a.N0,dark:a.N0},removed:{light:a.N0,dark:a.N0},success:{light:a.N0,dark:a.N0}},m=Object(s.a)(({appearance:e,isBold:t,maxWidth:n})=>Object(o.a)(Object(o.a)({},"object"==typeof e?Object(o.a)({backgroundColor:(t?d:c).default.light,textColor:(t?u:l).default.light},e):{backgroundColor:(t?d[e]:c[e]).light,textColor:(t?u[e]:l[e]).light}),{},{maxWidth:n}));var h=n("l1C2"),p=n("BMbf");const f=Object(p.c)()+"px";var g=({backgroundColor:e,textColor:t,children:n,testId:i})=>Object(h.f)("span",{css:{backgroundColor:e,borderRadius:f,boxSizing:"border-box",color:t,display:"inline-block",fontSize:"11px",fontWeight:700,lineHeight:1,maxWidth:"100%",padding:"2px 0 3px 0",textTransform:"uppercase",verticalAlign:"baseline"},"data-testid":i},n);const b=Object(p.h)()/2+"px";var v=({maxWidth:e,children:t})=>Object(h.f)("span",{css:{display:"inline-block",verticalAlign:"top",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",boxSizing:"border-box",padding:"0 "+b,maxWidth:"number"==typeof e?e+"px":e,width:"100%"}},t);n.d(t,"a",(function(){return y}));class y extends i.PureComponent{render(){const{theme:e,children:t,testId:n}=this.props;return r.a.createElement(m.Provider,{value:e},r.a.createElement(m.Consumer,Object.assign({},this.props),e=>r.a.createElement(g,Object.assign({testId:n},e),r.a.createElement(v,Object.assign({},e),t))))}}y.defaultProps={isBold:!1,appearance:"default",maxWidth:200}},ltac:function(e,t,n){"use strict";function i(e){let t=e.offsetTop;for(;e.offsetParent;)t+=(e=e.offsetParent).offsetTop;return t}function r(e,t){if(!e)return!1;t=t||document.scrollingElement||document.body.parentNode;const n=e.offsetHeight,r=i(e),o=i(t)+t.scrollTop,a=t.offsetHeight;return r>=o&&r+n<=o+a}function o(e){if(!e||e===document)return null;const t=window.getComputedStyle(e);return e.scrollHeight>e.clientHeight&&"hidden"!==e.style.overflow&&"visible"!==t.overflow?e:o(e.parentNode)}function a(e,t){t=t||o(e),e&&t&&!r(e,t)&&(t.scrollTop=i(e)-i(t)-t.clientHeight/2)}function s(e){return e.getBoundingClientRect()}function c(e,t){const n=t?t.documentElement:window.document.documentElement;if(!e||!n)return;const i=e.getBoundingClientRect(),{top:r,bottom:o}=i,a=n.offsetHeight;return 0<=r&&r<a||0<=o&&o<=a||r<=0&&0<=o&&o>=a}function l(e,t){const n=t?t.documentElement:window.document.documentElement;if(!e||!n)return;const i=e.getBoundingClientRect(),{top:r}=i,o=n.offsetHeight;return 0<=r&&r<o}n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"g",(function(){return a})),n.d(t,"a",(function(){return s})),n.d(t,"e",(function(){return c})),n.d(t,"f",(function(){return l}))},mGwS:function(e,t,n){"use strict";var i=n("xbks");t.a=i.a},o0lc:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("ERkP"),r=n.n(i),o=n("lZoD"),a=n("WWAs"),s=n("03Pf");const c=({children:e})=>{const t=Object(i.useRef)(0),n=Object(i.useCallback)(e=>{Object(s.b)(e,-t.current)},[t]);return r.a.createElement(o.c,{to:[a.a]},i=>(t.current=i.getTotalHeight(),e({scrollToElement:n})))};c.displayName="DocumentScroller"},pwfR:function(e,t,n){"use strict";var i=n("ERkP"),r=n.n(i),o=n("bhMQ");n.d(t,"b",(function(){return d}));const a={appear:!0,isExiting:!1},s=Object(i.createContext)(a),c=(e,t=a)=>r.a.createElement(s.Provider,{key:e.key+"-provider",value:t},e),l=e=>e.reduce((e,t)=>(e[t.key]=t,e),{}),d=()=>Object(i.useContext)(s);t.a=({appear:e=!1,children:t,exitThenEnter:n})=>{const r=(e=>{const t=[];return i.Children.toArray(e).forEach(e=>{"boolean"!=typeof e&&t.push(e)}),t})(t),a=l(r),s=Object(i.useRef)([]),d=Object(i.useRef)([]),u=(()=>{const[,e]=Object(i.useState)({});return Object(i.useCallback)(()=>e({}),[])})(),m=Object(i.useRef)({}),h=Object(i.useRef)(e),p=Object(i.useMemo)(()=>({appear:h.current,isExiting:!1}),[h.current]);return Object(o.a)()?r:(h.current||(h.current=!0),s.current.length&&((e,t)=>{for(let n=0;n<t.length;n++){if(!e[t[n].key])return!0}return!1})(a,s.current)?((0===d.current.length||((e,t)=>{let n=!1;return t.forEach(t=>{e.current[t.key]&&(n=!0,delete e.current[t.key])}),n})(m,r))&&(d.current=s.current),s.current=r,(n?d.current:((e,t)=>{const n=t.concat([]),i=l(t);for(let r=0;r<e.length;r++){const t=e[r];!i[t.key]&&n.splice(r+1,0,t)}return n})(r,d.current)).map(e=>{const t=a[e.key];return t?c(t,p):(m.current[e.key]=!0,c(e,{isExiting:!0,appear:!0,onFinish:()=>{delete m.current[e.key],0===Object.keys(m.current).length&&(s.current=[],d.current=[],u())}}))})):(s.current=r,r.map(e=>c(e,p))))}},r7Rc:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("H5qd");const r=n.n(i).a`query CommentButtonRefetchQuery($pageId:ID!){comments(pageId:$pageId type:UNRESOLVED depth:ALL){count nodes{id location{type ...on InlineComment{inlineMarkerRef}}}}}`},uIWc:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var i=n("Czhu"),r=n("Iy7w"),o=n("ERkP"),a=n.n(o),s=n("L21V"),c=n("xsIe"),l=n("dIe6"),d=n("F4Ur"),u=n("PhMJ");const m=Object(r.a)("div",{target:"e1askrf30"})({name:"5eh4fd",styles:"margin:12px 12px 0;"}),h=({error:e,action:t})=>{const n=Object(u.k)(e),r="delete"===t&&400===n.statusCode;Object(o.useEffect)(()=>{r&&Object(d.a)(e)},[e,r]);const h=a.a.createElement(m,null,a.a.createElement(c.a,{appearance:"warning",testId:"editor-inline-message"},r?a.a.createElement(s.b,Object(i.a)({},Object(u.j)(n.message))):a.a.createElement(s.b,{id:"inline-comments.editor.error.message",defaultMessage:"Something went wrong when trying to {action} your comment. Please close the editor and try again.",description:"A message displayed to the user informing them something happened when saving, resolving or unresolving their comment",values:{action:t}})));return r?h:a.a.createElement(l.a,{error:e},h)}},uvkf:function(e,t,n){"use strict";var i=n("ERkP"),r=n("l1C2"),o=n("BMbf");const a=Object(r.e)("z-index:",o.i.tooltip(),";pointer-events:none;"),s=Object(i.forwardRef)((function({style:e,className:t,children:n,placement:i,testId:o},s){return Object(r.f)("div",{role:"tooltip",ref:s,style:e,className:t,css:a,"data-placement":i,"data-testid":o},n)}));s.displayName="TooltipPrimitive",t.a=s},vdGo:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("ERkP"),r=n("6z9Z"),o=n("9LlU");function a({name:e,error:t}){const n=Object(i.useContext)(o.a),a=Object(i.useContext)(r.a);return Object(i.useEffect)(()=>a.fail({name:e||n,error:t}),[a,e,n,t]),null}},vzxV:function(e,t,n){"use strict";n.r(t);var i=n("ERkP"),r=n.n(i),o=n("1U1M"),a=n("IC1n"),s=n.n(a),c=n("lZoD"),l=n("6z9Z"),d=n("3VMZ"),u=n("J7sl"),m=n("rc7/"),h=n("dIe6"),p=n("FdGg"),f=n("X2PC"),g=n("QqfF"),b=n("zCQI"),v=n("ZsZh"),y=n("JGEE"),E=n("rhcL"),C=n("nLwH"),I=n("v5SA"),O=n("2DyF"),w=n("a0gl"),T=n("LEcB"),k=n("F4Ur"),N=n("+CY+"),j=n("bWlm"),M=n("1N1n"),R=n("daKX"),x=n("PoOp"),S=n("0nUU"),A=n("UEVo"),D=n("1GbL"),_=n("DHFp"),P=n("mAAb"),$=n("PhMJ");const L=Object(i.memo)(({markerRefs:e,onHighlightClick:t,dialogs:n})=>{const{hasContentChanged:r,resetContentChanged:o}=Object(i.useContext)(g.a),a=Object(i.useCallback)(e=>{let{target:i}=e,a=!1;for(;i&&((s=i)&&null!==Object(E.f)(s))&&(a=i.classList.contains($.c),!a);)i=i.parentElement;var s;if(!i||!a)return;e.preventDefault();const c=e=>{if(o(),e.classList.contains($.a))Object($.e)(),t("");else{Object($.e)();const n=Object(E.f)(e);e.classList.add($.a),Object($.n)(n),t(n)}};r?n.showDialog(C.a,{onConfirm:()=>c(i)}):c(i)},[n,t,r,o]);return Object(i.useEffect)(()=>{const t=e.reduce((e,t)=>(e[t]=!0,e),{});document.querySelectorAll(Object($.h)()).forEach(e=>{const n=Object(E.f)(e);if(n){t[n]?e.classList.add($.c):e.classList.remove($.c)}})},[e]),Object(i.useEffect)(()=>{const e=document.querySelector("#content");if(e)return e.addEventListener("click",a),()=>{e.removeEventListener("click",a)}},[e,a]),null});var F=n("Iy7w"),H=n("7nmT"),V=n("0dje"),B=n.n(V),U=n("3IV/");const z=Object(F.a)("div",{target:"efsks5y0"})("position:absolute;top:-50px;left:-50px;width:200px;background:white;border-radius:4px;box-shadow:0 1px 2px rgba(0,0,0,0.2);box-sizing:content-box;padding:8px 12px;span:first-of-type{text-decoration:none;color:",U.N200,";padding-right:5px;line-height:inherit;svg{padding-bottom:2px;}}"),q=Object(i.memo)(()=>{const e=Object(i.useRef)(null),t=Object(i.useRef)(null),n=Object(i.useRef)(null),[o,a]=Object(i.useState)(null);Object(i.useEffect)(()=>{e.current=document.querySelector("#content")},[]);const s=Object(i.useCallback)(e=>{const{target:i}=e;i.removeEventListener("mouseleave",s),n.current=setTimeout(()=>{t.current=null,a(null)},2e3)},[n,t]),c=Object(i.useCallback)(e=>{const{target:i}=e;let r=!1;for(let t=0;t<i.children.length;++t)if(i.children[t].classList.contains($.c)){r=!0;break}if(r){const e=(e=>e.length>19?e.substr(0,20)+"...":e)(i.getAttribute("href"));if(e===o)return;n.current&&clearTimeout(n.current),i.setAttribute("style","position: relative"),t.current=i,i.addEventListener("mouseleave",s),a(e)}},[n,t,o,s]);return Object(i.useEffect)(()=>{var t;if(e.current)return null===(t=e.current)||void 0===t||t.querySelectorAll("a[href]").forEach(e=>e.addEventListener("mouseenter",c)),()=>{var t;null===(t=e.current)||void 0===t||t.querySelectorAll("a[href]").forEach(e=>e.removeEventListener("mouseenter",c))}},[e,c]),o&&t.current?Object(H.createPortal)(r.a.createElement(z,null,r.a.createElement(B.a,{size:"medium",label:"inline-comment-hyperlink-icon",primaryColor:U.N200}),o),t.current):null});var G=n("L21V"),W=n("gHio"),Y=n.n(W),K=n("a8dO"),Q=n("MV18"),J=n("wpph"),X=n("KYhD"),Z=n("Czhu"),ee=n("HMAF"),te=n.n(ee),ne=n("PLaw"),ie=n.n(ne);const re=Object(G.f)({nextCommentLabel:{id:"inline-comments.next-comment-label",description:"Label displayed for the Next comment",defaultMessage:"Next Comment"},previousCommentLabel:{id:"inline-comments.previous-comment-label",description:"Label displayed for the Previous comment",defaultMessage:"Previous Comment"},nextCommentToolTip:{id:"inline-comments.next-comment-tooltip",description:"ToolTip displayed for the Next comment",defaultMessage:"Next comment (N)"},previousCommentToolTip:{id:"inline-comments.previous-comment-tooltip",description:"ToolTip displayed for the Previous comment",defaultMessage:"Previous comment (P)"}}),oe=({currentCommentIndex:e,commentsCount:t,navigateToComment:n,comment:i})=>r.a.createElement(J.f,null,r.a.createElement(K.a,{content:r.a.createElement(G.b,Object(Z.a)({},re.previousCommentToolTip)),hideTooltipOnClick:!0,position:"top"},r.a.createElement(J.d,{"data-cy":"inline-nav-previous",iconBefore:r.a.createElement(G.b,Object(Z.a)({},re.previousCommentLabel),e=>r.a.createElement(te.a,{label:e,primaryColor:U.N90,size:"medium"})),onClick:()=>{n("previous",i)}})),r.a.createElement(K.a,{content:r.a.createElement(G.b,Object(Z.a)({},re.nextCommentToolTip)),hideTooltipOnClick:!0,position:"top"},r.a.createElement(J.d,{"data-cy":"inline-nav-next",iconBefore:r.a.createElement(G.b,Object(Z.a)({},re.nextCommentLabel),e=>r.a.createElement(ie.a,{label:e,primaryColor:U.N90,size:"medium"})),onClick:()=>{n("next",i)}})),r.a.createElement("span",null,`${e+1} of ${t}`));var ae=n("VZRV");const se=Object(F.a)("div",{target:"e10flfs70"})("padding:5px 18px 5px 16px;border-bottom:1px solid ",U.N40,";font-size:12px;"),ce=({resolvedUser:e,resolvedTime:t})=>e&&t?r.a.createElement(se,null,r.a.createElement(G.b,{id:"inline-comments.reopened.message",defaultMessage:"Reopened by {person}",description:"A message telling the user the comment was reopened and who did it",values:{person:e}})," ",r.a.createElement(ae.b,{date:t})):null,le=Object(F.a)("div",{target:"e6x96340"})("border-bottom:1px solid ",U.N40,";text-align:center;height:29px;"),de=Object(F.a)("div",{target:"e6x96341"})("height:9px;border-bottom:1px solid ",U.N40,";"),ue=Object(F.a)("div",{target:"e6x96342"})("position:relative;> span{top:-16px;cursor:pointer;padding:0 5px;background-color:",U.N0,";position:relative;}"),me=({numCollapsedReplies:e,onClick:t})=>r.a.createElement(le,null,r.a.createElement(de,null),r.a.createElement(de,null),r.a.createElement(ue,{"data-testid":"collapsed-inline-replies",onClick:t},r.a.createElement(G.b,{id:"inline-comments.collapsed.replies.more",defaultMessage:"{numCollapsedReplies} more replies",description:"text telling the user how many replies are collapsed",values:{numCollapsedReplies:e}})));var he=n("uIWc"),pe=n("Z+sp"),fe=n("3D57"),ge=n("r7Rc"),be=n("H5qd");const ve=n.n(be).a`mutation DeleteInlineCommentMutation($commentIdToDelete:ID!){deleteComment(commentIdToDelete:$commentIdToDelete)}`;var ye=n("3ZcK"),Ee=n("DL3M"),Ce=n.n(Ee),Ie=n("z9P0"),Oe=n("8Kf2"),we=n("Ga4t"),Te=n("h5Yo");const ke=({pageId:e,pageType:t,spaceId:n,resetComment:a,userId:s,avatarUrl:c,commentId:u,content:m,displayName:h,parentId:p,version:f,isReply:b,isFabricPage:v})=>{const y=Object(i.useRef)(null),{onChange:C}=Object(i.useContext)(g.a),[I]=Object(o.c)(Te.a),{createAnalyticsEvent:O}=Object(Ie.a)(),w=Object(i.useContext)(l.a);Object(i.useEffect)(()=>{y&&y.current&&Object(E.j)(y.current,v)},[y,v]);const T=Object(i.useCallback)(()=>{a()},[a]),k=m&&m.length?JSON.parse(m):null;return r.a.createElement(i.Fragment,null,r.a.createElement(J.a,{ref:y,"data-testid":"inline-comment-edit-container"},r.a.createElement(we.a,{mode:"edit",userId:s,displayName:h,avatarUrl:c}),r.a.createElement(Oe.a,{pageId:e,pageType:t,spaceId:n,appearance:"chromeless",commentMode:"edit",content:k,onSaveComment:(i,r)=>{w.start({name:d.a.EDIT_INLINE_COMMENT_PUBLISH});const o={variables:{input:{commentId:u,version:f+1,commentBody:{value:JSON.stringify(i),representationFormat:"ATLAS_DOC_FORMAT"}}},update:t=>{var n;const r=t.readQuery({query:_.b,variables:{pageId:e}}),o=(null===(n=r.comments)||void 0===n?void 0:n.nodes)||[];let a;if(b){const e=o.find(e=>(null==e?void 0:e.id)===p);a=null==e?void 0:e.replies.find(e=>(null==e?void 0:e.id)===u)}else a=o.find(e=>(null==e?void 0:e.id)===u);a&&(Ce()(a,"body.value",JSON.stringify(i)),Ce()(a,"version.number",f+1),t.writeQuery({query:_.b,variables:{pageId:e},data:r}))}};return I(Object(Z.a)({},o)).then(({data:i})=>{r();const{updateComment:o}=i;(({id:i})=>{O({type:"sendTrackEvent",data:{containerType:"space",containerId:n,source:"viewPageScreen",objectType:"page",objectId:e,action:"updated",actionSubject:"comment",actionSubjectId:i,attributes:{commentType:"inline",pageType:t,parentCommentId:p,framework:"REACT"}}}).fire()})(o),a(),w.succeed({name:d.a.EDIT_INLINE_COMMENT_PUBLISH})}).catch(e=>(e=>{const{message:t}=Object($.k)(e);return w.stopOnError({error:e,name:d.a.EDIT_INLINE_COMMENT_PUBLISH}),Promise.reject({error:Object($.j)(t)})})(e))},onCancelComment:T,showCancelButton:!0,useNewWarningModal:!0,onContentChange:()=>{C()},onEditorReady:()=>{w.succeed({name:d.a.EDIT_INLINE_COMMENT_LOAD})},isViewMode:!0,shouldWarnOnInternalNavigation:!0,hideWatchCheckbox:!0})))},Ne=Object(R.a)("inline-comment"),je=({pageId:e,pageType:t,spaceId:n,shouldShowFocusedComment:a,shouldOpenCommentEditor:s,shouldShowReplyEditor:c,userId:u,onDeleteSuccess:m,comment:h,parentId:p,isReply:f,isFabricPage:b,onNewCommentSuccess:v,onResolve:E,lastFetchTime:C})=>{const[I,O]=Object(i.useState)(h?"view":"create"),[w,T]=Object(i.useState)(null),[k,N]=Object(i.useState)(!1),{resetContentChanged:j}=Object(i.useContext)(g.a),M=Object(i.useContext)(l.a);Object(i.useEffect)(()=>{!f&&h&&M.succeed({name:d.a.VIEW_INLINE_COMMENT})},[f,h,M]);const{focusedCommentId:R,editCommentId:x}=Object(y.a)(),[S]=Object(o.c)(ve,{refetchQueries:[{query:ge.a,variables:{pageId:e}}]}),[A]=Object(o.c)(fe.a,{refetchQueries:[{query:ge.a,variables:{pageId:e}}]}),D=(t,n)=>i=>{try{var r;const n=(null===(r=i.readQuery({query:_.b,variables:{pageId:e}}).comments)||void 0===r?void 0:r.nodes)||[],o=n.findIndex(e=>(null==e?void 0:e.id)===t);if(-1!==o){const t=[...n];t.splice(o,1),i.writeQuery({query:_.b,variables:{pageId:e},data:{comments:{nodes:t,__typename:"PaginatedCommentList"}}})}}catch(o){Ne.error`An Error occured when updating cache to ${n} comment - ${o}`}};Object(i.useEffect)(()=>{h&&(O("view"),T(null))},[h]),Object(i.useEffect)(()=>{if(s&&h){const{id:e,permissions:{isEditable:t}}=h;x===e&&t&&O("edit")}},[s,x,h]);const P=()=>{O("edit")},L=()=>{j(),O("view")};if(h){const{id:o,body:{value:s},links:{webui:c},parentId:l,permissions:p,version:{number:g,when:v}}=h;let y,C,O,j=!0;var F,H,V;if(u)y=null===(F=h.author)||void 0===F?void 0:F.accountId,C=null===(H=h.author)||void 0===H?void 0:H.profilePicture.path,O=null===(V=h.author)||void 0===V?void 0:V.displayName,j=!1;const{replies:x,location:{inlineMarkerRef:_}}=h,B=f&&R===o;return"view"===I?r.a.createElement(i.Fragment,null,w&&r.a.createElement(he.a,{error:w.error,action:w.action}),r.a.createElement(pe.a,{pageId:e,pageType:t,avatarUrl:C,commentId:o,content:s,date:v,displayName:O,permissions:p,dateUrl:c,userId:y,deleteComment:()=>((e,t)=>{N(!0);const n={variables:{commentIdToDelete:e},update:D(e,"delete")};S(n).then(({data:{deleteComment:e}})=>{if(!e){const e=new Error("Delete failed");throw M.stopOnError({name:d.a.DELETE_INLINE_COMMENT,error:e}),e}f||Object($.l)(t),m&&m(),M.succeed({name:d.a.DELETE_INLINE_COMMENT})}).catch(e=>{N(!1),T({error:e,action:"delete"}),M.stopOnError({name:d.a.DELETE_INLINE_COMMENT,error:e})})})(o,_),editComment:P,isReply:f,numReplies:x&&x.length,isRemoving:k,resolveComment:()=>(e=>{const t={variables:{commentId:e,resolved:!0}};A(Object(Z.a)(Object(Z.a)({},t),{},{update:D(e,"resolve")})).then(()=>{E&&E(e),M.succeed({name:d.a.RESOLVE_INLINE_COMMENT})}).catch(e=>{M.stopOnError({name:d.a.RESOLVE_INLINE_COMMENT,error:e}),T({error:e,action:"resolve"})})})(o),isFocused:B,shouldScrollIntoView:a,isFabricPage:b,isCurrentUserAnonymous:j,mode:"default"})):r.a.createElement(ke,{pageId:e,pageType:t,spaceId:n,resetComment:L,avatarUrl:C,commentId:o,content:s,displayName:O,version:g,userId:y,parentId:l,isReply:f,isFabricPage:b})}return r.a.createElement(ye.a,{pageId:e,pageType:t,spaceId:n,isReply:f,isFabricPage:b,userId:u,parentId:p,onNewCommentSuccess:v,shouldShowReplyEditor:c,lastFetchTime:C})},Me=Object(F.a)("div",{target:"e1628rut0"})("position:relative;display:flex;padding:0 12px 0;justify-content:",({shouldShowNavigation:e})=>e?"space-between":"flex-end",";",({shouldShowNavigation:e})=>e&&"height: 25px; padding-top: 10px");Me.displayName="SidebarHeader";const Re=Object(F.a)(J.d,{target:"e1628rut1"})("height:24px;width:24px;",({isCreate:e})=>e?"position: absolute; top: 12px; right: 12px;":"margin-top: 2px;"),xe=({pageId:e,pageType:t,spaceId:n,onClose:o,onDeleteSuccess:a,onNewCommentSuccess:s,canReplyToComment:c,shouldShowFocusedComment:l,shouldOpenCommentEditor:u,shouldShowReplyEditor:m,userId:h,comment:p,newCommentHighlight:f,isFabricPage:b,refetchComments:v,navigateToComment:y,currentCommentIndex:I,commentsCount:O,dialogs:w,floatingBanners:T,lastFetchTime:k})=>{var j,M,R,x;const[S,A]=Object(i.useState)(300),[D,_]=Object(i.useState)(!1),[P,L]=Object(i.useState)(!l&&!u),[F,H]=Object(i.useState)(""),{hasContentChanged:V}=Object(i.useContext)(g.a);Object(i.useEffect)(()=>{if(!p&&F)return void _(!0);if(!p&&!f)return void _(!1);let e=0;if(p){const{inlineMarkerRef:t}=p.location,n=Object(E.e)(t);e=Object(E.c)(n)}else if(f){const t=window.getSelection();t&&"Range"==t.type&&(Object($.m)(),Object($.g)());const n=document.querySelector("."+$.b);e=Object(E.c)(n)}if(b){const t=document.querySelector("#content .ak-renderer-wrapper");t&&(e+=t.offsetTop)}else{const t=document.querySelector("#content-body .page-metadata-modification-info");t&&(e-=t.offsetTop-t.offsetHeight)}H(""),A(e),_(!0)},[p,f,b,F,T.state.floatingBanners]),Object(i.useEffect)(()=>{L(!l&&!u)},[p,f,l,u]);const B=Object(i.useCallback)(()=>{const e=()=>{_(!1),L(!0),H(""),o&&o()};V?w.showDialog(C.a,{onConfirm:e}):e()},[o,V,w]),z=Object(i.useCallback)(()=>{if(!p)return null;const o=p.replies.length>0,d=P&&p.replies.length>4,f=d?p.replies.slice(-1):p.replies;return r.a.createElement(i.Fragment,null,o&&r.a.createElement(J.h,{"data-testid":"inline-comment-reply-container"},d&&r.a.createElement(me,{numCollapsedReplies:p.replies.length-1,onClick:()=>L(!1)}),f.map(i=>r.a.createElement(je,{key:i.id,pageId:e,pageType:t,spaceId:n,shouldShowFocusedComment:l,shouldOpenCommentEditor:u,userId:h,comment:i,parentId:p.id,onDeleteSuccess:a,isReply:!0}))),c&&r.a.createElement(J.g,{"data-testid":"inline-comment-new-reply-container"},r.a.createElement(je,{pageId:e,pageType:t,spaceId:n,shouldShowFocusedComment:l,shouldOpenCommentEditor:u,shouldShowReplyEditor:m,userId:h,parentId:p.id,isReply:!0,onNewCommentSuccess:s,onDeleteSuccess:a})))},[p,c,e,t,n,l,u,m,h,P,s,a]),q=null==p||null===(j=p.location)||void 0===j||null===(M=j.inlineResolveProperties)||void 0===M?void 0:M.resolvedUser,W=null==p||null===(R=p.location)||void 0===R||null===(x=R.inlineResolveProperties)||void 0===x?void 0:x.resolvedTime;return D?r.a.createElement(J.k,{id:"inline-comment-sidebar",offset:S,isViewMode:!0},r.a.createElement(Me,{shouldShowNavigation:Boolean(p),"data-testid":"inline-comment-sidebar-header"},p&&r.a.createElement(oe,{navigateToComment:y,currentCommentIndex:I,commentsCount:O,comment:p}),r.a.createElement(K.a,{content:r.a.createElement(G.b,{id:"inline-comments.close.icon.tooltip",defaultMessage:"Close sidebar (])",description:"A tooltip message informing the user what the icon does on hover and its hotkey"}),hideTooltipOnClick:!0,position:"top"},r.a.createElement(Re,{testId:"close-comment-sidebar-button",iconBefore:r.a.createElement(G.b,{id:"inline-comments.close.icon.ariaLabel",description:"aria-label for Close comment button",defaultMessage:"Close comment sidebar"},e=>r.a.createElement(Y.a,{label:e,primaryColor:U.N90,size:"small"})),onClick:B,isCreate:!p}))),F?r.a.createElement(X.a,{commentId:F,reopenComment:()=>{H(""),v()},pageId:e}):r.a.createElement(i.Fragment,null,r.a.createElement(je,{pageId:e,pageType:t,spaceId:n,shouldShowFocusedComment:l,shouldOpenCommentEditor:u,userId:h,comment:p,isFabricPage:b,onNewCommentSuccess:s,onResolve:e=>{H(e)},onDeleteSuccess:a,lastFetchTime:k,isReply:!1}),r.a.createElement(ce,{resolvedUser:q,resolvedTime:W}),z(),r.a.createElement(Q.a,{name:d.a.VIEW_PAGE_DISCOVER_INLINE_COMMENTS_FEATURE,attributes:{pageHasInlineComments:!0}})),r.a.createElement(N.a,{accelerator:["]"],listener:B})):null};n.d(t,"InlineComments",(function(){return Ae}));const Se=Object(R.a)("inline-comments-react"),Ae=({pageId:e,isFabricPage:t})=>{var n,a;const[R,F]=Object(i.useState)(""),[H,V]=Object(i.useState)({}),[B,U]=Object(i.useState)([]),[z,G]=Object(i.useState)({}),[W,Y]=Object(i.useState)(!1),[K,Q]=Object(i.useState)(!1),[J,X]=Object(i.useState)(!1),[Z,ee]=Object(i.useState)(null),[te,ne]=Object(i.useState)(0),ie=Object(i.useRef)(!0),{userId:re}=Object(w.a)(),{hasContentChanged:oe,resetContentChanged:ae}=Object(i.useContext)(g.a),se=Object(i.useContext)(l.a),{newCommentHighlight:ce,clearCreateHighlight:le}=Object(i.useContext)(b.a),{isViewAllInlineCommentsVisible:de,viewAllInlineComments:ue,markCommentAsActive:me,activateQueryParamComment:he,clearQueryParamCommentId:pe}=Object(i.useContext)(v.a),{cohort:fe}=Object(T.a)(P.d,["single-inline-comment","not-enrolled","view-all-inline-comments"],"not-enrolled",!1),{focusedCommentId:ge,editCommentId:be,replyToCommentId:ve}=Object(y.a)(),ye=re?_.b:_.a,{data:Ee,loading:Ce,error:Ie,refetch:Oe}=Object(o.d)(ye,{variables:{pageId:e},fetchPolicy:window.__SSR_RENDERED__&&ie.current?"cache-first":"cache-and-network"});Object(j.a)({name:"commentsInline",types:[M.e.content,M.e.comment],reload:Oe,priority:M.d.background});const{data:we,loading:Te,error:ke}=Object(o.d)(D.a,{variables:{pageId:e}}),Ne=()=>{F(""),Object($.e)(),Object($.m)(),le(),ae(),Re([d.a.ADD_INLINE_COMMENT,d.a.EDIT_INLINE_COMMENT,d.a.REPLY_TO_INLINE_COMMENT],"sidebar closed")},je=t=>{t&&(F(t),le()),ae(),Oe({pageId:e})},Me=Object(i.useCallback)(e=>{const t=z[e];return!!t&&("view-all-inline-comments"===fe?(de||ue(!0),me(t),he(e)):F(t),Object($.n)(t),!0)},[z,fe,de,me,ue,he]),Re=Object(i.useCallback)((e,t)=>{e.forEach(e=>se.abort({name:e,reason:t}))},[se]),Ae=Object(i.useCallback)(e=>{try{e.target.closest(".inline-highlight")||e.target.closest(".inline-comment-container")||e.target.closest(".inline-comment-snackbar")||(me(""),Object($.e)(),pe())}catch(Ie){Se.error`An Error occured when resetting active comment for view all Inline comments`}},[me,pe]);Object(i.useEffect)(()=>{ne(Date.now()),ie.current=!1},[]),Object(i.useEffect)(()=>{const e=document.getElementById("content-body");return"view-all-inline-comments"===fe&&(null==e||e.addEventListener("click",Ae)),()=>{"view-all-inline-comments"===fe&&(null==e||e.removeEventListener("click",Ae))}},[Ae,fe]),Object(i.useEffect)(()=>{var e;if(!Ee)return;const t=(null===(e=Ee.comments)||void 0===e?void 0:e.nodes)||[],n=t.reduce((e,t)=>{if(!t)return e;const{inlineMarkerRef:n}=t.location;return n?(e[n]=t,e):e},{}),i=t.reduce((e,t)=>{if(!t)return e;const{id:n}=t,{inlineMarkerRef:i}=t.location;return i?(e[n]=i,t.replies.forEach(t=>{if(t){const{id:n}=t;e[n]=i}}),e):e},{});V(n);const r=Object($.i)(Object.keys(n));U(r),G(i)},[Ee,t]),Object(i.useEffect)(()=>{"view-all-inline-comments"!==fe&&ce&&(Object($.e)(),Y(!1),Q(!1),X(!1),F(""),pe(),Re([d.a.EDIT_INLINE_COMMENT,d.a.REPLY_TO_INLINE_COMMENT],"new comment highlighted"),Object(u.b)({name:d.a.ADD_INLINE_COMMENT,id:s()(),attributes:{mode:P.c.VIEW,framework:P.b.REACT}},{name:d.a.ADD_INLINE_COMMENT_LOAD},{name:d.a.ADD_INLINE_COMMENT_PUBLISH}))},[ce,se,Re,fe,pe]),Object(i.useEffect)(()=>{ge&&Z!==ge&&Me(ge)&&(ee(ge),Y(!0))},[Z,ge,Me]),Object(i.useEffect)(()=>{be&&Z!==be&&Me(be)&&(ee(be),Q(!0))},[Z,be,Me]),Object(i.useEffect)(()=>{ve&&Z!==ve&&Me(ve)&&(ee(ve),X(!0))},[Z,ve,Me]),Object(i.useEffect)(()=>{R.length&&Object(E.j)(Object(E.e)(R),t)},[R,t]);const De=e=>B.findIndex(t=>t===e),_e=Object(i.useCallback)(e=>{if(e.length){var t;const n=((null===(t=H[e])||void 0===t?void 0:t.replies)||[]).length;se.start({name:d.a.VIEW_INLINE_COMMENT,attributes:{totalReplies:n,mode:P.c.VIEW,framework:P.b.REACT}})}},[se,H]),Pe=(e,t,n)=>{const i=(e,t)=>{ae(),Object($.e)();const n=((e,t)=>{let n;return"next"===e?n=t===B.length-1?0:t+1:"previous"===e&&(n=0===t?B.length-1:t-1),B[n]})(e,De(t));_e(n),F(n),Object($.n)(n)},{inlineMarkerRef:r}=t.location;oe?n.showDialog(C.a,{onConfirm:()=>i(e,r)}):i(e,r)},$e=Object(i.useCallback)(e=>{"view-all-inline-comments"===fe?(de||ue(!0),le(),Object($.m)(),me(e),pe()):(_e(e),X(!1),Y(!1),Q(!1),F(e),Object($.m)(),le(),ae(),Re([d.a.ADD_INLINE_COMMENT,d.a.EDIT_INLINE_COMMENT,d.a.REPLY_TO_INLINE_COMMENT],e.length?"new comment selected":"active comment closed"))},[le,_e,Re,ae,fe,de,me,ue,pe]);if(!Ee&&Ce||Te)return null;if(Ie)return Object(m.b)(Ie)?(Object(k.a)(Ie),null):r.a.createElement(h.a,{error:Ie});if(ke)return r.a.createElement(h.a,{error:ke});const Le=((null==we||null===(n=we.content)||void 0===n?void 0:n.nodes)||[])[0],Fe=null==Le||null===(a=Le.space)||void 0===a?void 0:a.id,He=null==Le?void 0:Le.type,Ve=(null==Le?void 0:Le.operations)||[],Be=Boolean(Ve.find(e=>"create"===(null==e?void 0:e.operation)&&"comment"===(null==e?void 0:e.targetType)));return r.a.createElement(p.a,{attribution:f.a.COLLABORATION},r.a.createElement(x.a,{metricName:S.a.INLINE_COMMENTS,usePageLoadStartTime:!0}),r.a.createElement(c.c,{to:[O.a,I.a]},(n,o)=>r.a.createElement(i.Fragment,null,r.a.createElement(L,{markerRefs:B,onHighlightClick:$e,dialogs:n}),r.a.createElement(q,null),"view-all-inline-comments"!==fe&&r.a.createElement(i.Fragment,null,r.a.createElement(xe,{pageId:e,pageType:He,spaceId:Fe,onClose:Ne,onDeleteSuccess:Oe,onNewCommentSuccess:je,canReplyToComment:Be,userId:re,comment:H[R],newCommentHighlight:ce,shouldShowFocusedComment:W,shouldOpenCommentEditor:K,shouldShowReplyEditor:J,isFabricPage:t,navigateToComment:(e,t)=>Pe(e,t,n),currentCommentIndex:De(R),commentsCount:B.length,refetchComments:Oe,dialogs:n,floatingBanners:o,lastFetchTime:te}),R&&r.a.createElement(N.a,{accelerator:["n","p"],listener:e=>((e,t)=>{e&&("n"===e.key?Pe("next",H[R],t):"p"===e.key&&Pe("previous",H[R],t))})(e,n)})),r.a.createElement(A.a,{metricName:S.a.INLINE_COMMENTS}))))}},wS3D:function(e,t){!function(e,t,n,i){const r=1,o=3,a="textHighlighter";function s(t,n){this.context=t,this.$context=e(t),this.options=e.extend({},e[a].defaults,n),this.init()}s.prototype={init(){this.$context.addClass(this.options.contextClass),this.bindEvents()},destroy(){this.unbindEvents(),this.$context.removeClass(this.options.contextClass),this.$context.removeData(a)},bindEvents(){},unbindEvents(){},highlightHandler(e){e.data.self.doHighlight()},doHighlight(t){const n=t||this.getCurrentRange();if(!n||n.collapsed)return;const i=n.toString();let r="";if(1==this.options.onBeforeHighlight(n)){const t=e.textHighlighter.createWrapper(this.options),o=this.highlightRange(n,t);r=this.normalizeHighlights(o),this.options.onAfterHighlight(r,i)}return this.removeAllRanges(),r},getCurrentRange(){const e=this.getCurrentSelection();let t;return e.rangeCount>0&&(t=e.getRangeAt(0)),t},removeAllRanges(){this.getCurrentSelection().removeAllRanges()},getCurrentSelection(){const t=this.getCurrentWindow();let n;return t.getSelection?n=t.getSelection():e("iframe").length?e("iframe",top.document).each((function(){if(this.contentWindow===t)return n=rangy.getIframeSelection(this),!1})):n=rangy.getSelection(),n},getCurrentWindow(){const e=this.getCurrentDocument();return e.defaultView?e.defaultView:e.parentWindow},getCurrentDocument(){return this.context.ownerDocument?this.context.ownerDocument:this.context},highlightRange(t,n){if(t.collapsed)return;const i=["SCRIPT","STYLE","SELECT","BUTTON","OBJECT","APPLET"];let r=t.startContainer,a=t.endContainer;const s=t.commonAncestorContainer;let c=!0;if(0==t.endOffset){for(;!a.previousSibling&&a.parentNode!=s;)a=a.parentNode;a=a.previousSibling}else a.nodeType==o?t.endOffset<a.nodeValue.length&&a.splitText(t.endOffset):t.endOffset>0&&(a=a.childNodes.item(t.endOffset-1));r.nodeType==o?t.startOffset==r.nodeValue.length?c=!1:t.startOffset>0&&(r=r.splitText(t.startOffset),a==r.previousSibling&&(a=r)):r=t.startOffset<r.childNodes.length?r.childNodes.item(t.startOffset):r.nextSibling;let l=!1,d=r;const u=[];do{if(c&&d.nodeType==o){if(/\S/.test(d.nodeValue)){const t=n.clone(!0).get(0),i=d.parentNode;if(e.contains(this.context,i)||i===this.context){const n=e(d).wrap(t).parent().get(0);u.push(n)}}c=!1}d!=a||a.hasChildNodes()&&c||(l=!0),-1!=e.inArray(d.tagName,i)&&(c=!1),c&&d.hasChildNodes()?d=d.firstChild:null!=d.nextSibling?(d=d.nextSibling,c=!0):(d=d.parentNode,c=!1)}while(!l);return u},normalizeHighlights(t){this.flattenNestedHighlights(t),this.mergeSiblingHighlights(t);return e.map(t,e=>void 0!==e.parentElement?null!=e.parentElement?e:null:null!=e.parentNode?e:null)},flattenNestedHighlights(t){const i=this;e.each(t,(function(r){const o=e(this),a=o.parent(),s=a.prev(),c=a.next();if(i.isHighlight(a))if(a.css("background-color")!=o.css("background-color"))i.isHighlight(s)&&!o.get(0).previousSibling&&s.css("background-color")!=a.css("background-color")&&s.css("background-color")==o.css("background-color")&&o.insertAfter(s),i.isHighlight(c)&&!o.get(0).nextSibling&&c.css("background-color")!=a.css("background-color")&&c.css("background-color")==o.css("background-color")&&o.insertBefore(c),a.is(":empty")&&a.remove();else{const i=n.createTextNode(a.text());a.empty(),a.append(i),e(t[r]).remove()}}))},mergeSiblingHighlights(t){const n=this;function i(t,i){return!(!i||i.nodeType!=r||e(t).css("background-color")!=e(i).css("background-color")||!e(i).hasClass(n.options.highlightedClass))}e.each(t,(function(){const t=this,n=t.previousSibling,r=t.nextSibling;if(i(t,n)){var o=e(n).text()+e(t).text();e(t).text(o),e(n).remove()}if(i(t,r)){o=e(t).text()+e(r).text();e(t).text(o),e(r).remove()}}))},setColor(e){this.options.color=e},getColor(){return this.options.color},removeHighlights(t){const n=void 0!==t?t:this.context,i=this;this.getAllHighlights(n,!0).each((function(){if(1==i.options.onRemoveHighlight(this)){e(this).contents().unwrap().get(0)}}))},getAllHighlights(t,n){const i="."+this.options.highlightedClass;let r=e(t).find(i);return 1==n&&e(t).hasClass(this.options.highlightedClass)&&(r=r.add(t)),r},isHighlight(e){return e.hasClass(this.options.highlightedClass)},serializeHighlights(t){const n=t||this.getAllHighlights(this.context),i=this.context,r=[];return n.each((t,n)=>{let a=0;const s=n.firstChild.length,c=function(t,n){const i=[];do{const n=e.inArray(t,t.parentNode.childNodes);i.unshift(n),t=t.parentNode}while(t!==n);return i}(n,i);e(n).clone().empty().get(0).outerHTML;n.previousSibling&&n.previousSibling.nodeType===o&&(a=n.previousSibling.length),r.push([e(n).text(),c.join(":"),a,s])}),JSON.stringify(r)},deserializeHighlights(t,n){try{var i=JSON.parse(t)}catch(c){throw new Error("Can't parse serialized highlights: "+c)}const r=[],a=this;let s=!0;return e.each(i,(t,i)=>{try{!function(t){const i=t[0],s=t[1].split(":"),c=t[2],l=t[3];let d=s.pop(),u=null,m=a.context;for(;void 0!==(u=s.shift());)m=m.childNodes[u];m.childNodes[d-1]&&m.childNodes[d-1].nodeType===o&&(d-=1);const h=m.childNodes[d].splitText(c);if(h.splitText(l),h.nextSibling&&""==h.nextSibling.nodeValue&&h.parentNode.removeChild(h.nextSibling),h.previousSibling&&""==h.previousSibling.nodeValue&&h.parentNode.removeChild(h.previousSibling),i!==h.nodeValue)throw new Error("Different text");const p=e(h).wrap(n).parent().get(0);r.push(p)}(i)}catch(c){return console&&console.warn&&console.warn(`Can't deserialize ${t}-th descriptor. Cause: ${c}`),s=!1,!0}}),s&&r}},e.fn.getHighlighter=function(){return this.data(a)},e.fn[a]=function(t){return this.each((function(){e.data(this,a)||e.data(this,a,new s(this,t))}))},e.textHighlighter={createWrapper:t=>e("<span></span>").css("backgroundColor",t.color).addClass(t.highlightedClass),defaults:{color:"#ffff7b",highlightedClass:"highlighted",contextClass:"highlighter-context",onRemoveHighlight:()=>!0,onBeforeHighlight:()=>!0,onAfterHighlight(){}}}}(jQuery,window,document)},xkEZ:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return d}));var i=n("Czhu"),r=n("ERkP"),o=n.n(r),a=n("FdGg"),s=n("fDrt");function c(e){return d(a.a,e)}function l(e){return d(s.a,e)}function d(e,t){return function(n){return r=>o.a.createElement(e,Object(i.a)({},t),o.a.createElement(n,Object(i.a)({},r)))}}},y4bl:function(e,t,n){var i=n("c72w"),r=n("xoyU"),o=n("pnw1"),a=n("tQYX"),s=n("Ypsa");e.exports=function(e,t,n,c){if(!a(e))return e;for(var l=-1,d=(t=r(t,e)).length,u=d-1,m=e;null!=m&&++l<d;){var h=s(t[l]),p=n;if("__proto__"===h||"constructor"===h||"prototype"===h)return e;if(l!=u){var f=m[h];void 0===(p=c?c(f,h,m):void 0)&&(p=a(f)?f:o(t[l+1])?[]:{})}i(m,h,p),m=m[h]}return e}}}]);
//# sourceMappingURL=inline-comments~493df0b3.WY6YUmcNHg.js.map