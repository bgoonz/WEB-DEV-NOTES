<h1 id="model-instances">Model Instances</h1>
<p>As you already know, a model is an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes">ES6 class</a>. An instance of the class represents one object from that model (which maps to one row of the table in the database). This way, model instances are <a href="https://en.wikipedia.org/wiki/Data_access_object">DAOs</a>.</p>
<p>For this guide, the following setup will be assumed:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">const</span> <span class="op">{</span> Sequelize<span class="op">,</span> Model<span class="op">,</span> DataTypes <span class="op">}</span> <span class="op">=</span> <span class="at">require</span>(<span class="st">&quot;sequelize&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">const</span> sequelize <span class="op">=</span> <span class="kw">new</span> <span class="at">Sequelize</span>(<span class="st">&quot;sqlite::memory:&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">const</span> User <span class="op">=</span> <span class="va">sequelize</span>.<span class="at">define</span>(<span class="st">&quot;user&quot;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-5" title="5">  <span class="dt">name</span><span class="op">:</span> <span class="va">DataTypes</span>.<span class="at">TEXT</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-6" title="6">  <span class="dt">favoriteColor</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="dt">type</span><span class="op">:</span> <span class="va">DataTypes</span>.<span class="at">TEXT</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="dt">defaultValue</span><span class="op">:</span> <span class="st">&#39;green&#39;</span></a>
<a class="sourceLine" id="cb1-9" title="9">  <span class="op">},</span></a>
<a class="sourceLine" id="cb1-10" title="10">  <span class="dt">age</span><span class="op">:</span> <span class="va">DataTypes</span>.<span class="at">INTEGER</span><span class="op">,</span></a>
<a class="sourceLine" id="cb1-11" title="11">  <span class="dt">cash</span><span class="op">:</span> <span class="va">DataTypes</span>.<span class="at">INTEGER</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-13" title="13"></a>
<a class="sourceLine" id="cb1-14" title="14">(<span class="kw">async</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-15" title="15">  <span class="cf">await</span> <span class="va">sequelize</span>.<span class="at">sync</span>(<span class="op">{</span> <span class="dt">force</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-16" title="16">  <span class="co">// Code here</span></a>
<a class="sourceLine" id="cb1-17" title="17"><span class="op">}</span>)()<span class="op">;</span></a></code></pre></div>
<h2 id="creating-an-instance">Creating an instance</h2>
<p>Although a model is a class, you should not create instances by using the <code>new</code> operator directly. Instead, the <a href="../class/lib/model.js~Model.html#static-method-build"><code>build</code></a> method should be used:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">const</span> jane <span class="op">=</span> <span class="va">User</span>.<span class="at">build</span>(<span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Jane&quot;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="va">console</span>.<span class="at">log</span>(jane <span class="kw">instanceof</span> User)<span class="op">;</span> <span class="co">// true</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="va">console</span>.<span class="at">log</span>(<span class="va">jane</span>.<span class="at">name</span>)<span class="op">;</span> <span class="co">// &quot;Jane&quot;</span></a></code></pre></div>
<p>However, the code above does not communicate with the database at all (note that it is not even asynchronous)! This is because the <a href="../class/lib/model.js~Model.html#static-method-build"><code>build</code></a> method only creates an object that <em>represents</em> data that <em>can</em> be mapped to a database. In order to really save (i.e.Â persist) this instance in the database, the <a href="../class/lib/model.js~Model.html#instance-method-save"><code>save</code></a> method should be used:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="cf">await</span> <span class="va">jane</span>.<span class="at">save</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;Jane was saved to the database!&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>Note, from the usage of <code>await</code> in the snippet above, that <code>save</code> is an asynchronous method. In fact, almost every Sequelize method is asynchronous; <code>build</code> is one of the very few exceptions.</p>
<h3 id="a-very-useful-shortcut-the-create-method">A very useful shortcut: the <code>create</code> method</h3>
<p>Sequelize provides the <a href="../class/lib/model.js~Model.html#static-method-create"><code>create</code></a> method, which combines the <code>build</code> and <code>save</code> methods shown above into a single method:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">const</span> jane <span class="op">=</span> <span class="cf">await</span> <span class="va">User</span>.<span class="at">create</span>(<span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Jane&quot;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co">// Jane exists in the database now!</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="va">console</span>.<span class="at">log</span>(jane <span class="kw">instanceof</span> User)<span class="op">;</span> <span class="co">// true</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="va">console</span>.<span class="at">log</span>(<span class="va">jane</span>.<span class="at">name</span>)<span class="op">;</span> <span class="co">// &quot;Jane&quot;</span></a></code></pre></div>
<h2 id="note-logging-instances">Note: logging instances</h2>
<p>Trying to log a model instance directly to <code>console.log</code> will produce a lot of clutter, since Sequelize instances have a lot of things attached to them. Instead, you can use the <code>.toJSON()</code> method (which, by the way, automatically guarantees the instances to be <code>JSON.stringify</code>-ed well).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">const</span> jane <span class="op">=</span> <span class="cf">await</span> <span class="va">User</span>.<span class="at">create</span>(<span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Jane&quot;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co">// console.log(jane); // Don&#39;t do this</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="va">console</span>.<span class="at">log</span>(<span class="va">jane</span>.<span class="at">toJSON</span>())<span class="op">;</span> <span class="co">// This is good!</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="va">console</span>.<span class="at">log</span>(<span class="va">JSON</span>.<span class="at">stringify</span>(jane<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="dv">4</span>))<span class="op">;</span> <span class="co">// This is also good!</span></a></code></pre></div>
<h2 id="default-values">Default values</h2>
<p>Built instances will automatically get default values:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">const</span> jane <span class="op">=</span> <span class="va">User</span>.<span class="at">build</span>(<span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Jane&quot;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="va">console</span>.<span class="at">log</span>(<span class="va">jane</span>.<span class="at">favoriteColor</span>)<span class="op">;</span> <span class="co">// &quot;green&quot;</span></a></code></pre></div>
<h2 id="updating-an-instance">Updating an instance</h2>
<p>If you change the value of some field of an instance, calling <code>save</code> again will update it accordingly:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">const</span> jane <span class="op">=</span> <span class="cf">await</span> <span class="va">User</span>.<span class="at">create</span>(<span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Jane&quot;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="va">console</span>.<span class="at">log</span>(<span class="va">jane</span>.<span class="at">name</span>)<span class="op">;</span> <span class="co">// &quot;Jane&quot;</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="va">jane</span>.<span class="at">name</span> <span class="op">=</span> <span class="st">&quot;Ada&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">// the name is still &quot;Jane&quot; in the database</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="cf">await</span> <span class="va">jane</span>.<span class="at">save</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">// Now the name was updated to &quot;Ada&quot; in the database!</span></a></code></pre></div>
<h2 id="deleting-an-instance">Deleting an instance</h2>
<p>You can delete an instance by calling <a href="../class/lib/model.js~Model.html#instance-method-destroy"><code>destroy</code></a>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">const</span> jane <span class="op">=</span> <span class="cf">await</span> <span class="va">User</span>.<span class="at">create</span>(<span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Jane&quot;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="va">console</span>.<span class="at">log</span>(<span class="va">jane</span>.<span class="at">name</span>)<span class="op">;</span> <span class="co">// &quot;Jane&quot;</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="cf">await</span> <span class="va">jane</span>.<span class="at">destroy</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co">// Now this entry was removed from the database</span></a></code></pre></div>
<h2 id="reloading-an-instance">Reloading an instance</h2>
<p>You can reload an instance from the database by calling <a href="../class/lib/model.js~Model.html#instance-method-reload"><code>reload</code></a>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">const</span> jane <span class="op">=</span> <span class="cf">await</span> <span class="va">User</span>.<span class="at">create</span>(<span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Jane&quot;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="va">console</span>.<span class="at">log</span>(<span class="va">jane</span>.<span class="at">name</span>)<span class="op">;</span> <span class="co">// &quot;Jane&quot;</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="va">jane</span>.<span class="at">name</span> <span class="op">=</span> <span class="st">&quot;Ada&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co">// the name is still &quot;Jane&quot; in the database</span></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="cf">await</span> <span class="va">jane</span>.<span class="at">reload</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="va">console</span>.<span class="at">log</span>(<span class="va">jane</span>.<span class="at">name</span>)<span class="op">;</span> <span class="co">// &quot;Jane&quot;</span></a></code></pre></div>
<p>The reload call generates a <code>SELECT</code> query to get the up-to-date data from the database.</p>
<h2 id="saving-only-some-fields">Saving only some fields</h2>
<p>It is possible to define which attributes should be saved when calling <code>save</code>, by passing an array of column names.</p>
<p>This is useful when you set attributes based on a previously defined object, for example, when you get the values of an object via a form of a web app. Furthermore, this is used internally in the <code>update</code> implementation. This is how it looks like:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">const</span> jane <span class="op">=</span> <span class="cf">await</span> <span class="va">User</span>.<span class="at">create</span>(<span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Jane&quot;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="va">console</span>.<span class="at">log</span>(<span class="va">jane</span>.<span class="at">name</span>)<span class="op">;</span> <span class="co">// &quot;Jane&quot;</span></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="va">console</span>.<span class="at">log</span>(<span class="va">jane</span>.<span class="at">favoriteColor</span>)<span class="op">;</span> <span class="co">// &quot;green&quot;</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="va">jane</span>.<span class="at">name</span> <span class="op">=</span> <span class="st">&quot;Jane II&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="va">jane</span>.<span class="at">favoriteColor</span> <span class="op">=</span> <span class="st">&quot;blue&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="cf">await</span> <span class="va">jane</span>.<span class="at">save</span>(<span class="op">{</span> <span class="dt">fields</span><span class="op">:</span> [<span class="st">&#39;name&#39;</span>] <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="va">console</span>.<span class="at">log</span>(<span class="va">jane</span>.<span class="at">name</span>)<span class="op">;</span> <span class="co">// &quot;Jane II&quot;</span></a>
<a class="sourceLine" id="cb10-8" title="8"><span class="va">console</span>.<span class="at">log</span>(<span class="va">jane</span>.<span class="at">favoriteColor</span>)<span class="op">;</span> <span class="co">// &quot;blue&quot;</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="co">// The above printed blue because the local object has it set to blue, but</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="co">// in the database it is still &quot;green&quot;:</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="cf">await</span> <span class="va">jane</span>.<span class="at">reload</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="va">console</span>.<span class="at">log</span>(<span class="va">jane</span>.<span class="at">name</span>)<span class="op">;</span> <span class="co">// &quot;Jane II&quot;</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="va">console</span>.<span class="at">log</span>(<span class="va">jane</span>.<span class="at">favoriteColor</span>)<span class="op">;</span> <span class="co">// &quot;green&quot;</span></a></code></pre></div>
<h2 id="change-awareness-of-save">Change-awareness of save</h2>
<p>The <code>save</code> method is optimized internally to only update fields that really changed. This means that if you donât change anything and call <code>save</code>, Sequelize will know that the save is superfluous and do nothing, i.e., no query will be generated (it will still return a Promise, but it will resolve immediately).</p>
<p>Also, if only a few attributes have changed when you call <code>save</code>, only those fields will be sent in the <code>UPDATE</code> query, to improve performance.</p>
<h2 id="incrementing-and-decrementing-integer-values">Incrementing and decrementing integer values</h2>
<p>In order to increment/decrement values of an instance without running into concurrency issues, Sequelize provides the <a href="../class/lib/model.js~Model.html#instance-method-increment"><code>increment</code></a> and <a href="../class/lib/model.js~Model.html#instance-method-decrement"><code>decrement</code></a> instance methods.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">const</span> jane <span class="op">=</span> <span class="cf">await</span> <span class="va">User</span>.<span class="at">create</span>(<span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Jane&quot;</span><span class="op">,</span> <span class="dt">age</span><span class="op">:</span> <span class="dv">100</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">const</span> incrementResult <span class="op">=</span> <span class="cf">await</span> <span class="va">jane</span>.<span class="at">increment</span>(<span class="st">&#39;age&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="dt">by</span><span class="op">:</span> <span class="dv">2</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">// Note: to increment by 1 you can omit the `by` option and just do `user.increment(&#39;age&#39;)`</span></a>
<a class="sourceLine" id="cb11-4" title="4"></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="co">// In PostgreSQL, `incrementResult` will be the updated user, unless the option</span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co">// `{ returning: false }` was set (and then it will be undefined).</span></a>
<a class="sourceLine" id="cb11-7" title="7"></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="co">// In other dialects, `incrementResult` will be undefined. If you need the updated instance, you will have to call `user.reload()`.</span></a></code></pre></div>
<p>You can also increment multiple fields at once:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">const</span> jane <span class="op">=</span> <span class="cf">await</span> <span class="va">User</span>.<span class="at">create</span>(<span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;Jane&quot;</span><span class="op">,</span> <span class="dt">age</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span> <span class="dt">cash</span><span class="op">:</span> <span class="dv">5000</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="cf">await</span> <span class="va">jane</span>.<span class="at">increment</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="st">&#39;age&#39;</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="st">&#39;cash&#39;</span><span class="op">:</span> <span class="dv">100</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-6" title="6"></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="co">// If the values are incremented by the same amount, you can use this other syntax as well:</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="cf">await</span> <span class="va">jane</span>.<span class="at">increment</span>([<span class="st">&#39;age&#39;</span><span class="op">,</span> <span class="st">&#39;cash&#39;</span>]<span class="op">,</span> <span class="op">{</span> <span class="dt">by</span><span class="op">:</span> <span class="dv">2</span> <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Decrementing works in the exact same way.</p>
