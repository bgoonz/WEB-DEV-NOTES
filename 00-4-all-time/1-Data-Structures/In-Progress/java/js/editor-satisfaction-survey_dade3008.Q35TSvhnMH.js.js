(window.webpackJsonp=window.webpackJsonp||[]).push([["editor-satisfaction-survey~dade3008"],{"2v6S":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));const s=[{name:"terrible",id:0,value:1},{name:"bad",id:1,value:2},{name:"okay",id:2,value:3},{name:"great",id:3,value:4},{name:"amazing",id:4,value:5}]},JOcB:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var s=i("Czhu"),a=i("HbGN"),n=i("zjfJ"),o=i("ERkP"),r=i.n(o),u=i("gQ5V");i("aWzz");class c extends o.Component{constructor(...e){super(...e),Object(n.a)(this,"_queryResults",[]),Object(n.a)(this,"_queryProperties",[]),Object(n.a)(this,"_anyLoading",()=>this._queryResults.some(e=>!0===e.loading)),Object(n.a)(this,"_renderQueryComponent",(e,t,i)=>e.length?r.a.createElement(u.b,Object(s.a)({errorPolicy:"all"},e[i]),s=>{let{data:n,loading:o,error:r}=s,u=Object(a.a)(s,["data","loading","error"]);this._queryResults[i]={data:n,loading:o,error:r},this._queryProperties[i]=u;const c=i+1;return e.length>c?this._renderQueryComponent(e,t,c):t({results:this._queryResults,loading:this._anyLoading(),properties:this._queryProperties})}):t({results:[],loading:!1}))}render(){const{queryProps:e,children:t}=this.props;return this._renderQueryComponent(e,t,0)}}},WbO6:function(e,t,i){"use strict";i.r(t);var s=i("zjfJ"),a=i("ERkP"),n=i.n(a),o=i("lZoD"),r=i("JOcB"),u=i("KIs4"),c=i("fDrt"),d=i("X2PC"),l=i("w7pu"),b=i("Czhu"),h=i("HbGN"),m=i("L21V"),p=i("lbXe"),y=i("cGYM"),f=i("2v6S"),v=i("ntAl");const S={"meeting-notes":!0,decisions:!0,"kb-how-to-article":!0,"file-list":!0,retrospective:!0,requirements:!0,"shared-links":!0,"kb-troubleshooting-article":!0,"task-report":!0,jirareport:!0};var g=i("oayO"),j=i("SRtI");function O(){g.a.setItem(j.b.EDITOR_SURVEY_LAST_SUBMITTED,Date.now())}const T=Object(m.f)({questionBad:{id:"editor-satisfaction-survey.question.bad",defaultMessage:"We're sorry to hear that. What went wrong? (optional)",description:"Prompt for user to follow up on negative response"},questionGood:{id:"editor-satisfaction-survey.question.good",defaultMessage:"Thanks! What did you like about it? What could be improved? (optional)",description:"Prompt for user to follow up on positive response"},reaction_amazing:{id:"editor-satisfaction-survey.reaction.amazing",defaultMessage:"Amazing",description:"hover tooltip for corresponding emoji"},reaction_bad:{id:"editor-satisfaction-survey.reaction.bad",defaultMessage:"Bad",description:"hover tooltip for corresponding emoji"},reaction_great:{id:"editor-satisfaction-survey.reaction.great",defaultMessage:"Great",description:"hover tooltip for corresponding emoji"},reaction_okay:{id:"editor-satisfaction-survey.reaction.okay",defaultMessage:"Okay",description:"hover tooltip for corresponding emoji"},reaction_terrible:{id:"editor-satisfaction-survey.reaction.terrible",defaultMessage:"Terrible",description:"hover tooltip for corresponding emoji"},surveyTitle:{id:"editor-satisfaction-survey.title",defaultMessage:"Your page has been published",description:"title of survey form"},surveyFinalTitle:{id:"editor-satisfaction-survey.final.title",defaultMessage:"Thank you",description:"title after finishing survey"},buttonSubmit:{id:"editor-satisfaction-survey.button.submit",defaultMessage:"Submit",description:"Button text to submit responses"},buttonClose:{id:"editor-satisfaction-survey.button.close",defaultMessage:"Close",description:"Button text to close survey modal"}});const E=Object.keys(S),P=Object(m.g)(Object(p.a)()(class extends a.PureComponent{constructor(...e){super(...e),Object(s.a)(this,"state",{shouldShowSurvey:Boolean(this.props.shouldShowSurvey)}),Object(s.a)(this,"autoHideFinalTimeout",void 0),Object(s.a)(this,"analyticsFired",!1),Object(s.a)(this,"handleAction",e=>{const{markSubmitted:t,markLastSubmitted:i,hasBeenSubmitted:s}=this.props;s||this.analyticsFired||(this.fireAnalytics(e),t(),i(),this.analyticsFired=!0),e.dismissed&&this.closeSurvey()}),Object(s.a)(this,"isDismissed",!1),Object(s.a)(this,"closeSurvey",()=>{this.isDismissed||(this.props.closeSurvey(),this.setState({shouldShowSurvey:!1}),this.isDismissed=!0,clearTimeout(this.autoHideFinalTimeout))}),Object(s.a)(this,"fireAnalytics",e=>{let{reaction:t="",feedback:i=""}=e,s=Object(h.a)(e,["reaction","feedback"]);const{isFabricPage:a,contentType:n,blueprintType:o,createAnalyticsEvent:r,testCohorts:u,experimentFeatures:c}=this.props,d=f.a.indexOf(t)+1,l={contentType:Object(y.c)("page","blogpost")(n),editorVersion:Object(y.c)("fabric","tinymce")(a?"fabric":"tinymce"),reaction:d,feedback:Object(y.a)(i)};o&&(l.blueprintType=Object(y.c)(...E)(o)),s.cohorts||(s.cohorts=u),s.experiments||(s.experiments=c),Object.keys(s).forEach(e=>{l[e]=Object(y.a)(s[e])}),r({type:"sendUIEvent",data:{source:"viewPageScreen",action:"submit",actionSubject:"confluence.spa.editor.fabric.satisfaction",attributes:Object(b.a)({},l)}}).fire()})}componentDidUpdate(e){const{hasBeenSubmitted:t,shouldShowSurvey:i,wasTinyMCEPageJustPublished:s}=this.props,{contentId:a,openSurvey:n}=e;e.hasBeenSubmitted!==t&&!0===t&&(this.autoHideFinalTimeout=window.setTimeout(this.closeSurvey,2e3)),e.shouldShowSurvey!==i&&!0===i&&(this.isDismissed=!1,this.analyticsFired=!1),e.wasTinyMCEPageJustPublished!==s&&!0===s&&(g.a.removeItem(j.b.TINYMCE_PAGE_JUST_PUBLISHED),n(a))}componentWillUnmount(){clearTimeout(this.autoHideFinalTimeout),this.props.closeSurvey()}render(){const{shouldShowSurvey:e,hasBeenSubmitted:t,intl:{formatMessage:i}}=this.props;if(!e)return null;const s=i(T.questionBad),a=i(T.questionGood),o=[s,s,a,a,a],r=f.a.map(e=>i(T["reaction_"+e.name]));return n.a.createElement(v.b,{title:i(T.surveyTitle),description:n.a.createElement(m.b,{id:"editor-satisfaction-survey.description",defaultMessage:"How was your editing experience?",description:"Question in survey about the editor"}),finalTitle:i(T.surveyFinalTitle),finalDescription:n.a.createElement(m.b,{id:"editor-satisfaction-survey.final.description",defaultMessage:"Your feedback has been submitted"}),reactionTitles:r,formQuestions:o,isOnFinalStage:t,onInteraction:this.handleAction,submitButtonText:i(T.buttonSubmit),closeButtonText:i(T.buttonClose)})}}));var w=i("H5qd");const k=i.n(w).a`query EditorSatisfactionSurveyQuery($contentId:ID){content(id:$contentId){nodes{id type metadata{labels{id name}}}}}`;var I=i("xXmr");i.d(t,"EditorSatisfactionSurvey",(function(){return _}));class _ extends a.PureComponent{constructor(...e){super(...e),Object(s.a)(this,"lastSubmitted",Date.now()),Object(s.a)(this,"wasTinyMCEPageJustPublished",!1)}componentDidMount(){const e=function(){const e=g.a.getItem(j.b.EDITOR_SURVEY_LAST_SUBMITTED);return e?parseInt(e,10):0}(),t="true"===g.a.getItem(j.b.TINYMCE_PAGE_JUST_PUBLISHED);this.lastSubmitted=e,this.wasTinyMCEPageJustPublished=t}render(){const{contentId:e,isFabricPage:t}=this.props;if(!e)return null;const i=[{query:k,variables:{contentId:e}}];return n.a.createElement(c.a,{attribution:d.a.CONTENT_EXPERIENCE},n.a.createElement(l.a.Consumer,null,({experimentFeatures:s,abTestCohorts:a})=>n.a.createElement(r.a,{queryProps:i},({results:[i],loading:r})=>{var c;const d=null!=(c=i.data)&&null!=(c=c.content)&&null!=(c=c.nodes)?c[0]:c;if(i.error||r||!d)return null;const l=d.metadata&&d.metadata.labels||[],b=d.type,h=l.find(e=>{if(e&&e.name)return S[e.name]});let m="";return h&&h.name&&(m=h.name),n.a.createElement(o.c,{to:[I.a]},i=>n.a.createElement(u.a,null,({featureFlags:o})=>{let r=Number(o["confluence.frontend.fabric.editor.satisfaction.survey.delay"]);(!r||r<1)&&(r=1);const u=24*r*60*60*1e3;if(this.lastSubmitted<Date.now()-u){const{contentId:r,hasBeenSubmitted:u}=i.state,c=Boolean(o["confluence.frontend.fabric.editor.satisfaction.survey"]),d=t||function(e){try{return"control"===JSON.parse(e)["fabric.editor.blank.blogpost"]}catch(t){return!1}}(s),l=Boolean(r)&&r===e&&c&&d;return n.a.createElement(P,{contentType:b,contentId:e,blueprintType:m,hasBeenSubmitted:u,isFabricPage:t,shouldShowSurvey:l,wasTinyMCEPageJustPublished:this.wasTinyMCEPageJustPublished,markSubmitted:i.markSurveySubmitted,markLastSubmitted:O,openSurvey:i.setContentId,closeSurvey:i.resetState,testCohorts:a,experimentFeatures:s})}return null}))})))}}},ntAl:function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return n})),i.d(t,"c",(function(){return o}));var s=i("RfuI");const a=Object(s.a)({id:"ejl3d",name:"SatisfactionSurveyFlag",loader:async()=>(await Promise.all([i.e("atlaskit~66e23772"),i.e("vendors~4134d62c"),i.e(0),i.e(1),i.e("satisfaction-survey~b59ad437")]).then(i.bind(null,"EyvQ"))).SatisfactionSurveyFlag}),n=Object(s.a)({id:"Y43Qa",name:"SatisfactionSurveyComponent",loader:async()=>(await Promise.all([i.e("atlaskit~66e23772"),i.e("vendors~4134d62c"),i.e(0),i.e(1),i.e("satisfaction-survey~b59ad437")]).then(i.bind(null,"d1uF"))).SatisfactionSurveyComponent}),o=Object(s.a)({id:"s1vEV",name:"SatisfactionSurveyModal",loader:async()=>(await Promise.all([i.e("atlaskit~66e23772"),i.e("vendors~4134d62c"),i.e(0),i.e(1),i.e("satisfaction-survey~b59ad437")]).then(i.bind(null,"FA/R"))).SatisfactionSurveyModal})},xXmr:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i("zjfJ"),a=i("lZoD");const n={contentId:null,hasBeenSubmitted:!1};class o extends a.a{constructor(...e){super(...e),Object(s.a)(this,"state",n),Object(s.a)(this,"setContentId",e=>{e&&this.setState({contentId:e})}),Object(s.a)(this,"markSurveySubmitted",()=>{this.setState({hasBeenSubmitted:!0})}),Object(s.a)(this,"resetState",()=>{this.setState(n)})}}}}]);
//# sourceMappingURL=editor-satisfaction-survey~dade3008.Q35TSvhnMH.js.map