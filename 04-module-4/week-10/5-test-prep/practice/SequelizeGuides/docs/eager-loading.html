<h1 id="joinsincludes-aka-eager-loading">Joins/Includes (aka “Eager Loading”)</h1>
<p><a href="http://docs.sequelizejs.com/manual/tutorial/models-usage.html#eager-loading">Official Docs</a></p>
<p>If we have two tables that are associated with each other, we often want to join that data together. In raw SQL queries, our favorite tool for this is an INNER JOIN. We can do something similar in Sequelize - it just goes by the slightly different name of “eager loading”. Don’t get hung up on the terminology - when you see “eager loading”, think “join two tables”.</p>
<p>If two tables have an association, we can “include” information from the associated table like so:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">const</span> Pug <span class="op">=</span> <span class="va">db</span>.<span class="at">define</span>(<span class="st">&#39;pugs&#39;</span><span class="op">,</span> <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span><span class="op">}</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">const</span> Owner <span class="op">=</span> <span class="va">db</span>.<span class="at">define</span>(<span class="st">&#39;owners&#39;</span><span class="op">,</span> <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span><span class="op">}</span>)</a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="va">Pug</span>.<span class="at">belongsTo</span>(Owner)</a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">const</span> getPugs <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb1-7" title="7">  <span class="kw">const</span> pugs <span class="op">=</span> <span class="cf">await</span> <span class="va">Pug</span>.<span class="at">findAll</span>(<span class="op">{</span> <span class="co">// we want to find all the pugs, and include their owners</span></a>
<a class="sourceLine" id="cb1-8" title="8">    <span class="dt">include</span><span class="op">:</span> [<span class="op">{</span><span class="dt">model</span><span class="op">:</span> Owner<span class="op">}</span>]</a>
<a class="sourceLine" id="cb1-9" title="9">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11">  <span class="va">console</span>.<span class="at">log</span>(pugs)</a>
<a class="sourceLine" id="cb1-12" title="12">  <span class="co">// [{name: &#39;Cody&#39;, ownerId: 1, owner: {name: &#39;Tom&#39;}}, ...etc]</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="op">}</span></a></code></pre></div>
<p><em>Important!</em> A Model can only eagerly load an association if the association is defined <em>on</em> that model.</p>
<p>This means that for the above example, if we attempt to do the following:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">const</span> Pug <span class="op">=</span> <span class="va">db</span>.<span class="at">define</span>(<span class="st">&#39;pugs&#39;</span><span class="op">,</span> <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span><span class="op">}</span>)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">const</span> Owner <span class="op">=</span> <span class="va">db</span>.<span class="at">define</span>(<span class="st">&#39;owners&#39;</span><span class="op">,</span> <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span><span class="op">}</span>)</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">// the relation only exists on Pug</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="va">Pug</span>.<span class="at">belongsTo</span>(Owner)</a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="va">Owner</span>.<span class="at">findAll</span>(<span class="op">{</span><span class="dt">include</span><span class="op">:</span> [<span class="op">{</span><span class="dt">model</span><span class="op">:</span> Pug<span class="op">}</span>]<span class="op">}</span>) <span class="co">// this will error!</span></a></code></pre></div>
<p>…it will error! For us to include Pug when we query Owner, we must also establish the ‘hasOne’ or ‘hasMany’ association between Owners and Pugs.</p>
<p>Example with <code>hasOne</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">const</span> Pug <span class="op">=</span> <span class="va">db</span>.<span class="at">define</span>(<span class="st">&#39;pugs&#39;</span><span class="op">,</span> <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span><span class="op">}</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">const</span> Owner <span class="op">=</span> <span class="va">db</span>.<span class="at">define</span>(<span class="st">&#39;owners&#39;</span><span class="op">,</span> <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span><span class="op">}</span>)</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="va">Pug</span>.<span class="at">belongsTo</span>(Owner)</a>
<a class="sourceLine" id="cb3-5" title="5"><span class="va">Owner</span>.<span class="at">hasOne</span>(Pug) <span class="co">// 1-1 association</span></a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="kw">const</span> getPugs <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-8" title="8">  <span class="kw">const</span> owners <span class="op">=</span> <span class="cf">await</span> <span class="va">Owner</span>.<span class="at">findAll</span>(<span class="op">{</span><span class="dt">include</span><span class="op">:</span> [<span class="op">{</span><span class="dt">model</span><span class="op">:</span> Pug<span class="op">}</span>]<span class="op">}</span>)</a>
<a class="sourceLine" id="cb3-9" title="9">  <span class="va">console</span>.<span class="at">log</span>(owners) <span class="co">// [{name: &#39;Tom&#39;, pug: {name: &#39;Cody&#39;, ownerId: 1}}]</span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="op">}</span></a></code></pre></div>
<p>Example with <code>hasMany</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">const</span> Pug <span class="op">=</span> <span class="va">db</span>.<span class="at">define</span>(<span class="st">&#39;pugs&#39;</span><span class="op">,</span> <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span><span class="op">}</span>)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">const</span> Owner <span class="op">=</span> <span class="va">db</span>.<span class="at">define</span>(<span class="st">&#39;owners&#39;</span><span class="op">,</span> <span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span><span class="op">}</span>)</a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="va">Pug</span>.<span class="at">belongsTo</span>(Owner)</a>
<a class="sourceLine" id="cb4-5" title="5"><span class="va">Owner</span>.<span class="at">hasMany</span>(Pug) <span class="co">// 1-Many Relationship</span></a>
<a class="sourceLine" id="cb4-6" title="6"></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="kw">const</span> getPugs <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb4-8" title="8">  <span class="kw">const</span> owners <span class="op">=</span> <span class="cf">await</span> <span class="va">Owner</span>.<span class="at">findAll</span>(<span class="op">{</span><span class="dt">include</span><span class="op">:</span> [<span class="op">{</span><span class="dt">model</span><span class="op">:</span> Pug<span class="op">}</span>]<span class="op">}</span>)</a>
<a class="sourceLine" id="cb4-9" title="9">  <span class="va">console</span>.<span class="at">log</span>(owners) <span class="co">// [{name: &#39;Tom&#39;, pugs: [{name: &#39;Cody&#39;, ownerId: 1}]}]</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="op">}</span></a></code></pre></div>
<p>Note that the difference between the two examples above is that in the <code>hasOne</code> case, the resultant owners have a “pug” field with the name of their (single) pug. In the <code>hasMany</code> case, the resultant owners have a “pugs” (plural!) field with an <em>array</em> of their (possibly many) pugs!</p>
<p>This same rule applies to many-to-many associations!</p>
