(window.webpackJsonp=window.webpackJsonp||[]).push([["growth.upgrade.admin.modal~0ae2caf4","upflow~0ae2caf4"],{"+352":function(e,n,t){"use strict";t.d(n,"h",(function(){return o})),t.d(n,"g",(function(){return a})),t.d(n,"k",(function(){return r})),t.d(n,"i",(function(){return c})),t.d(n,"b",(function(){return i})),t.d(n,"a",(function(){return u})),t.d(n,"n",(function(){return d})),t.d(n,"l",(function(){return l})),t.d(n,"m",(function(){return s})),t.d(n,"o",(function(){return E})),t.d(n,"j",(function(){return I})),t.d(n,"d",(function(){return f})),t.d(n,"e",(function(){return O})),t.d(n,"c",(function(){return _})),t.d(n,"f",(function(){return p}));const o="https://confluence.atlassian.com/display/ConfCloud/Confluence+Cloud+plans",a="confluence-change-edition-section-message",r="confluence-change-edition-remove-restrictions-button",c="confluence-change-edition-notification-dialog",i=3,u=10,d="/admin/billing/applications/change-edition/confluence.ondemand";let l;!function(e){e.DEFAULT="default",e.FLAT="flat",e.INLINE="inline",e.INLINE_MODAL="inline-modal"}(l||(l={}));const s="confluence.frontend.show.standard.upsell",E="confluence-up-flow-modal",I="upflow-confluence-persistent-upgrade",f="upflow-confluence-upgrade-for-admins",O="upflow-confluence-billing-for-admins",_="engaged-upgrade",p="engaged-billing";let g;!function(e){e.CONFLUENCE="confluence.ondemand",e.JIRA_CORE="jira-core.ondemand",e.JIRA_SERVICE_DESK="jira-servicedesk.ondemand",e.JIRA_SOFTWARE="jira-software.ondemand",e.TRELLO="trello",e.OPSGENIE="opsgenie",e.BITBUCKET="bitbucket.ondemand",e.STATUSPAGE="statuspage"}(g||(g={}))},"+UOj":function(e,n,t){"use strict";t.r(n);var o=t("ERkP"),a=t.n(o),r=t("L21V"),c=t("1U1M"),i=t("a0gl"),u=t("dIe6"),d=t("46jh"),l=t("6n9r"),s=t("t0Ff"),E=t("oayO"),I=t("SRtI"),f=t("LEcB"),O=t("TSpG"),_=t("HKB3"),p=t("Uo/y"),g=t("mvtW"),N=t("+352"),T=t("FdbS");const A=Object(r.g)(({cloudId:e,currentEdition:n,onClose:t,touchpointId:r,onOpen:c,canChangeEdition:i,intl:{locale:u}})=>{const d=()=>{const n=E.a.getItem(`${I.b.GROWTH_EXPERIMENT_UPGRADE_DISMISSED_COUNT}_${e}`);return n?parseInt(n):0},l=d(),s=((e,n)=>0===e||(1===e?Date.now()-n>1728e5:2===e&&Date.now()-n>6048e5))(l,(()=>{const n=E.a.getItem(`${I.b.GROWTH_EXPERIMENT_UPGRADE_LAST_DISMISSED_DATE}_${e}`);return n?parseInt(n):0})()),{cohort:A,fireExposureEvent:b}=Object(f.a)(O.a.ENGAGED_ADMINS,_.b,_.a.NOT_ENROLLED),m=Object(o.useCallback)(()=>(b(),A===_.a.EXPERIMENT),[A,b]);return Object(p.a)(u)?n!==g.a.FREE||l>3||!s?null:a.a.createElement(T.UpFlowComponent,{cloudId:e,canChangeEdition:i,currentEdition:n,targetEdition:g.a.STANDARD,flow:"upgrade",product:"confluence",touchpointId:r,onOpen:c,onClose:()=>{(()=>{E.a.setItem(`${I.b.GROWTH_EXPERIMENT_UPGRADE_LAST_DISMISSED_DATE}_${e}`,Date.now());const n=d();E.a.setItem(`${I.b.GROWTH_EXPERIMENT_UPGRADE_DISMISSED_COUNT}_${e}`,n+1)})(),t&&t()},epMessageId:N.d,onCoordinationStart:m,subRoute:N.c}):null});var b=t("kC4U"),m=t("z9P0");const L=Object(r.g)(({cloudId:e,currentEdition:n,onClose:t,touchpointId:r,onOpen:c,canChangeEdition:i,intl:{locale:u}})=>{const{cohort:d,fireExposureEvent:l}=Object(f.a)(O.a.ENGAGED_BILLING,_.b,_.a.NOT_ENROLLED),{createAnalyticsEvent:s}=Object(m.a)(),A=Object(o.useCallback)(async()=>{try{return!!(await(async e=>{const n=await Object(b.a)(`/gateway/api/billing-ux/cloud/${e}/billing/billing-details`,{method:"GET",headers:{"Content-Type":"application/json"}});return(await n.json()).paymentMethod})(e))}catch(n){return s({type:"sendOperationalEvent",data:{action:"getApiFailed",actionSubject:"apiCall",actionSubjectId:"getPaymentMethod",attributes:{flow:"engaged-billing",touchpointId:r,status:n.status,errorMessage:n.message}}}).fire(),!0}},[e,s,r]),L=Object(o.useCallback)(({displaysNextAt:e})=>{var n;e&&(n=e,E.a.setItem(I.b.LOCAL_STORAGE_DISPLAYS_NEXT_AT_KEY,n)),c&&c()},[c]),S=Object(o.useCallback)(()=>{t&&t()},[t]),R=Object(o.useCallback)(async()=>{if(!(()=>{const e=E.a.getItem(I.b.LOCAL_STORAGE_BILLING_API_NEXT_CALLED_AT_KEY)||"0";return parseInt(e,10)<Date.now()})())return"true"===E.a.getItem(I.b.LOCAL_STORAGE_HAS_BILLING_DETAILS);const e=await A();var n;return E.a.setItem(I.b.LOCAL_STORAGE_HAS_BILLING_DETAILS,e),d===_.a.CONTROL&&(n=Date.now()+1728e5,E.a.setItem(I.b.LOCAL_STORAGE_BILLING_API_NEXT_CALLED_AT_KEY,n)),e},[A,d]),C=Object(o.useCallback)(async()=>{const e=await R();e||l();return!e&&d===_.a.EXPERIMENT},[d,l,R]);if(d===_.a.NOT_ENROLLED)return null;if(!Object(p.a)(u))return null;if("true"===E.a.getItem(I.b.LOCAL_STORAGE_HAS_BILLING_DETAILS))return null;const D=(()=>{const e=(new Date).getTime(),n=E.a.getItem(""+I.b.LOCAL_STORAGE_DISPLAYS_NEXT_AT_KEY);return(n?parseInt(n,10):0)<e})();return n&&[g.a.STANDARD,g.a.PREMIUM].includes(n)&&D?a.a.createElement(T.UpFlowComponent,{cloudId:e,canChangeEdition:i,currentEdition:n,targetEdition:g.a.STANDARD,flow:"upgrade",product:"confluence",touchpointId:r,onOpen:L,onClose:S,epMessageId:N.e,onCoordinationStart:C,subRoute:N.f}):null});t.d(n,"UpgradeAdminModalComponent",(function(){return S})),t.d(n,"UpgradeAdminModal",(function(){return R}));const S=e=>{const{isSiteAdmin:n,touchpointId:t,onOpen:r,onClose:d}=e,{cloudId:E}=Object(i.a)(),{data:I,loading:f,error:O}=Object(c.d)(s.a,{skip:!n}),_=Object(l.a)(I);return O?a.a.createElement(u.a,{error:O}):f||!n?null:a.a.createElement(o.Fragment,null,a.a.createElement(A,{cloudId:E,currentEdition:_,onClose:d,touchpointId:t,onOpen:r,canChangeEdition:n}),a.a.createElement(L,{cloudId:E,currentEdition:_,onClose:d,touchpointId:t,onOpen:r,canChangeEdition:n}))},R=Object(r.g)(Object(d.a)(S))},"3ike":function(e,n,t){"use strict";t.d(n,"a",(function(){return u}));var o=t("8TdO"),a=t("+352"),r=t("t0Ff"),c=t("6n9r");const i=()=>(new Date).getTime(),u=e=>{if(!e)return Promise.reject(new Error("No currentEdition supplied"));const n=new Date(i()+60*a.a*1e3).getTime(),t=(u,d)=>{i()>n&&d(new Error("TIMEOUT")),Object(o.b)().query({query:r.a,errorPolicy:"all",fetchPolicy:"network-only"}).then(n=>{const o=Object(c.a)(n.data);o&&e!==o?u(o):setTimeout(()=>{t(u,d)},1e3*a.b)}).catch(d)};return new Promise((e,n)=>t(e,n))}},"46jh":function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));var o=t("Czhu"),a=t("ERkP"),r=t.n(a),c=t("w7pu");function i(e){return function(n){const{isSiteAdmin:t,error:i,loading:u}=Object(a.useContext)(c.a);return i||u?null:r.a.createElement(e,Object(o.a)(Object(o.a)({},n),{},{isSiteAdmin:t}))}}},FdbS:function(e,n,t){"use strict";t.r(n),t.d(n,"UpFlowEvents",(function(){return m})),t.d(n,"FlagType",(function(){return L})),t.d(n,"UpFlow",(function(){return R})),t.d(n,"UpFlowComponent",(function(){return C}));var o=t("Czhu"),a=t("nnm9"),r=t.n(a),c=t("ERkP"),i=t("7nmT"),u=t.n(i),d=t("L21V"),l=t("T+Mg"),s=t("IK18"),E=t("LEcB"),I=t("cld1"),f=t("cphC"),O=t("hpu0"),_=t("3VMZ"),p=t("oayO"),g=t("SRtI"),N=t("TSpG"),T=t("HKB3"),A=t("+352"),b=t("3ike");const m={INITIATE_SPA_CLOSE:"INITIATE_SPA_CLOSE",START_EDITION_POLLING:"START_EDITION_POLLING",FINISH_EDITION_POLLING:"FINISH_EDITION_POLLING",VIEWED_UPFLOW_ADMIN_SCREEN:"VIEWED_UPFLOW_ADMIN_SCREEN",SPA_READY:"SPA_READY"},L={SUCCESS:"SUCCESS",ERROR:"ERROR"},S=e=>{if(e===A.c||e===A.f){return{withBlanket:!1,withLoader:!1,modalElement:(()=>{const e=document.createElement("div");return e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.padding="0",e.style.margin="0",e.style.height="100%",e.style.width="100%",e.style.display="none",e.style.background="transparent",e.style.justifyContent="center",e.style.alignItems="center",e.style.zIndex=3005..toString(),e})()}}return{withBlanket:!0,withLoader:!0}},R=({currentEdition:e,targetEdition:n,cloudId:t,product:a,flow:i,touchpointId:d,canChangeEdition:l,epMessageId:f,onClose:R=r.a,onOpen:C=r.a,onCoordinationStart:D=r.a,coordinationClient:h,isExperienceTrackerEnabled:w=!1,flags:P,intl:{locale:j},subRoute:y=""})=>{const{cohort:G,fireExposureEvent:U}=Object(E.a)(N.a.IN_CONTEXT_MODAL_PRICING,T.b,T.a.NOT_ENROLLED),M=G===T.a.EXPERIMENT,F=(v={cloudId:t,flow:i,product:a,currentEdition:e?e.toLowerCase():void 0,targetEdition:n.toLowerCase(),touchpointId:d,locale:j,canChangeEdition:l,showPricing:M},Object.keys(v).filter(e=>void 0!==v[e]).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(v[e])}`).join("&"));var v;Object(c.useEffect)(()=>{k()},[]);const k=async()=>{const e=await h.start(f);if(f===A.o||f===A.j)x();else if(e){!1!==await D()?x():h.stop(f)}},x=()=>{const t=document.createElement("div");document.body.style.overflow="hidden",document.body.appendChild(t);const a=S(y),r=new s.b(Object(o.a)({src:`/gpa-up-flow/?${F}#/${y}`,appName:"upFlowSpa",withFullscreen:!0,modalZIndex:3005,pollingThresholdMilliSeconds:5e3},a));r.init({containerElement:t}),r.on(s.a.Message,c=>{switch(c.type){case m.INITIATE_SPA_CLOSE:if(r.cleanup(),u.a.unmountComponentAtNode(t),document.body.removeChild(t),document.body.style.overflow="auto",R(),h.stop(f),w){const t={name:_.a.UPSELL_EDITION,attributes:{currentEdition:e,targetEdition:n,upFlowVariateFlag:T.a.EXPERIMENT}};c.editionChanged?Object(O.b)().succeed(t):Object(O.b)().abort(Object(o.a)(Object(o.a)({},t),{},{reason:c.type}))}if(c.flagType){const{flagType:e,title:n,description:t}=c;((e,n,t)=>{e===L.SUCCESS?(p.a.setItem(g.b.GROWTH_EXPERIMENT_REQUEST_UPGRADE_SENT,"true"),P.showSuccessFlag({title:n,description:t})):e===L.ERROR&&P.showErrorFlag({title:n,description:t})})(e,n,t)}(c.reloadWindow||c.editionChanged)&&window.location.reload();break;case m.START_EDITION_POLLING:(async n=>{try{const t=await Object(b.a)(e);n.postMessage({type:m.FINISH_EDITION_POLLING,edition:t})}catch(t){n.postMessage({type:m.FINISH_EDITION_POLLING,error:t instanceof Error?t.message:"Edition polling failed"}),w&&Object(O.c)(_.a.UPSELL_EDITION,t)}})(r);break;case m.VIEWED_UPFLOW_ADMIN_SCREEN:U();break;case m.SPA_READY:C(c),a.modalElement&&(a.modalElement.style.display="flex")}}),r.on(s.a.AnalyticEvent,e=>{const n=Object(s.d)(e);n&&Object(I.getAnalyticsWebClient)().then(e=>{Object(s.c)(e)(n)})})};return null},C=Object(d.g)(Object(f.a)(Object(l.a)(R)))},HKB3:function(e,n,t){"use strict";t.d(n,"a",(function(){return r})),t.d(n,"c",(function(){return c})),t.d(n,"d",(function(){return i})),t.d(n,"b",(function(){return u}));var o=t("Kttv"),a=t.n(o);let r;!function(e){e.ENROLLED="enrolled",e.NOT_ENROLLED="not-enrolled",e.CONTROL="control",e.EXPERIMENT="experiment"}(r||(r={}));const c=(e,n,t)=>e.getVariantValue(n,{default:r.NOT_ENROLLED,oneOf:[r.EXPERIMENT,r.NOT_ENROLLED,r.CONTROL,r.ENROLLED],shouldTrackExposureEvent:t}),i=e=>parseInt(a()(e).substring(0,7),16)%100<20,u=Object.keys(r).map(e=>r[e])},"T+Mg":function(e,n,t){"use strict";t.d(n,"a",(function(){return d}));var o=t("Czhu"),a=t("zjfJ"),r=t("ERkP"),c=t.n(r),i=t("lZoD"),u=t("qhEF");function d(e){var n,t;return t=n=class extends r.Component{render(){return c.a.createElement(i.c,{to:[u.a]},n=>c.a.createElement(e,Object(o.a)(Object(o.a)({},this.props),{},{flags:n})))}},Object(a.a)(n,"displayName",`withFlags(${e.displayName||e.name})`),t}},TSpG:function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));const o={IN_CONTEXT_MODAL:"confluence.frontend.growth.experiments.incontext.modal.upgrade",END_USER_REQUEST:"confluence.frontend.growth.experiments.request.upgrade",IN_CONTEXT_MODAL_PRICING:"confluence.frontend.growth.experiments.incontext.modal.upgrade.with.price",ENGAGED_ADMINS:"confluence.frontend.growth.experiments.engaged.upgrade",ENGAGED_BILLING:"confluence.frontend.growth.experiments.engaged.billing",ENHANCED_FEATURE_GATES:"confluence.frontend.growth.experiments.enhanced.feature.gates",PERSISTENT_UPGRADE:"confluence.frontend.growth.experiments.persistent.upgrade",ACCOUNT_SETUP:"confluence.frontend.onboarding.account.setup",QUICKSTART:"confluence.frontend.onboarding.quickstart",ONBOARDING_NUDGE:"confluence.frontend.onboarding.nudges",AUTOSHOW_NUDGES:"confluence.frontend.onboarding.autoshow.nudges",LAND_IN_SPACE_OVERVIEW:"confluence.frontend.onboarding.land.in.space.overview",ONBOARDING_EXP_FLAG:"confluence.frontend.onboarding.experience",ONBOARDING_BANNER:"confluence.frontend.onboarding.banner",ONBOARDING_ANIMATED_MODAL_FLAG:"confluence.frontend.onboarding.spotlights.modal.animation",ONBOARDING_STATE_UPDATE_FLAG:"confluence.frontend.onboarding.state.update",ANYONE_CAN_INVITE_FLAG_KEY:"confluence.frontend.anyone.can.invite.free.sites",NUX_EXAMPLE_EMAIL_PLACEHOLDER:"confluence.frontend.show.email.placeholder",NEW_PAGE_LAYOUT_FF:"confluence.frontend.app-navigation.new-layout",SKIP_JSW_ONBOARDING_CHECK:"confluence.frontend.skip.check.for.jsw.onboarding.experiment",SWITCHER_JOINABLE_PRODUCTS_FF:"confluence.frontend.enable.joinable-products",SHARE_TO_SLACK_FF:"confluence.frontend.growth.middy.cohort",ONBOARDING_QUICKSTART_GSYNC_FLAG:"confluence.frontend.growth.experiments.gsync.enabled",ONBOARDING_QUICKSTART_INVITEE_LIST_FLAG:"confluence.frontend.growth.experiments.invitee-list.enabled",THIRD_PARTY_INVITES:"confluence.frontend.invite.from.integrations",NTH_USER_QUICKSTART:"confluence.frontend.onboarding.nth.user.quickstart"}},"Uo/y":function(e,n,t){"use strict";t.d(n,"a",(function(){return o}));const o=e=>{let n=!0,t=!0;return e&&(n=-1!==e.toLowerCase().indexOf("en",0)),navigator&&(t=navigator.language.includes("en")),t&&n}},cphC:function(e,n,t){"use strict";t.d(n,"a",(function(){return E}));var o=t("Czhu"),a=t("zjfJ"),r=t("ERkP"),c=t.n(r),i=t("fYnN"),u=t.n(i),d=t("C+A9"),l=t("KIs4");const s=()=>{};function E(e){var n,t;return t=n=class extends r.Component{constructor(...e){super(...e),Object(a.a)(this,"isEngagementDisabledForTests",Boolean(u.a.get("confluence.disable-engagement-for-tests")))}render(){return c.a.createElement(l.a,null,({cloudId:n})=>{const t=this.isEngagementDisabledForTests?{start:s,stop:s}:new d.a(n,"/gateway/api");return c.a.createElement(e,Object(o.a)(Object(o.a)({},this.props),{},{coordinationClient:t}))})}},Object(a.a)(n,"displayName",`withCoordinationClient(${e.displayName||e.name})`),t}},mvtW:function(e,n,t){"use strict";let o;t.d(n,"a",(function(){return o})),function(e){e.FREE="FREE",e.PREMIUM="PREMIUM",e.STANDARD="STANDARD"}(o||(o={}))}}]);
//# sourceMappingURL=growth.upgrade.admin.modal~0ae2caf4.Anbyc3GsyQ.js.map