<h1 id="week-10-learning-objectives">Week 10 Learning Objectives</h1>
<h2 id="rdbms-and-database-entity-objectives">RDBMS And Database Entity Objectives</h2>
<h3 id="define-what-a-relational-database-management-system-is">Define what a relational database management system is</h3>
<ul>
<li>software that manages a database ### Describe what relational data is</li>
<li>relational data is structured information with defined relationships between items</li>
<li>data is stored in tables, and tables can be linked together ### Define what a database is</li>
<li>a database is a collection of structured data that the RDBMS manages for you ### Define what a database table is</li>
<li>the entities that actually hold the data—consists of columns and rows ### Describe the purpose of a primary key</li>
<li>a primary key is the unique identifier for each row in a table ### Describe the purpose of a foreign key</li>
<li>a foreign key links two tables together—it identifies the corresponding uniquely identified row in a different table ### Describe how to properly name things in PostgreSQL</li>
<li>names should consist of lowercase letters, numbers, and underscores ### Install and configure PostgreSQL 12, its client tools, and a GUI client for it named Postbird ### Connect to an instance of PostgreSQL with the command line tool <code>psql</code></li>
</ul>
<pre><code>psql -U &lt;username&gt; postgres</code></pre>
<h3 id="identify-whether-a-user-is-a-normal-user-or-a-superuser-by-the-prompt-in-the-psql-shell">Identify whether a user is a normal user or a superuser by the prompt in the <code>psql</code> shell</h3>
<ul>
<li>prompt for a superuser ends with<code>#</code></li>
<li>prompt for a regular user ends with <code>&gt;</code> ### Create a user for the relational database management system</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">create</span> <span class="fu">user</span> <span class="op">&lt;</span>username<span class="op">&gt;</span> <span class="kw">with</span> <span class="kw">password</span> <span class="st">&#39;password&#39;</span>;</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">create</span> <span class="fu">user</span> <span class="op">&lt;</span>username<span class="op">&gt;</span> <span class="kw">with</span> superuser <span class="kw">password</span> <span class="st">&#39;password&#39;</span>;</a></code></pre></div>
<h3 id="create-a-database-in-the-database-management-system">Create a database in the database management system</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">create</span> <span class="kw">database</span> <span class="op">&lt;</span>databasename<span class="op">&gt;</span> <span class="kw">with</span> owner <span class="op">&lt;</span>owner<span class="op">&gt;</span></a></code></pre></div>
<h3 id="configure-a-database-so-that-only-the-owner-and-superusers-can-connect-to-it">Configure a database so that only the owner (and superusers) can connect to it</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">revoke</span> <span class="kw">connect</span> <span class="kw">on</span> <span class="kw">database</span> <span class="op">&lt;</span>databasename<span class="op">&gt;</span> <span class="kw">from</span> <span class="kw">public</span>;</a></code></pre></div>
<h3 id="view-a-list-of-databases-in-an-installation-of-postgresql">View a list of databases in an installation of PostgreSQL</h3>
<ul>
<li><code>\list</code> ### Create tables in a database</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">create</span> <span class="kw">table</span> <span class="op">&lt;</span>tablename<span class="op">&gt;</span> (</a>
<a class="sourceLine" id="cb5-2" title="2">    <span class="kw">id</span> serial <span class="kw">primary</span> <span class="kw">key</span>,</a>
<a class="sourceLine" id="cb5-3" title="3">    string_data <span class="dt">varchar</span>(<span class="dv">50</span>) <span class="kw">not</span> <span class="kw">null</span>,</a>
<a class="sourceLine" id="cb5-4" title="4">    integer_data <span class="dt">integer</span> <span class="kw">not</span> <span class="kw">null</span>,</a>
<a class="sourceLine" id="cb5-5" title="5">    decimal_data <span class="dt">numeric</span>(<span class="dv">2</span>, <span class="dv">1</span>) <span class="kw">not</span> <span class="kw">null</span></a>
<a class="sourceLine" id="cb5-6" title="6">)</a></code></pre></div>
<h3 id="view-a-list-of-tables-in-a-database">View a list of tables in a database</h3>
<ul>
<li><code>\dt</code> ### Identify and describe the common data types used in PostgreSQL</li>
<li><code>varchar(&lt;max number of characters&gt;)</code>: a string with a character limit</li>
<li><code>text</code>: a string with no character limit (but will behave more slowly—only use if necessary)</li>
<li><code>integer</code>: an integer</li>
<li><code>numeric(&lt;total digits&gt;, &lt;digits after decimal&gt;)</code> ### Describe the purpose of the <code>UNIQUE</code> and <code>NOT NULL</code> constraints, and create columns in database tables that have them</li>
<li>unique: no repeated values</li>
<li>not null: cannot be left blank ### Create a primary key for a table</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">id</span> serial</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="kw">primary</span> <span class="kw">key</span> (<span class="kw">id</span>)</a></code></pre></div>
<h3 id="create-foreign-key-constraints-to-relate-tables">Create foreign key constraints to relate tables</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">foreign</span> <span class="kw">key</span> (person_id) <span class="kw">references</span> people (<span class="kw">id</span>)</a></code></pre></div>
<h3 id="explain-that-sql-is-not-case-sensitive-for-its-keywords-but-is-for-its-entity-names">Explain that SQL is not case sensitive for its keywords but is for its entity names</h3>
<ul>
<li>sql is not case sensitive for its keywords (but be consistent in your own code). (e.g.<code>select</code> is interchangeable with <code>SELECT</code>), however, labels, id, etc will all be case-sensitive</li>
</ul>
<h2 id="sql-objectives">SQL objectives</h2>
<h3 id="how-to-use-the-select-...-from-...-statement-to-select-data-from-a-single-table">How to use the <code>SELECT ... FROM ...</code> statement to select data from a single table</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">select</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">from</span> puppies;</a></code></pre></div>
<h3 id="how-to-use-the-where-clause-on-select-update-and-delete-statements-to-narrow-the-scope-of-the-command">How to use the <code>WHERE</code> clause on <code>SELECT</code>, <code>UPDATE</code>, and <code>DELETE</code> statements to narrow the scope of the command</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">select</span> dog_name, breed</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">from</span> puppies</a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">where</span> microchipped <span class="op">=</span> <span class="kw">true</span>;</a>
<a class="sourceLine" id="cb9-4" title="4"></a>
<a class="sourceLine" id="cb9-5" title="5"><span class="kw">select</span> dog_name, age_yrs</a>
<a class="sourceLine" id="cb9-6" title="6"><span class="kw">from</span> puppies</a>
<a class="sourceLine" id="cb9-7" title="7"><span class="kw">where</span> age_yrs <span class="kw">between</span> <span class="dv">0</span> <span class="kw">and</span> <span class="fl">0.6</span>;</a>
<a class="sourceLine" id="cb9-8" title="8"></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="kw">select</span> dog_name, age_yrs</a>
<a class="sourceLine" id="cb9-10" title="10"><span class="kw">from</span> puppies</a>
<a class="sourceLine" id="cb9-11" title="11"><span class="kw">order</span> <span class="kw">by</span> age_yrs <span class="kw">desc</span>;</a>
<a class="sourceLine" id="cb9-12" title="12"></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="kw">select</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="kw">from</span> puppies</a>
<a class="sourceLine" id="cb9-15" title="15"><span class="kw">where</span> breed <span class="kw">in</span> (<span class="st">&#39;Corgi&#39;</span>, <span class="st">&#39;Beagle&#39;</span>);</a></code></pre></div>
<h3 id="how-to-use-the-join-keyword-to-join-two-or-more-tables-together-into-a-single-virtual-table">How to use the <code>JOIN</code> keyword to join two (or more) tables together into a single virtual table</h3>
<ul>
<li>types of joins:
<ul>
<li><code>INNER JOIN</code>: returns results for rows that are present in both tables</li>
<li><code>LEFT JOIN</code> or <code>LEFT OUTER JOIN</code>: returns results for every row in the left table, along with the corresponding values from the right table, with null values if there is no matching row in the right table</li>
<li><code>RIGHT JOIN</code> or <code>RIGHT OUTER JOIN</code>: returns results for every row in the right table, along with the corresponding values from the left table, with null values if there is no matching row in the left table</li>
<li><code>FULL JOIN</code> or <code>FULL OUTER JOIN</code>: returns results for every record in either table. null values will appear for any record with no corresponding record in the other table</li>
<li>self join is not a command in itself (i think?)—it just refers to using a join statement to join a table to itself. it can be useful when a relationship exists between rows in a single table—when the table references itself—and you want to collect that data into a single row</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">select</span> <span class="op">*</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">from</span> puppies</a>
<a class="sourceLine" id="cb10-3" title="3"><span class="kw">inner</span> <span class="kw">join</span> breeds</a>
<a class="sourceLine" id="cb10-4" title="4"><span class="kw">on</span> (puppies.breed_id <span class="op">=</span> breeds.<span class="kw">id</span>)</a></code></pre></div>
<h3 id="how-to-use-the-insert-statement-to-insert-data-into-a-table">How to use the <code>INSERT</code> statement to insert data into a table</h3>
```sql insert into table_name values (column1_value, colum2_value, column3_value);</li>
</ul>
<p>insert into table_name (col4, col5) values (‘col4_val’, ‘col5_val’), (‘col4_val’, ‘col5_val’);</p>
<p>– if you use SERIAL pseudo-type to auto-increment the ID values – simply write DEFAULT for the ID values when inserting new table rows. <code>### How to use an `UPDATE` statement to update data in a table</code>sql update owners set first_name = ‘grady’, last_name = ‘booch’ where id = 3;</p>
<p>– double pipes does string concatenation! update pets set name = name || ’ (old timer)’ where age &gt; 10; <code>### How to use a `DELETE` statement to remove data from a table</code>sql – doesn’t throw an error if there’s no animal delete from pets where id = 9;</p>
<p>– you can’t delete records if there is some other foreign key relationship – that depends on it</p>
<pre><code>### How to use a seed file to populate data in a database</code></pre>
<p>psql -d [database] &lt; [path_to_file/file.sql] cat [path_to_file/file.sql] | psql -d [database] <code>### How to perform relational database design - schemas let us easily visualize database tables and their relationship to each other - four major steps:     1. Define the purpose/entities of the relational DB.         - establish purpose, entities (tables), and attributes (i.e. columns and rows)     1. Identify primary keys.         - select columns to contain the unique values that will serve as primary keys for each table     1. Establish table relationships.         - one-to-one: one record in table A will be associated with a single record in table B (e.g. associating each product in a products table with a description in a product_descriptions table)         - one-to-many: one record in table A will be associated with multiple records in table B (e.g associating a user in a users table with multiple orders in an orders table)         - many-to-many: multiple records in table A could be associated with multiple records in table b (e.g. a products table and an orders table—a single order may contain multiple products, and a single product may be ordered multiple times). a join table which contains primary keys from both tables will typically be used to organize these relationships     1. Apply normalization rules.         - first normal form rules:             - eliminate repeating groups in individual tables.             - create a separate table for each set of related data.             - identify each set of related data with a primary key.         - second normal form rules:             - create separate tables for sets of values that apply to multiple records.             - relate these tables with a foreign key.         - third normal form rules:             - eliminate fields that do not depend on the table’s key. ### How to use transactions to group multiple SQL commands into one succeed or fail operation - a transaction bundles multiple steps into a single, all-or-nothing operation     - `BEGIN`: initiates a transaction block     - `COMMIT`: commits the current transaction     - `ROLLBACK`: causes all the updates made by the current transaction to be discarded (since the last `COMMIT` or `ROLLBACK`)     - `SAVEPOINT` establishes a new save point within current transaction     - `SET TRANSACTION`: sets characteristics of current transaction (e.g. `READ ONLY`) - transactions are useful when altering the contents of a database (insertions, updates, deletions), but not for simple `SELECT` queries - transactions are "**ACID**"     - **A**tomicity: changes are performed all-or-none     - **C**onsistency: data is in an internally consistent state at start and end     - **I**solation: intermediate state is invisible to other transactions     - **D**urability: after successful transaction, any changes persist even in the event of a system failure</code>sql BEGIN; UPDATE accounts SET balance = balance - 100.00 WHERE name = ‘Alice’; UPDATE branches SET balance = balance - 100.00 WHERE name = (SELECT branch_name FROM accounts WHERE name = ‘Alice’); UPDATE accounts SET balance = balance + 100.00 WHERE name = ‘Bob’; UPDATE branches SET balance = balance + 100.00 WHERE name = (SELECT branch_name FROM accounts WHERE name = ‘Bob’); COMMIT; <code>### How to apply indexes to tables to improve performance - indexes can improve database performance (in some cases) by changing the organization of the data on the disk. this can allow faster read times, although it can also slow down insertion and updates     - bad for small tables, tables with frequent/large updates, many null values, frequently manipulated columns</code>sql CREATE INDEX index_name ON table_name (column_name);</p>
<p>– multicolumn index CREATE INDEX index_name ON table_name (col1_name, col2_name);</p>
<p>– partial index CREATE INDEX index_name ON table_name WHERE (conditional_expression); <code>### Explain what and why someone would use `EXPLAIN` - `EXPLAIN` can be used to analyze performance and debug slow queries ### Demonstrate how to install and use the node-postgres library and its `Pool` class to query a PostgreSQL-managed database</code>javascript const { Pool } = require(‘pg’);</p>
<p>const pool = new Pool({ user: ‘application_user’, password: ‘iy7qTEcZ’, });</p>
<p>const results = await pool.query(<code>SELECT id, name, age_yrs   FROM puppies;</code>);</p>
<p>console.log(results); <code>### Explain how to write prepared statements with placeholders for parameters of the form "$1", "$2", and so on - each of the `$` placeholders is a positional argument for the parameters you pass in</code>sql INSERT INTO puppies (name, age_yrs, breed, weight_lbs, microchipped) VALUES ($1, $2, $3, $4, $5); <code></code>javascript await pool.query(<code>INSERT INTO puppies (name, age_yrs, breed, weight_lbs, microchipped)   VALUES ($1, $2, $3, $4, $5);</code>, [name, age, breedName, weight, isMicrochipped]); ```</p>
<h2 id="orm-objectives">ORM Objectives</h2>
<h3 id="how-to-install-configure-and-use-sequelize-an-orm-for-javascript">How to install, configure, and use Sequelize, an ORM for JavaScript</h3>
<ul>
<li>important functions:
<ul>
<li><code>.save</code></li>
<li><code>.associate</code></li>
<li><code>.findByPk</code></li>
</ul></li>
<li>WALKTHROUGH:</li>
<li>specify tables without dependencies first, then specify tables whose dependendencies are met, continue until all tables are specified</li>
<li>create user first in postgres <code>create user username with createdb password 'password';</code></li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode zsh"><code class="sourceCode zsh"><a class="sourceLine" id="cb12-1" title="1"><span class="co"># install sequelize</span></a>
<a class="sourceLine" id="cb12-2" title="2">npm <span class="kw">install</span> sequelize@^5.0.0</a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co"># install sequelize-cli, which auto-generates and manages js files</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co"># to hold sequelize ORM code</span></a>
<a class="sourceLine" id="cb12-5" title="5">npm <span class="kw">install</span> sequelize-cli@^5.0.0</a>
<a class="sourceLine" id="cb12-6" title="6"><span class="co"># pg library allows sequelize to access postgres database</span></a>
<a class="sourceLine" id="cb12-7" title="7">npm <span class="kw">install</span> pg@^8.0.0</a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co"># setup with script from sequelize-cli</span></a>
<a class="sourceLine" id="cb12-9" title="9">npx sequelize init</a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co"># which creates this structure:</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co"># .</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co"># ├── config</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="co"># │   └── config.json</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="co"># ├── migrations</span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="co"># ├── models</span></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="co"># │   └── index.js</span></a>
<a class="sourceLine" id="cb12-17" title="17"><span class="co"># ├── node_modules</span></a>
<a class="sourceLine" id="cb12-18" title="18"><span class="co"># ├── package-lock.json</span></a>
<a class="sourceLine" id="cb12-19" title="19"><span class="co"># ├── package.json</span></a>
<a class="sourceLine" id="cb12-20" title="20"><span class="co"># └── seeders</span></a></code></pre></div>
<ul>
<li>in <strong>config.json</strong> file
<ul>
<li>change all usernames &amp; passwords to the one created earlier, and databases to intended database name</li>
<li>remove <code>"operatorsAliases": false</code> it’s outdated, and replace it with <code>"seederStorage": "sequelize"</code> which keeps track of seed files as they run</li>
<li>set <code>"dialect": "postgres"</code></li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode zsh"><code class="sourceCode zsh"><a class="sourceLine" id="cb13-1" title="1"><span class="co"># create empty database</span></a>
<a class="sourceLine" id="cb13-2" title="2">npx sequelize-cli db:create</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="co"># generate a model—creates a model file and a migration file</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="co"># the `type:string` refers to the type of PetType, not the type of data?</span></a>
<a class="sourceLine" id="cb13-5" title="5">npx sequelize-cli model:generate --name PetType --attributes type:string</a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="co">// migrations/#-create-pet-type.js</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="st">&#39;use strict&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="dt">up</span><span class="op">:</span> (queryInterface<span class="op">,</span> Sequelize) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-5" title="5">  <span class="cf">return</span> <span class="va">queryInterface</span>.<span class="at">createTable</span>(<span class="st">&#39;PetTypes&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-6" title="6">      <span class="dt">id</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-7" title="7">          <span class="dt">allowNull</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-8" title="8">          <span class="dt">autoIncrement</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-9" title="9">          <span class="dt">primaryKey</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-10" title="10">          <span class="dt">type</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">INTEGER</span></a>
<a class="sourceLine" id="cb14-11" title="11">      <span class="op">},</span></a>
<a class="sourceLine" id="cb14-12" title="12">      <span class="dt">firstName</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-13" title="13">          <span class="dt">allowNull</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-14" title="14">          <span class="dt">type</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span>(<span class="dv">50</span>)</a>
<a class="sourceLine" id="cb14-15" title="15">      <span class="op">},</span></a>
<a class="sourceLine" id="cb14-16" title="16">      <span class="dt">specialSkill</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-17" title="17">          <span class="dt">type</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span></a>
<a class="sourceLine" id="cb14-18" title="18">      <span class="op">},</span></a>
<a class="sourceLine" id="cb14-19" title="19">      <span class="dt">createdAt</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-20" title="20">          <span class="dt">allowNull</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-21" title="21">          <span class="dt">type</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">DATE</span></a>
<a class="sourceLine" id="cb14-22" title="22">      <span class="op">},</span></a>
<a class="sourceLine" id="cb14-23" title="23">      <span class="dt">updatedAt</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-24" title="24">          <span class="dt">allowNull</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-25" title="25">          <span class="dt">type</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">DATE</span></a>
<a class="sourceLine" id="cb14-26" title="26">      <span class="op">}</span></a>
<a class="sourceLine" id="cb14-27" title="27">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb14-28" title="28"><span class="op">},</span></a>
<a class="sourceLine" id="cb14-29" title="29"><span class="dt">down</span><span class="op">:</span> (queryInterface<span class="op">,</span> Sequelize) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb14-30" title="30">    <span class="cf">return</span> <span class="va">queryInterface</span>.<span class="at">dropTable</span>(<span class="st">&#39;PetTypes&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb14-31" title="31"><span class="op">}</span></a>
<a class="sourceLine" id="cb14-32" title="32"><span class="op">};</span></a></code></pre></div></li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode zsh"><code class="sourceCode zsh"><a class="sourceLine" id="cb15-1" title="1">npx sequelize-cli db:migrate</a></code></pre></div>
<ul>
<li>the pettype.js file in the models folder is the one we’ll use when running javascript
<ul>
<li>add a validation to the models file—if you have a column that in sql is “not null” add <code>validate: { notEmpty: true}</code></li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="co">// models/pettype.js</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="st">&#39;use strict&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> (sequelize<span class="op">,</span> DataTypes) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="kw">const</span> PetType <span class="op">=</span> <span class="va">sequelize</span>.<span class="at">define</span>(<span class="st">&#39;Cat&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-5" title="5">  <span class="dt">type</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-6" title="6">      <span class="dt">type</span><span class="op">:</span> <span class="va">DataTypes</span>.<span class="at">STRING</span><span class="op">,</span></a>
<a class="sourceLine" id="cb16-7" title="7">      <span class="dt">validate</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-8" title="8">          <span class="dt">notEmpty</span><span class="op">:</span> <span class="kw">true</span></a>
<a class="sourceLine" id="cb16-9" title="9">      <span class="op">}</span></a>
<a class="sourceLine" id="cb16-10" title="10">  <span class="op">}</span></a>
<a class="sourceLine" id="cb16-11" title="11"><span class="op">},</span> <span class="op">{}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-12" title="12"><span class="va">PetType</span>.<span class="at">associate</span> <span class="op">=</span> <span class="kw">function</span>(models) <span class="op">{</span></a>
<a class="sourceLine" id="cb16-13" title="13">  <span class="co">// associations can be defined here</span></a>
<a class="sourceLine" id="cb16-14" title="14"><span class="op">};</span></a>
<a class="sourceLine" id="cb16-15" title="15"><span class="cf">return</span> PetType<span class="op">;</span></a>
<a class="sourceLine" id="cb16-16" title="16"><span class="op">};</span></a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode zsh"><code class="sourceCode zsh"><a class="sourceLine" id="cb17-1" title="1">npx sequelize-cli model:generate <span class="kw">\</span></a>
<a class="sourceLine" id="cb17-2" title="2">--name Owner <span class="kw">\</span></a>
<a class="sourceLine" id="cb17-3" title="3">--attributes firstName:string,lastName:string</a></code></pre></div></li>
</ul>
<div class="sourceCode" id="cb18"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1"><span class="co">// migrations/#-create-owner.js</span></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="st">&#39;use strict&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="dt">up</span><span class="op">:</span> (queryInterface<span class="op">,</span> Sequelize) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-5" title="5">    <span class="cf">return</span> <span class="va">queryInterface</span>.<span class="at">createTable</span>(<span class="st">&#39;Owners&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-6" title="6">        <span class="dt">id</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-7" title="7">            <span class="dt">allowNull</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-8" title="8">            <span class="dt">autoIncrement</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-9" title="9">            <span class="dt">primaryKey</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-10" title="10">            <span class="dt">type</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">INTEGER</span></a>
<a class="sourceLine" id="cb18-11" title="11">        <span class="op">},</span></a>
<a class="sourceLine" id="cb18-12" title="12">        <span class="dt">firstName</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-13" title="13">            <span class="dt">allowNull</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-14" title="14">            <span class="dt">type</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span>(<span class="dv">50</span>)</a>
<a class="sourceLine" id="cb18-15" title="15">        <span class="op">},</span></a>
<a class="sourceLine" id="cb18-16" title="16">        <span class="dt">lastName</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-17" title="17">            <span class="dt">allowNull</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-18" title="18">            <span class="dt">type</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">STRING</span>(<span class="dv">50</span>)</a>
<a class="sourceLine" id="cb18-19" title="19">        <span class="op">},</span></a>
<a class="sourceLine" id="cb18-20" title="20">        <span class="dt">createdAt</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-21" title="21">            <span class="dt">allowNull</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-22" title="22">            <span class="dt">type</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">DATE</span></a>
<a class="sourceLine" id="cb18-23" title="23">        <span class="op">},</span></a>
<a class="sourceLine" id="cb18-24" title="24">        <span class="dt">updatedAt</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-25" title="25">            <span class="dt">allowNull</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-26" title="26">            <span class="dt">type</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="at">DATE</span></a>
<a class="sourceLine" id="cb18-27" title="27">        <span class="op">}</span></a>
<a class="sourceLine" id="cb18-28" title="28">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-29" title="29"><span class="op">},</span></a>
<a class="sourceLine" id="cb18-30" title="30"><span class="dt">down</span><span class="op">:</span> (queryInterface<span class="op">,</span> Sequelize) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-31" title="31">      <span class="cf">return</span> <span class="va">queryInterface</span>.<span class="at">dropTable</span>(<span class="st">&#39;Owners&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-32" title="32">  <span class="op">}</span></a>
<a class="sourceLine" id="cb18-33" title="33"><span class="op">};</span></a>
<a class="sourceLine" id="cb18-34" title="34"><span class="va">module</span>.<span class="at">exports</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-35" title="35">  <span class="dt">up</span><span class="op">:</span> (queryInterface<span class="op">,</span> Sequelize) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-36" title="36">    <span class="cf">return</span> <span class="va">queryInterface</span>.<span class="at">createTable</span>(<span class="st">&#39;Person&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-37" title="37">      <span class="dt">name</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="va">DataTypes</span>.<span class="at">STRING</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-38" title="38">      <span class="dt">isBetaMember</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-39" title="39">        <span class="dt">type</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="va">DataTypes</span>.<span class="at">BOOLEAN</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-40" title="40">        <span class="dt">defaultValue</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-41" title="41">        <span class="dt">allowNull</span><span class="op">:</span> <span class="kw">false</span></a>
<a class="sourceLine" id="cb18-42" title="42">      <span class="op">},</span></a>
<a class="sourceLine" id="cb18-43" title="43">      <span class="dt">userId</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-44" title="44">        <span class="dt">type</span><span class="op">:</span> <span class="va">Sequelize</span>.<span class="va">DataTypes</span>.<span class="at">INTEGER</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-45" title="45">        <span class="dt">references</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-46" title="46">          <span class="dt">model</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-47" title="47">            <span class="dt">tableName</span><span class="op">:</span> <span class="st">&#39;users&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-48" title="48">            <span class="dt">schema</span><span class="op">:</span> <span class="st">&#39;schema&#39;</span></a>
<a class="sourceLine" id="cb18-49" title="49">          <span class="op">},</span></a>
<a class="sourceLine" id="cb18-50" title="50">          <span class="dt">key</span><span class="op">:</span> <span class="st">&#39;id&#39;</span></a>
<a class="sourceLine" id="cb18-51" title="51">        <span class="op">},</span></a>
<a class="sourceLine" id="cb18-52" title="52">        <span class="dt">allowNull</span><span class="op">:</span> <span class="kw">false</span></a>
<a class="sourceLine" id="cb18-53" title="53">      <span class="op">},</span></a>
<a class="sourceLine" id="cb18-54" title="54">    <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-55" title="55">  <span class="op">},</span></a>
<a class="sourceLine" id="cb18-56" title="56">  <span class="dt">down</span><span class="op">:</span> (queryInterface<span class="op">,</span> Sequelize) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb18-57" title="57">    <span class="cf">return</span> <span class="va">queryInterface</span>.<span class="at">dropTable</span>(<span class="st">&#39;Person&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-58" title="58">  <span class="op">}</span></a>
<a class="sourceLine" id="cb18-59" title="59"><span class="op">}</span></a></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode zsh"><code class="sourceCode zsh"><a class="sourceLine" id="cb19-1" title="1"><span class="co"># you can run this to undo a migration</span></a>
<a class="sourceLine" id="cb19-2" title="2">db:migrate:undo</a></code></pre></div>
<ul>
<li>do the same with the <strong>owners.js</strong> file in models</li>
<li>next generate model for pet table
<ul>
<li>that is pretty similar to creating others, but you also need to modify the migration file <strong>create-pet.js</strong> so that it has the relationship to PetTypes for it’s petTypeID column. add <code>references: { model: PetTypes}</code></li>
<li>you also need to modify the model files for both pet and pettype to include the association. in <strong>pet.js</strong>, in the <code>Pet.associate</code> function <code>Pet.belongsTo(models.PetType, {foreignKey: 'petTypeId'});</code>. in <strong>pettype.js</strong>, in <code>PetType.associate</code> <code>PetType.hasMany(models.Pet, { foreignKey: 'petTypeId'});</code></li>
</ul></li>
<li>if you want to set up a many-to-many relationship, it’s a little more complicated. still in the associate function, you use the <code>belongsToMany</code> with two parameters. first parameter is the <code>models.Table</code> (for the actual table you’re connecting to, not the intermediate join table), the second parameter is a column mapping (which you get from the join table)
<ul>
<li>the column mapping object in the <code>associate</code> function for the other table will be the opposite</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb20-1" title="1"><span class="va">Pet</span>.<span class="at">associate</span> <span class="op">=</span> <span class="kw">function</span>(models) <span class="op">{</span></a>
<a class="sourceLine" id="cb20-2" title="2">  <span class="co">// simple one-to-many relationship only requires a foreign key in the column mapping object</span></a>
<a class="sourceLine" id="cb20-3" title="3">  <span class="va">Pet</span>.<span class="at">belongsTo</span>(<span class="va">models</span>.<span class="at">PetType</span><span class="op">,</span> <span class="op">{</span><span class="dt">foreignKey</span><span class="op">:</span> <span class="st">&#39;petTypeId&#39;</span><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb20-4" title="4"></a>
<a class="sourceLine" id="cb20-5" title="5">  <span class="co">// this columnMapping object defines the many-to-many relationship</span></a>
<a class="sourceLine" id="cb20-6" title="6">  <span class="kw">const</span> columnMapping <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb20-7" title="7">      <span class="dt">through</span><span class="op">:</span> <span class="st">&#39;petOwner&#39;</span><span class="op">,</span> <span class="co">// join table</span></a>
<a class="sourceLine" id="cb20-8" title="8">      <span class="dt">otherKey</span><span class="op">:</span> <span class="st">&#39;ownerId&#39;</span><span class="op">,</span> <span class="co">// key from join table that points to the other entity</span></a>
<a class="sourceLine" id="cb20-9" title="9">      <span class="dt">foreignKey</span><span class="op">:</span> <span class="st">&#39;petId&#39;</span> <span class="co">// key from join table that points to this entity</span></a>
<a class="sourceLine" id="cb20-10" title="10">  <span class="op">}</span></a>
<a class="sourceLine" id="cb20-11" title="11"></a>
<a class="sourceLine" id="cb20-12" title="12">  <span class="co">// actually set the association</span></a>
<a class="sourceLine" id="cb20-13" title="13">  <span class="va">Pet</span>.<span class="at">belongsToMany</span>(<span class="va">models</span>.<span class="at">Owner</span><span class="op">,</span> columnMapping)</a>
<a class="sourceLine" id="cb20-14" title="14"><span class="op">};</span></a></code></pre></div>
<h3 id="how-to-use-database-migrations-to-make-your-database-grow-with-your-application-in-a-source-control-enabled-way">How to use database migrations to make your database grow with your application in a source-control enabled way</h3></li>
<li>migration files store sql schema change code permanently</li>
<li>relatedly this helps with collaberation: a coworker can setup their own copy of the database by running the migration files, so they wind up with the same schema</li>
<li><strong>never rollback migrations that have been run on a production server.</strong> ### How to perform CRUD operations with Sequelize</li>
<li><strong>C</strong>reate, <strong>R</strong>ead, <strong>U</strong>pdate, <strong>D</strong>estroy</li>
<li>create: use <code>build</code> method to add a row to database, then <code>save</code> to actually create the new record
<ul>
<li>or alternatively, call the <code>.create</code> ```javascript const { sequelize, Cat } = require(“./models”);</li>
</ul></li>
</ul>
<p>async function main() { const cat = Cat.build({ firstName: “Markov”, specialSkill: “sleeping”, age: 5, }); // This actually creates a new <code>Cats</code> record in the database. We must // wait for this asynchronous operation to succeed. await cat.save();</p>
<pre><code>console.log(cat.toJSON());

await sequelize.close();</code></pre>
<p>}</p>
<p>main();</p>
<p>// alternatively, worth noting you can also put a file into the seeders ‘use strict’;</p>
<p>module.exports = { up: (queryInterface, Sequelize) =&gt; { return queryInterface.bulkInsert(‘Users’, [{ firstName: ‘John’, lastName: ‘Doe’, email: ‘demo@demo.com’, createdAt: new Date(), updatedAt: new Date() }], {}); },</p>
<p>down: (queryInterface, Sequelize) =&gt; { return queryInterface.bulkDelete(‘Users’, null, {}); } }; <code>- read: get a record using, for example `findByPk` if you have primary key</code>javascript const { sequelize, Cat } = require(“./models”);</p>
<p>async function main() { // Fetch the cat with id #1. const cat = await Cat.findByPk(1); console.log(cat.toJSON());</p>
<p>await sequelize.close(); }</p>
<p>main(); <code>- update: fetch the record as you would for reading, then make changes to the javascript object, then use `save` to commit those changes to the database (don't forget `save` is asynchronous, so you have to `await` it before you close)</code>javascript const { sequelize, Cat } = require(“./models”);</p>
<p>async function main() { const cat = await Cat.findByPk(1);</p>
<p>console.log(“Old Markov:”); console.log(cat.toJSON());</p>
<p>// The Cat object is modified, but the corresponding record in the // database is <em>not</em> yet changed at all. cat.specialSkill = “super deep sleeping”; // Only by calling <code>save</code> will the data be saved. await cat.save();</p>
<p>console.log(“New Markov:”); console.log(cat.toJSON());</p>
<p>await sequelize.close(); }</p>
<p>main(); <code>- destroy: use the `destroy` function</code>javascript const process = require(“process”);</p>
<p>const { sequelize , Cat } = require(“./models”);</p>
<p>async function main() { // get cat const cat = await Cat.findByPk(1); // destroy it await cat.destroy();</p>
<p>// alternatively, <code>await Cat.destroy({ where: { id: [3,4,5] } });</code></p>
<p>await sequelize.close(); }</p>
<p>main(); <code>### How to query using Sequelize - use `findAll` to get all records     - use with parameter `{where: {attribute: "Value"}}` to filter results     - use with `Op` object to get not equal `[Op.ne]`, greater than `[Op.gt]`, many other things (like etc) - `findOne` will limit query to 1 - `findCreateFind</code>javascript const { sequelize, Cat } = require(“./models”);</p>
<p>async function main() { // Fetch all cats named Markov. const cats = await Cat.findAll({ where: { firstName: [“Markov”, “Curie”], }, }); console.log(JSON.stringify(cats, null, 2));</p>
<p>await sequelize.close(); }</p>
<p>main(); ```</p>
<h3 id="how-to-perform-data-validations-with-sequelize">How to perform data validations with Sequelize</h3>
<h3 id="how-to-use-transactions-with-sequelize">How to use transactions with Sequelize</h3>
<h2 id="professional-development-portfolio-quality">Professional Development: Portfolio Quality</h2>
<h3 id="recall-the-items-recruiters-are-most-interested">Recall the items recruiters are most interested</h3>
<h3 id="explain-the-aspects-of-good-looking-web-application">Explain the aspects of good looking Web application</h3>
<h3 id="identify-app-academys-expectations-of-your-projects-for-after-you-graduate">Identify App Academy’s expectations of your projects for after you graduate</h3>
<h3 id="practice-good-code-hygiene-when-making-projects-live">Practice good code hygiene when making projects live</h3>
