(window.webpackJsonp=window.webpackJsonp||[]).push([["dwell-time~493df0b3"],{"093b":function(e,t,a){"use strict";a.r(t);var s=a("Czhu"),r=a("zjfJ"),i=a("uDfI"),c=a("ERkP"),n=a.n(c),l=a("gQ5V"),o=a("kR5U"),d=a("bQlP"),u=a("Ua4J"),p=a("+mzV"),b=a("2wFc"),h=a("KIs4"),w=(a("aWzz"),a("r9hL")),m=a("lbXe"),T=a("DQZQ"),j=a("cGYM"),g=a("daKX"),I=a("CwyC"),O=a("d3tz"),D=a("3VMZ"),E=a("hpu0");const y=Object(g.a)("DwellTime:LastPageTracker");class P{constructor(){Object(r.a)(this,"onExperienceEvent",e=>{"taskSuccess"===e.action&&e.name===D.a.VIEW_PAGE&&(y.debug`dwell page loaded within ${e.duration} seconds`,this.onViewPageEnd(e))}),Object(r.a)(this,"onViewPageEnd",e=>{this.lastSuccessfulPage=e}),Object(r.a)(this,"getLastSuccessfulPage",()=>this.lastSuccessfulPage),this.experienceTracker=Object(E.b)(),this.unsubscribeFromExperienceTracker=null,this.lastSuccessfulPage=null}start(){this.unsubscribeFromExperienceTracker=this.experienceTracker.subscribe(this.onExperienceEvent)}stop(){this.unsubscribeFromExperienceTracker&&this.unsubscribeFromExperienceTracker()}}const S=Object(g.a)("DwellTime");class f extends c.Component{constructor(...e){super(...e),Object(r.a)(this,"onInitialLoad",()=>{this.startDwell()}),Object(r.a)(this,"onPageTransition",()=>{this.startDwell()}),Object(r.a)(this,"stripSearchIdFromUrl",()=>{const{getQueryParams:e,setQueryParams:t}=this.props,a=e().search_id;return a?(t({search_id:null},!0),a):null}),Object(r.a)(this,"sendGasV2",e=>{const t={dwellTime:e.attributes.dwellTime,finalDwellEvent:e.attributes.finalDwellEvent,searchReferrerId:Object(j.a)(e.attributes.searchReferrer),contentId:e.actionSubjectId};this.props.triggerAnalytics("dwell",t)}),Object(r.a)(this,"sendGasV3",e=>{!e.attributes.finalDwellEvent&&e.attributes.dwellTime<=6e4&&(e.attributes.navdexPointType=e.attributes.dwellTime<4e4?T.b.TOUCH:T.b.END);const t=this.adjustDuration(e);this.props.createAnalyticsEvent({type:"sendTrackEvent",data:t}).fire()}),Object(r.a)(this,"adjustDuration",e=>{const{lastPageTracker:t}=this.props,a=t.getLastSuccessfulPage();S.debug`lastPage ${a}`;const r=a&&a.id===e.objectId?e.attributes.dwellTime-a.duration:void 0,i=Object(s.a)(Object(s.a)({},e),{},{attributes:Object(s.a)(Object(s.a)({},e.attributes),{},{dwellTimeWithoutLoad:r})});return S.debug`adjusted dwell time ${r} for contentId ${e.objectId} instead of ${e.attributes.dwellTime}`,i}),Object(r.a)(this,"sendDwellEvent",e=>{this.sendGasV2(e),this.sendGasV3(e)})}componentDidMount(){this.props.isSearchAttributionEnabled&&this.onInitialLoad()}shouldComponentUpdate(e){return!e.contentIdLoading&&(this.props.spaceId!==e.spaceId||this.props.contentId!==e.contentId)}componentDidUpdate(){this.props.isSearchAttributionEnabled&&this.onPageTransition()}async componentWillUnmount(){(await Object(I.a)()).stop()}async startDwell(){const{isSpace:e,spaceId:t,contentId:a,useSearchIdQueryParam:s,searchSessionId:r}=this.props,i=await Object(I.a)(),c=s?this.stripSearchIdFromUrl():r;e?i.startSpace(t,this.sendDwellEvent,c):i.startPage(t,a,this.sendDwellEvent,c)}render(){return null}}var k=Object(m.a)()(Object(w.a)(O.a.VIEW_PAGE)(f)),v=a("H5qd");const H=a.n(v).a`query DwellTimeQuery($spaceKey:String){space(key:$spaceKey){id key}}`;class C extends c.Component{constructor(){super(),Object(r.a)(this,"spaceIdInData",e=>e&&e.space&&e.space.id),this.lastPageTracker=new P,this.lastPageTracker.start()}componentWillUnmount(){this.lastPageTracker.stop()}render(){return n.a.createElement(h.a,null,({featureFlags:e})=>n.a.createElement(u.a.Consumer,null,({getQueryParams:t,setQueryParams:a,location:r})=>n.a.createElement(p.a.Consumer,null,({spaceKey:i,contentId:c,contentIdLoading:o,searchSessionId:d})=>i&&c&&n.a.createElement(l.b,{query:H,variables:{spaceKey:i}},({data:i,loading:l})=>l||!this.spaceIdInData(i)?null:n.a.createElement(k,Object(s.a)(Object(s.a)({},this.props),{},{spaceId:i.space.id,contentId:c,contentIdLoading:o,getQueryParams:t,setQueryParams:a,isSpace:Object(b.r)(r),lastPageTracker:this.lastPageTracker,searchSessionId:d,useSearchIdQueryParam:!e["confluence.frontend.page-context.search-id"]}))))))}}t.default=Object(i.connect)(e=>({isSearchAttributionEnabled:Object(o.b)(e,d.B)}))(C)},CwyC:function(e,t,a){"use strict";var s=a("lSUb"),r=a("cld1"),i=a("zjfJ"),c=a("BX6b"),n=a("daKX");const l=Object(n.a)("DwellTimeTracker");class o{constructor(e){Object(i.a)(this,"provideDwellTimeHelper",void 0),Object(i.a)(this,"dwellTimeHelper",null),Object(i.a)(this,"dwellTimeCallback",null),Object(i.a)(this,"onDwell",e=>{this.dwellTimeCallback&&this.dwellTimeCallback(e)}),Object(i.a)(this,"getEventDataForPage",(e,t)=>({containerType:"space",containerId:e,objectType:"page",objectId:t,source:"page",actionSubject:"page",actionSubjectId:t})),Object(i.a)(this,"getEventDataForSpace",e=>({containerType:"space",containerId:e,source:"space",actionSubject:"space",actionSubjectId:e})),this.provideDwellTimeHelper=e}async startAny(e,t){this.startDwellTimeHelper(e,t)}async startPage(e,t,a,s){const r=this.getEventDataForPage(e,t);this.startDwellTimeHelper(r,a,s)}async startSpace(e,t,a){const s=this.getEventDataForSpace(e);this.startDwellTimeHelper(s,t,a)}stop(){this.dwellTimeHelper?this.dwellTimeHelper.stop():l.error`Dwell was stopped before it can get started`}async startDwellTimeHelper(e,t,a){try{this.dwellTimeHelper?this.dwellTimeHelper.newPage(e,a):(this.dwellTimeHelper=this.provideDwellTimeHelper(this.onDwell,e,a),this.dwellTimeHelper.stop(),this.dwellTimeHelper.start()),this.dwellTimeCallback=t}catch(s){throw l.error`Failed to start dwell time`,Object(c.c)().submitError(s,{attribution:"disco"}),s}}}a.d(t,"a",(function(){return d}));const d=Object(s.default)(async()=>{const e=await Object(r.getDwellTimeHelper)();return new o((t,a,s)=>new e(t,a,s))})}}]);
//# sourceMappingURL=dwell-time~493df0b3.RxwPXdvt9q.js.map