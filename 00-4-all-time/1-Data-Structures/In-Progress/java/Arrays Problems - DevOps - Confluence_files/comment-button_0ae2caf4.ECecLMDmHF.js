(window.webpackJsonp=window.webpackJsonp||[]).push([["comment-button~0ae2caf4"],{"3aa+":function(e,t,n){"use strict";n.r(t),n.d(t,"CommentButtonWrapper",(function(){return s}));var o=n("zjfJ"),i=n("ERkP"),a=n.n(i),c=n("lZoD"),r=n("cEjM"),l=n("EvV7"),m=n("hUqX");class s extends i.PureComponent{constructor(...e){super(...e),Object(o.a)(this,"isItemMarked",!1),Object(o.a)(this,"markItem",null),Object(o.a)(this,"buttonRendered",()=>{this.isItemMarked||(this.isItemMarked=!0,this.markItem(r.a.PAGE_COMMENTS))})}render(){const{contentId:e}=this.props;return a.a.createElement(c.c,{to:[l.a]},t=>(t.addItem(r.a.PAGE_COMMENTS),this.markItem=t.markItem,a.a.createElement(m.CommentButton,{contentId:e,onRender:this.buttonRendered,isAnimated:!1})))}}},"65Kk":function(e,t,n){e.exports=n.p+"7H6YRgqowH.gif"},LPS5:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n("H5qd");const i=n.n(o).a`query CommentButtonQuery($pageId:ID!){comments(pageId:$pageId type:UNRESOLVED depth:ALL){count nodes{id location{type ...on InlineComment{inlineMarkerRef}}}}}`},hUqX:function(e,t,n){"use strict";n.r(t),n.d(t,"INLINE_COMMENT_FRAMEWORK_FF",(function(){return x})),n.d(t,"VIEW_ALL_INLINE_COMMENTS_FF",(function(){return B})),n.d(t,"COMMENT_COUNT_FF",(function(){return D})),n.d(t,"AnimatedButton",(function(){return G})),n.d(t,"getPlacement",(function(){return q})),n.d(t,"CommentButtonComponent",(function(){return z})),n.d(t,"CommentButton",(function(){return X}));var o=n("Czhu"),i=n("HbGN"),a=n("Iy7w"),c=n("ERkP"),r=n.n(c),l=n("1U1M"),m=n("L21V"),s=n("zJ/j"),d=n("a8dO"),u=n("gloY"),f=n.n(u),E=n("RKN0"),b=n("3IV/"),p=n("lbXe"),g=n("ltac"),I=n("6z9Z"),O=n("3VMZ"),h=n("MV18"),C=n("rc7/"),N=n("FdGg"),_=n("X2PC"),A=n("dIe6"),T=n("uQoP"),v=n("daKX"),M=n("F4Ur"),R=n("LEcB"),w=n("+6Tk"),j=n("mAAb"),k=n("ZsZh"),y=n("65Kk"),P=n.n(y),S=n("xL7A"),L=n("LPS5");const x="confluence.frontend.react.inline.comments",B="confluence.frontend.view.all.inline.comments",D="confluence.frontend.comment.count",V=Object(a.a)("div",{target:"e153kvso0"})("border-radius:3px;max-width:100%;min-width:30px;background:",e=>e.isDialogOpen||e.allInlineCommentsOpen?b.N700:b.N0,";& span{color:",e=>e.isDialogOpen||e.allInlineCommentsOpen?b.N0:"inherit",";}> button:hover{background:",e=>e.isDialogOpen||e.allInlineCommentsOpen?b.N700:b.N30,";}"),U=Object(a.a)("div",{target:"e153kvso1"})({name:"vgor0x",styles:"width:241px;height:214px;display:flex;flex-direction:column;align-items:center;justify-content:center;& h1{font-weight:500;font-size:20px;margin-bottom:14px;}"}),F={padding:"0 4px 0 2px"},H=r.a.createElement(U,{"data-cy":"inline-comment-gif"},r.a.createElement(m.b,{id:"comment-button.heading",defaultMessage:"Be the first to add an inline comment",description:"Heading Section for Inline Comments discoverability Dialog",tagName:"h1"}),r.a.createElement("img",{src:P.a}),r.a.createElement(m.b,{id:"comment-button.message",defaultMessage:"Share your feedback or ask a question by highlighting text and clicking {text}.",description:"Paragraph Section for Inline Comments discoverability Dialog",tagName:"p",values:{text:r.a.createElement("b",null,"Comment")}})),G=Object(T.a)(s.a);function W(e){const{isAnimated:t}=e,n=Object(i.a)(e,["isAnimated"]);return delete n.isAnimated,t?r.a.createElement(G,Object(o.a)({},n)):r.a.createElement(s.a,Object(o.a)({},n))}const K=Object(v.a)("comment-button"),q=e=>e?Object(g.d)(e)?"bottom-end":"auto-end":"bottom-end",z=Object(c.memo)(({contentId:e,createAnalyticsEvent:t,onRender:n,isAnimated:o})=>{let i,a;const s=Object(c.useContext)(I.a),{viewAllInlineComments:u,isViewAllInlineCommentsVisible:b,markCommentAsActive:p}=Object(c.useContext)(k.a),{fireExposureEvent:g}=Object(R.a)("confluence.frontend.comments.inline.discoverability",["header-button","not-enrolled"],"not-enrolled",!0),{cohort:T}=Object(R.a)(x,["react","not-enrolled","backbone"],"not-enrolled",!1),v=Object(w.a)(D),{cohort:y,fireExposureEvent:P}=Object(R.a)(B,["single-inline-comment","not-enrolled","view-all-inline-comments"],"not-enrolled",!0),U=Object(c.useRef)(null),G=Object(c.useRef)(null),{loading:z,data:X,error:Z}=Object(l.d)(L.a,{variables:{pageId:e},fetchPolicy:"cache-and-network"});Object(c.useEffect)(()=>()=>{U.current=null,u(!1),p("")},[U.current]),Object(c.useEffect)(()=>{g()},[g]),Object(c.useEffect)(()=>{P()},[P]),Object(c.useEffect)(()=>{s.start({name:O.a.VIEW_PAGE_COMMENT_BUTTON,id:e,attributes:{framework:"react"===T?j.b.REACT:j.b.BACKBONE}})},[s,T,e]);const[J,Y]=Object(c.useState)(!1),Q=e=>{e?e&&e.classList.contains("react"===T?"inline-highlight":"valid")?e.click():Q($()):ee()},$=()=>{const e=(()=>{const e=[].slice.call(document.querySelectorAll('[data-mark-annotation-type="inlineComment"],.inline-comment-marker'));return"react"===T?e.find(e=>e.classList.contains("inline-highlight"))||null:e.find(e=>e.classList.contains("valid"))||null})(),t=e&&(e.getAttribute("data-id")||e.getAttribute("data-ref"));return t&&Boolean(a.find(e=>e.location.inlineMarkerRef===t))||!1?(U.current=e,e):null},ee=()=>{Y(!J),te(),s.succeed({name:O.a.VIEW_PAGE_DISCOVER_INLINE_COMMENTS_FEATURE,attributes:{pageHasInlineComments:!1}})},te=()=>{t({type:"sendScreenEvent",data:{name:"commentsOnboardingScreen",attributes:{type:"header-button"}}}).fire()},ne=()=>{s.start({name:O.a.VIEW_PAGE_DISCOVER_INLINE_COMMENTS_FEATURE,attributes:{framework:"react"===T?j.b.REACT:j.b.BACKBONE}});const n=Boolean(i&&a.length>0);if(t({type:"sendUIEvent",data:{action:"clicked",actionSubject:"navigationItem",actionSubjectId:"inlineCommentsIcon",attributes:{pageHasInlineComments:n,icontype:"header"},objectType:"page",objectId:e,source:"viewPageScreen"}}).fire(),n)if("view-all-inline-comments"===y)u(!b),p("");else try{U.current?Q(U.current):Q($())}catch(Z){s.fail({name:O.a.VIEW_PAGE_DISCOVER_INLINE_COMMENTS_FEATURE,error:Z,attributes:{pageHasInlineComments:!0}}),K.error`An Error occured when computing to search for first Unresolved Inline comment`}else ee()};return z?r.a.createElement(S.a,{style:F}):Z&&Object(C.b)(Z)?(Object(M.a)(Z),s.abort({name:O.a.VIEW_PAGE_COMMENT_BUTTON,reason:"Anonymous user"}),null):(X&&(i=null==X||null===(oe=X.comments)||void 0===oe?void 0:oe.count,i&&(a=null==X||null===(ie=X.comments)||void 0===ie?void 0:ie.nodes)),n&&n(),r.a.createElement(N.a,{attribution:_.a.COLLABORATION},r.a.createElement(E.a,{isOpen:J,content:H,placement:q(G.current),onClose:()=>{ee()}},r.a.createElement(V,{isDialogOpen:J,allInlineCommentsOpen:b,"data-cy":"comment-button",ref:G},((e,t)=>r.a.createElement(d.a,{content:r.a.createElement(m.b,{id:"comment-button.tooltip",defaultMessage:"Show inline comments",description:"Tooltip for button that shows inline comments for a page"}),hideTooltipOnClick:!0,position:"bottom"},r.a.createElement(W,{testId:"comment-button",appearance:"subtle",iconBefore:r.a.createElement(m.b,{id:"comment-button.icon.label",description:"aria-label for the comment button",defaultMessage:"Comment Icon"},e=>r.a.createElement(f.a,{label:e})),onClick:ne,isAnimated:o,style:F},t&&e>0&&r.a.createElement("span",{"data-testid":"inline-comment-count"},e))))(i,v))),r.a.createElement(h.a,{name:O.a.VIEW_PAGE_COMMENT_BUTTON}),Z&&r.a.createElement(A.a,{error:Z})));var oe,ie});z.defaultProps={isAnimated:!0};const X=Object(p.a)()(z)},ltac:function(e,t,n){"use strict";function o(e){let t=e.offsetTop;for(;e.offsetParent;)t+=(e=e.offsetParent).offsetTop;return t}function i(e,t){if(!e)return!1;t=t||document.scrollingElement||document.body.parentNode;const n=e.offsetHeight,i=o(e),a=o(t)+t.scrollTop,c=t.offsetHeight;return i>=a&&i+n<=a+c}function a(e){if(!e||e===document)return null;const t=window.getComputedStyle(e);return e.scrollHeight>e.clientHeight&&"hidden"!==e.style.overflow&&"visible"!==t.overflow?e:a(e.parentNode)}function c(e,t){t=t||a(e),e&&t&&!i(e,t)&&(t.scrollTop=o(e)-o(t)-t.clientHeight/2)}function r(e){return e.getBoundingClientRect()}function l(e,t){const n=t?t.documentElement:window.document.documentElement;if(!e||!n)return;const o=e.getBoundingClientRect(),{top:i,bottom:a}=o,c=n.offsetHeight;return 0<=i&&i<c||0<=a&&a<=c||i<=0&&0<=a&&a>=c}function m(e,t){const n=t?t.documentElement:window.document.documentElement;if(!e||!n)return;const o=e.getBoundingClientRect(),{top:i}=o,a=n.offsetHeight;return 0<=i&&i<a}n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"g",(function(){return c})),n.d(t,"a",(function(){return r})),n.d(t,"e",(function(){return l})),n.d(t,"f",(function(){return m}))},mAAb:function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return a})),n.d(t,"a",(function(){return c}));const o={EDIT:"edit",VIEW:"view"},i={REACT:"react",BACKBONE:"backbone"},a="confluence.frontend.view.all.inline.comments",c={INVALID_SELECTION:"Invalid text selection. Cannot create inline comments on macros (mentions, images, emojis, etc.)",FAILED_TO_INSERT_MARK:"Failed to insert highlight, invalid originalSelection, numMatches, or matchIndex",INVALID_ARGUMENT_CREATED_FROM:"Invalid createdFrom, please specify if created from editor or renderer",INVALID_ARGUMENT_MATCHES:"Invalid arguments provided for matchIndex and/or numMatches",STALE_SELECTION:"Selection was made against a stale version of the content",COMMENT_NOT_FOUND:"Content with id %d for comment container is not found. Please provide correct container id.",PARENT_NOT_FOUND:"Parent comment with id %d is not found. Please provide correct parent comment id.",INCOMPATIBLE_PARENT_TYPE:"Incompatible parent type. Please provide comment id.",DELETE_ERROR:"Exception occurred while deleting comment with id",NO_DELETE_PERMS:"Parent page view is restricted",NO_DELETE_WITH_CHILDREN:"Inline comment with child cannot be deleted.",NO_UPDATE_PERMS:"Could not update Content of type : class com.atlassian.confluence.pages.Comment with id %d",NO_CREATE_PERMS:"Could not create content with type comment"}}}]);
//# sourceMappingURL=comment-button~0ae2caf4.ECecLMDmHF.js.map